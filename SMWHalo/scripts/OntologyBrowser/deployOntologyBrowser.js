String.prototype.parseColor=function(a){var b="#";if(this.slice(0,4)=="rgb("){var d=this.slice(4,this.length-1).split(","),e=0;do b+=parseInt(d[e]).toColorPart();while(++e<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(e=1;e<4;e++)b+=(this.charAt(e)+this.charAt(e)).toLowerCase();if(this.length==7)b=this.toLowerCase()}return b.length==7?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return b.nodeType==3?b.nodeValue:b.hasChildNodes()?Element.collectTextNodes(b):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(d){return d.nodeType==3?d.nodeValue:d.hasChildNodes()&&!Element.hasClassName(d,b)?Element.collectTextNodesIgnoreClass(d,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(d){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){b=b||5;return(a%(1/b)*b).round()==0?a*b*2-(a*b*2).floor():
1-(a*b*2-(a*b*2).floor())},spring:function(a){return 1-Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE)b+=";zoom:1";a=$(a);$A(a.childNodes).each(function(d){if(d.nodeType==3){d.nodeValue.toArray().each(function(e){a.insertBefore((new Element("span",{style:b})).update(e==" "?String.fromCharCode(160):
e),d)});Element.remove(d)}})},multiple:function(a,b,d){a=(typeof a=="object"||Object.isFunction(a))&&a.length?a:$(a).childNodes;var e=Object.extend({speed:0.1,delay:0},d||{}),f=e.delay;$A(a).each(function(g,h){new b(g,Object.extend(e,{delay:h*e.speed+f}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,d){a=$(a);b=(b||"appear").toLowerCase();d=Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},d||{});Effect[a.visible()?
Effect.PAIRS[b][1]:Effect.PAIRS[b][0]](a,d)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=a.finishOn;d.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b;break}a.startOn+=b;a.finishOn+=b;if(!a.options.queue.limit||this.effects.length<a.options.queue.limit)this.effects.push(a);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){for(var a=(new Date).getTime(),b=0,d=this.effects.length;b<d;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a))return a;return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){function b(d,e){return(d[e+"Internal"]?"this.options."+e+"Internal(this);":"")+(d[e]?"this.options."+e+"(this);":"")}if(a&&a.transition===false)a.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=
this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+b(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+b(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+b(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+b(this.options,"afterUpdate")+"}}");this.event("beforeStart");
this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn)if(a>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");this.finish&&this.finish();this.event("afterFinish")}else{a=(a-this.startOn)/this.totalTime;var b=(a*this.totalFrames).round();if(b>this.currentFrame){this.render(a);this.currentFrame=b}}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?
"global":this.options.queue.scope).remove(this);this.state="finished"},event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this);this.options[a]&&this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,d){a=Object.isString(a)?$(a):a;var e=$A(arguments),f=e.last();e=e.length==5?e[3]:null;this.method=Object.isFunction(f)?f.bind(a):Object.isFunction(a[f])?a[f].bind(a):function(g){a[f]=g};this.start(Object.extend({from:b,to:d},e||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});this.start(Object.extend({from:this.element.getOpacity()||0,to:1},b||{}))},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({x:0,y:0,mode:"relative"},b||{}))},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,d,e){return new Effect.Move(a,Object.extend({x:d,y:b},e||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,d){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:b},d||{}))},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=
this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=
[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var d={};
if(this.options.scaleX)d.width=b.round()+"px";if(this.options.scaleY)d.height=a.round()+"px";if(this.options.scaleFromCenter){var e=(a-this.dims[0])/2,f=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)d.top=this.originalTop-e+"px";if(this.options.scaleX)d.left=this.originalLeft-f+"px"}else{if(this.options.scaleY)d.top=-e+"px";if(this.options.scaleX)d.left=-f+"px"}}this.element.setStyle(d)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({startcolor:"#ffff99"},b||{}))},setup:function(){if(this.element.getStyle("display")=="none")this.cancel();else{this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))}},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,d,e){return b+
(this._base[e]+this._delta[e]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){var d=b||{},e=document.viewport.getScrollOffsets(),f=$(a).cumulativeOffset(),g=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(d.offset)f[1]+=d.offset;return new Effect.Tween(null,e.top,f[1]>g?g:f[1],d,function(h){scrollTo(e.left,h.round())})};
Effect.Fade=function(a,b){a=$(a);var d=a.getInlineOpacity(),e=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(f){f.options.to==0&&f.element.hide().setStyle({opacity:d})}},b||{});return new Effect.Opacity(a,e)};
Effect.Appear=function(a,b){a=$(a);var d=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(e){e.element.forceRerendering()},beforeSetup:function(e){e.element.setOpacity(e.options.from).show()}},b||{});return new Effect.Opacity(a,d)};
Effect.Puff=function(a,b){a=$(a);var d={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(d)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(d){d.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){a=$(a);var d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){a=$(a);var d=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(f){f.element.makePositioned().makeClipping()},afterFinishInternal:function(f){f.element.hide().undoClipping().undoPositioned().setStyle({opacity:d})}})}},b||{}))};
Effect.DropOut=function(a,b){a=$(a);var d={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(d)}},b||{}))};
Effect.Shake=function(a,b){a=$(a);var d=Object.extend({distance:20,duration:0.5},b||{}),e=parseFloat(d.distance),f=parseFloat(d.duration)/10,g={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:e,y:0,duration:f,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:f*2,afterFinishInternal:function(j){new Effect.Move(j.element,{x:e*2,y:0,duration:f*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:-e*2,y:0,duration:f*2,afterFinishInternal:function(m){new Effect.Move(m.element,
{x:e*2,y:0,duration:f*2,afterFinishInternal:function(l){new Effect.Move(l.element,{x:-e,y:0,duration:f,afterFinishInternal:function(n){n.element.undoPositioned().setStyle(g)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){a=$(a).cleanWhitespace();var d=a.down().getStyle("bottom"),e=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:e.height,originalWidth:e.width},restoreAfterFinish:true,afterSetup:function(f){f.element.makePositioned();f.element.down().makePositioned();window.opera&&f.element.setStyle({top:""});f.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(f){f.element.down().setStyle({bottom:f.dims[0]-
f.element.clientHeight+"px"})},afterFinishInternal:function(f){f.element.undoClipping().undoPositioned();f.element.down().undoPositioned().setStyle({bottom:d})}},b||{}))};
Effect.SlideUp=function(a,b){a=$(a).cleanWhitespace();var d=a.down().getStyle("bottom"),e=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:e.height,originalWidth:e.width},restoreAfterFinish:true,afterSetup:function(f){f.element.makePositioned();f.element.down().makePositioned();window.opera&&f.element.setStyle({top:""});f.element.makeClipping().show()},afterUpdateInternal:function(f){f.element.down().setStyle({bottom:f.dims[0]-
f.element.clientHeight+"px"})},afterFinishInternal:function(f){f.element.hide().undoClipping().undoPositioned();f.element.down().undoPositioned().setStyle({bottom:d})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){a=$(a);var d=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),e={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},f=a.getDimensions(),g,h,j,k;switch(d.direction){case "top-left":g=h=j=k=0;break;case "top-right":g=f.width;h=k=0;j=-f.width;break;case "bottom-left":g=j=0;h=f.height;k=-f.height;break;
case "bottom-right":g=f.width;h=f.height;j=-f.width;k=-f.height;break;case "center":g=f.width/2;h=f.height/2;j=-f.width/2;k=-f.height/2;break}return new Effect.Move(a,{x:g,y:h,duration:0.01,beforeSetup:function(m){m.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(m){new Effect.Parallel([new Effect.Opacity(m.element,{sync:true,to:1,from:0,transition:d.opacityTransition}),new Effect.Move(m.element,{x:j,y:k,sync:true,transition:d.moveTransition}),new Effect.Scale(m.element,
100,{scaleMode:{originalHeight:f.height,originalWidth:f.width},sync:true,scaleFrom:window.opera?1:0,transition:d.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(l){l.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(l){l.effects[0].element.undoClipping().undoPositioned().setStyle(e)}},d))}})};
Effect.Shrink=function(a,b){a=$(a);var d=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{}),e={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},f=a.getDimensions(),g,h;switch(d.direction){case "top-left":g=h=0;break;case "top-right":g=f.width;h=0;break;case "bottom-left":g=0;h=f.height;break;case "bottom-right":g=f.width;h=
f.height;break;case "center":g=f.width/2;h=f.height/2;break}return new Effect.Parallel([new Effect.Opacity(a,{sync:true,to:0,from:1,transition:d.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:true,transition:d.scaleTransition,restoreAfterFinish:true}),new Effect.Move(a,{x:g,y:h,sync:true,transition:d.moveTransition})],Object.extend({beforeStartInternal:function(j){j.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(j){j.effects[0].element.hide().undoClipping().undoPositioned().setStyle(e)}},
d))};Effect.Pulsate=function(a,b){a=$(a);var d=b||{},e=a.getInlineOpacity(),f=d.transition||Effect.Transitions.sinoidal,g=function(h){return f(1-Effect.Transitions.pulse(h,d.pulses))};g.bind(f);return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(h){h.element.setStyle({opacity:e})}},d),{transition:g}))};
Effect.Fold=function(a,b){a=$(a);var d={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(d)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var d=Object.extend({style:{}},b||{});if(Object.isString(d.style))if(d.style.include(":"))this.style=d.style.parseStyle();else{this.element.addClassName(d.style);this.style=$H(this.element.getStyles());this.element.removeClassName(d.style);var e=this.element.getStyles();this.style=this.style.reject(function(f){return f.value==e[f.key]});d.afterFinishInternal=function(f){f.element.addClassName(f.options.style);
f.transforms.each(function(g){f.element.style[g.style]=""})}}else this.style=$H(d.style);this.start(d)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b))b="#ffffff";b=b.parseColor();return $R(0,2).map(function(d){return parseInt(b.slice(d*2+1,d*2+3),16)})}this.transforms=this.style.map(function(b){var d=b[0];b=b[1];var e=null;if(b.parseColor("#zzzzzz")!="#zzzzzz"){b=b.parseColor();e="color"}else if(d=="opacity"){b=parseFloat(b);Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})}else if(Element.CSS_LENGTH.test(b)){e=b.match(/^([\+\-]?[0-9\.]+)(.*)$/);b=parseFloat(e[1]);e=e.length==3?e[2]:null}var f=this.element.getStyle(d);return{style:d.camelize(),originalValue:e=="color"?a(f):parseFloat(f||0),targetValue:e=="color"?a(b):b,unit:e}}.bind(this)).reject(function(b){return b.originalValue==b.targetValue||b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))})},update:function(a){for(var b={},d,e=this.transforms.length;e--;)b[(d=this.transforms[e]).style]=
d.unit=="color"?"#"+Math.round(d.originalValue[0]+(d.targetValue[0]-d.originalValue[0])*a).toColorPart()+Math.round(d.originalValue[1]+(d.targetValue[1]-d.originalValue[1])*a).toColorPart()+Math.round(d.originalValue[2]+(d.targetValue[2]-d.originalValue[2])*a).toColorPart():(d.originalValue+(d.targetValue-d.originalValue)*a).toFixed(3)+(d.unit===null?"":d.unit);this.element.setStyle(b,true)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var d=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:d}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),d=a.get("effect"),e=a.get("options");return[$(b)||$$(b)].flatten().map(function(f){return new d(f,Object.extend({sync:true},
e))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();if(Prototype.Browser.WebKit)a=(new Element("div",{style:this})).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';a=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(d){a[d]&&b.set(d,a[d])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=b[e];return d})}:function(a){a=$(a);var b=a.currentStyle,d;d=Element.CSS_PROPERTIES.inject({},function(e,f){e.set(f,b[f]);return e});d.opacity||d.set("opacity",a.getOpacity());return d};
Effect.Methods={morph:function(a,b,d){a=$(a);new Effect.Morph(a,Object.extend({style:b},d||{}));return a},visualEffect:function(a,b,d){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,d);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,d){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,d);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);var SMW_OB_COMMAND_ADDSUBCATEGORY=1,SMW_OB_COMMAND_ADDSUBCATEGORY_SAMELEVEL=2,SMW_OB_COMMAND_SUBCATEGORY_RENAME=3,SMW_OB_COMMAND_ADDSUBPROPERTY=4,SMW_OB_COMMAND_ADDSUBPROPERTY_SAMELEVEL=5,SMW_OB_COMMAND_SUBPROPERTY_RENAME=6,SMW_OB_COMMAND_INSTANCE_DELETE=7,SMW_OB_COMMAND_INSTANCE_CREATE=10,SMW_OB_COMMAND_INSTANCE_RENAME=8,SMW_OB_COMMAND_ADD_SCHEMAPROPERTY=9,OB_SELECTIONLISTENER="selectionChanged",OB_SELECTEDTRIPLELISTENER="selectedTripleChanged",OB_TREETABCHANGELISTENER="treeTabChanged",OB_BEFOREREFRESHLISTENER=
"beforeRefresh",OB_REFRESHLISTENER="refresh",OB_FILTERTREE="filterTree",OB_FILTERBROWSING="filterBrowsing",OB_RESET="reset",OBEventProvider=Class.create();
OBEventProvider.prototype={initialize:function(){this.listeners=[]},addListener:function(a,b){if(this.listeners[b]==null)this.listeners[b]=[];typeof(a[b]=="function")&&this.listeners[b].push(a)},removeListener:function(a,b){if(this.listeners[b]!=null)this.listeners[b]=this.listeners[b].without(a)},fireSelectionChanged:function(a,b,d,e){this.listeners[OB_SELECTIONLISTENER]&&this.listeners[OB_SELECTIONLISTENER].each(function(f){f.selectionChanged(a,b,d,e)})},fireSelectedTripleChanged:function(a,b,d){this.listeners[OB_SELECTEDTRIPLELISTENER]&&
this.listeners[OB_SELECTEDTRIPLELISTENER].each(function(e){e.selectedTripleChanged(a,b,d)})},fireTreeTabChanged:function(a){this.listeners[OB_TREETABCHANGELISTENER]&&this.listeners[OB_TREETABCHANGELISTENER].each(function(b){b.treeTabChanged(a)})},fireFilterTree:function(a,b){this.listeners[OB_FILTERTREE]&&this.listeners[OB_FILTERTREE].each(function(d){d.treeFilterTree(a,b)})},fireFilterBrowsing:function(a,b){this.listeners[OB_FILTERBROWSING]&&this.listeners[OB_FILTERBROWSING].each(function(d){d.filterBrowsing(a,
b)})},fireReset:function(a){this.listeners[OB_RESET]&&this.listeners[OB_RESET].each(function(b){b.reset(a)})},fireRefresh:function(){this.listeners[OB_REFRESHLISTENER]&&this.listeners[OB_REFRESHLISTENER].each(function(a){a.refresh()})},fireBeforeRefresh:function(){this.listeners[OB_BEFOREREFRESHLISTENER]&&this.listeners[OB_BEFOREREFRESHLISTENER].each(function(a){a.beforeRefresh()})}};var selectionProvider=new OBEventProvider,OBArticleCreator=Class.create();
OBArticleCreator.prototype={initialize:function(){this.pendingIndicator=new OBPendingIndicator},createArticle:function(a,b,d,e,f,g){this.pendingIndicator.show(g);sajax_do_call("smwf_om_CreateArticle",[a,wgUserName,b,d,e],function(h){this.pendingIndicator.hide();if(h.status!=200)alert(gLanguage.getMessage("ERROR_CREATING_ARTICLE"));else{var j=h.responseText.match(/(true|false),(true|denied|false),(.*)/);if(j==null)alert(gLanguage.getMessage("ERROR_CREATING_ARTICLE"));else{h=j[1];var k=j[2];j=j[3];
if(h=="true")f(h,k,j);else if(k=="denied"){h=gLanguage.getMessage("smw_acl_create_denied").replace(/\$1/g,j);alert(h)}else alert(gLanguage.getMessage("ERROR_CREATING_ARTICLE"))}}}.bind(this))},deleteArticle:function(a,b,d,e){this.pendingIndicator.show(e);sajax_do_call("smwf_om_DeleteArticle",[a,wgUserName,b],function(f){this.pendingIndicator.hide();if(f.status!=200)alert(gLanguage.getMessage("ERROR_DELETING_ARTICLE"));else if(f.responseText.indexOf("true")!=-1)d();else if(f.responseText.indexOf("denied")!=
-1){f=gLanguage.getMessage("smw_acl_delete_denied").replace(/\$1/g,a);alert(f)}else alert(gLanguage.getMessage("ERROR_DELETING_ARTICLE"))}.bind(this))},renameArticle:function(a,b,d,e,f){this.pendingIndicator.show(f);sajax_do_call("smwf_om_RenameArticle",[a,b,d,wgUserName],function(g){this.pendingIndicator.hide();if(g.status!=200)alert(gLanguage.getMessage("ERROR_RENAMING_ARTICLE"));else if(g.responseText.indexOf("true")!=-1)e();else if(g.responseText.indexOf("denied")!=-1){g=gLanguage.getMessage("smw_acl_delete_denied").replace(/\$1/g,
a);alert(g)}else alert(gLanguage.getMessage("ERROR_RENAMING_ARTICLE"))}.bind(this))},renameArticle1:function(a,b,d,e,f){this.pendingIndicator.show(f);sajax_do_call("smwf_om_RenameArticle",[a,b,d,wgUserName],function(g){this.pendingIndicator.hide();g.responseText.indexOf("true")!=-1&&e();categoryActionListener.select1(this,obInstanceMenuProvider.selectedCategoryTitle)}.bind(this))},editArticle:function(a,b,d,e,f,g,h,j,k,m){function m(){categoryActionListener.select1(this,obInstanceMenuProvider.selectedCategoryTitle)}
sajax_do_call("smwf_om_EditProperty",[a,b,d,e,f,g,h,k,wgUserName],m.bind(this))},renamePropertyType:function(a,b,d,e,f){this.pendingIndicator.show(f);sajax_do_call("smwf_om_RenameTypeProperty",[a,b,d,wgUserName],function(g){this.pendingIndicator.hide();if(g.status!=200)alert(gLanguage.getMessage("ERROR_RENAMING_ARTICLE"));else if(g.responseText.indexOf("true")!=-1)e();else if(g.responseText.indexOf("denied")!=-1){g=gLanguage.getMessage("smw_acl_delete_denied").replace(/\$1/g,oldTitle);alert(g)}else alert(gLanguage.getMessage("ERROR_RENAMING_ARTICLE"))}.bind(this))},
moveCategory:function(a,b,d,e,f){this.pendingIndicator.show(f);sajax_do_call("smwf_om_MoveCategory",[a,b,d],function(g){this.pendingIndicator.hide();if(g.status!=200)alert(gLanguage.getMessage("ERROR_MOVING_CATEGORY"));else if(g.responseText.indexOf("true")==-1)alert("Some error occured on category dragging!");else g.responseText.indexOf("true")!=-1?e():alert(gLanguage.getMessage("ERROR_MOVING_CATEGORY"))}.bind(this))},moveProperty:function(a,b,d,e,f){this.pendingIndicator.show(f);sajax_do_call("smwf_om_MoveProperty",
[a,b,d],function(g){this.pendingIndicator.hide();if(g.status!=200)alert(gLanguage.getMessage("ERROR_MOVING_PROPERTY"));else if(g.responseText.indexOf("true")==-1)alert("Some error occured on property dragging!");else g.responseText.indexOf("true")!=-1?e():alert(gLanguage.getMessage("ERROR_MOVING_PROPERTY"))}.bind(this))}};var articleCreator=new OBArticleCreator,OBOntologyModifier=Class.create();
OBOntologyModifier.prototype={initialize:function(){this.date=new Date;this.count=0},addSubcategory:function(a,b,d){articleCreator.createArticle(gLanguage.getMessage("CATEGORY_NS")+a,"[["+gLanguage.getMessage("CATEGORY_NS")+b+"]]","",gLanguage.getMessage("CREATE_SUB_CATEGORY"),function(){var e=GeneralXMLTools.createDocumentFromString(this.createCategoryNode(a));this.insertCategoryNode(d,e);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedCategoryTree,$("categoryTree"),
true);selectionProvider.fireSelectionChanged(d,b,SMW_CATEGORY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},addSubcategoryOnSameLevel:function(a,b,d){var e=GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,d).parentNode.getAttribute("title");e=e!=null?"[["+gLanguage.getMessage("CATEGORY_NS")+e+"]]":"";articleCreator.createArticle(gLanguage.getMessage("CATEGORY_NS")+a,e,"",gLanguage.getMessage("CREATE_SUB_CATEGORY"),function(){var f=GeneralXMLTools.createDocumentFromString(this.createCategoryNode(a));
this.insertCategoryNode(GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,d).parentNode.getAttribute("id"),f);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedCategoryTree,$("categoryTree"),true);selectionProvider.fireSelectionChanged(d,b,SMW_CATEGORY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},renameCategory:function(a,b,d){articleCreator.renameArticle(gLanguage.getMessage("CATEGORY_NS")+b,gLanguage.getMessage("CATEGORY_NS")+a,"OB",
function(){this.renameCategoryNode(d,a);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedCategoryTree,$("categoryTree"),true);selectionProvider.fireSelectionChanged(d,a,SMW_CATEGORY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},moveCategory:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,a),e=b=="categoryTreeSwitch"?dataAccess.OB_cachedCategoryTree.documentElement:GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,
b),f=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a),g=b=="categoryTreeSwitch"?dataAccess.OB_currentlyDisplayedTree.documentElement:GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,b),h=d.getAttribute("title"),j=d.parentNode.getAttribute("title"),k=e.getAttribute("title");articleCreator.moveCategory(h,j,k,function(){if(e.getAttribute("expanded")=="true"||GeneralXMLTools.hasChildNodesWithTag(e,"conceptTreeElement")){e.removeAttribute("isLeaf");g.removeAttribute("isLeaf");
GeneralXMLTools.importNode(e,d,true);GeneralXMLTools.importNode(g,f,true)}f.parentNode.removeChild(f);d.parentNode.removeChild(d);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedCategoryTree,$("categoryTree"),true);selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null);selectionProvider.fireRefresh()}.bind(this),$("categoryTree"))},moveProperty:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,a),e=b=="propertyTreeSwitch"?
dataAccess.OB_cachedPropertyTree.documentElement:GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,b),f=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a),g=b=="propertyTreeSwitch"?dataAccess.OB_currentlyDisplayedTree.documentElement:GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,b),h=d.getAttribute("title"),j=d.parentNode.getAttribute("title"),k=e.getAttribute("title");articleCreator.moveProperty(h,j,k,function(){e.removeAttribute("isLeaf");g.removeAttribute("isLeaf");
GeneralXMLTools.importNode(e,d,true);GeneralXMLTools.importNode(g,f,true);var m=f.parentNode;m.removeChild(f);var l=d.parentNode;l.removeChild(d);if(!GeneralXMLTools.hasChildNodesWithTag(m,"propertyTreeElement")){m.setAttribute("isLeaf","true");l.setAttribute("isLeaf","true")}selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedPropertyTree,$("propertyTree"),true);selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null);selectionProvider.fireRefresh()}.bind(this),
$("propertyTree"))},addSubproperty:function(a,b,d){articleCreator.createArticle(gLanguage.getMessage("PROPERTY_NS")+a,"","\n[[_SUBP::"+gLanguage.getMessage("PROPERTY_NS")+b+"]]",gLanguage.getMessage("CREATE_SUB_PROPERTY"),function(){var e=GeneralXMLTools.createDocumentFromString(this.createPropertyNode(a));this.insertPropertyNode(d,e);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedPropertyTree,$("propertyTree"),true);selectionProvider.fireSelectionChanged(d,
b,SMW_PROPERTY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},addSubpropertyOnSameLevel:function(a,b,d){var e=GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,d).parentNode.getAttribute("title");e=e!=null?"\n[[_SUBP::"+gLanguage.getMessage("PROPERTY_NS")+e+"]]":"";articleCreator.createArticle(gLanguage.getMessage("PROPERTY_NS")+a,"",e,gLanguage.getMessage("CREATE_SUB_PROPERTY"),function(){var f=GeneralXMLTools.createDocumentFromString(this.createPropertyNode(a));this.insertPropertyNode(GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,
d).parentNode.getAttribute("id"),f);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedPropertyTree,$("propertyTree"),true);selectionProvider.fireSelectionChanged(d,b,SMW_PROPERTY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},renameProperty:function(a,b,d){articleCreator.renameArticle(gLanguage.getMessage("PROPERTY_NS")+b,gLanguage.getMessage("PROPERTY_NS")+a,"OB",function(){this.renamePropertyNode(d,a);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedPropertyTree,
$("propertyTree"),true);selectionProvider.fireSelectionChanged(d,a,SMW_PROPERTY_NS,$(d));selectionProvider.fireRefresh()}.bind(this),$(d))},renameProperty1:function(a,b,d){articleCreator.renameArticle1(gLanguage.getMessage("PROPERTY_NS")+b,gLanguage.getMessage("PROPERTY_NS")+a,"OB",function(){}.bind(this),$(d))},editProperties:function(a,b,d,e,f,g,h,j){articleCreator.editArticle(gLanguage.getMessage("PROPERTY_NS")+a,b,d,e,f,g,h,j,"OB",function(){}.bind(this))},addSchemaProperty:function(a,b,d,e,f,
g,h){var j=d!=""?"\n[[SMW_SSP_HAS_MAX_CARD::"+d+"]]":"";j+=b!=""?"\n[[SMW_SSP_HAS_MIN_CARD::"+b+"]]":"";for(var k="",m=[],l=0,n=e.length;l<n;l++)if(f.indexOf(e[l])!=-1)k+=gLanguage.getMessage("TYPE_NS")+e[l]+(l==n-1?"":";");else{k+=gLanguage.getMessage("TYPE_PAGE")+(l==n-1?"":";");m.push(e[l])}if(e.length>1){j+="\n[[_TYPE::_rec]]";j+="\n[[_LIST::"+k+"]]"}else j+="\n[[_TYPE::"+k+"]]";m.each(function(o){j+="\n[[SMW_SSP_HAS_DOMAIN_AND_RANGE_HINT::"+gLanguage.getMessage("CATEGORY_NS")+g+"; "+gLanguage.getMessage("CATEGORY_NS")+
o+"]]"});if(m.length==0)j+="\n[[SMW_SSP_HAS_DOMAIN_AND_RANGE_HINT::"+gLanguage.getMessage("CATEGORY_NS")+g+"]]";articleCreator.createArticle(gLanguage.getMessage("PROPERTY_NS")+a,"",j,gLanguage.getMessage("CREATE_PROPERTY"),function(){var o=GeneralXMLTools.createDocumentFromString(this.createSchemaProperty(a,b,d,e,f,g,h));dataAccess.OB_cachedProperties.documentElement.removeAttribute("isEmpty");dataAccess.OB_cachedProperties.documentElement.removeAttribute("textToDisplay");GeneralXMLTools.importNode(dataAccess.OB_cachedProperties.documentElement,
o.documentElement,true);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedProperties,$("relattributes"),true);selectionProvider.fireRefresh()}.bind(this),$(h))},renameInstance:function(a,b,d){articleCreator.renameArticle(b,a,"OB",function(){this.renameInstanceNode(a,d);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedInstances,$("instanceList"),true);selectionProvider.fireSelectionChanged(d,a,SMW_INSTANCE_NS,$(d));selectionProvider.fireRefresh()}.bind(this),
$(d))},deleteInstance:function(a,b){articleCreator.deleteArticle(a,"OB",function(){this.deleteInstanceNode(b);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedInstances,$("instanceList"),true);selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null);selectionProvider.fireRefresh()}.bind(this),$(b))},createInstance:function(a,b,d){articleCreator.createArticle(a,"[["+gLanguage.getMessage("CATEGORY_NS")+b+"]]","",gLanguage.getMessage("CREATE_OB_ARTICLE"),
function(){this.addInstanceNode(a,b);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_cachedInstances,$("instanceList"),true);selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null);selectionProvider.fireRefresh()}.bind(this),$(d))},createCategoryNode:function(a){this.count++;var b=encodeURIComponent(a);b=b.replace(/%2F/g,"/");return'<conceptTreeElement title_url="'+b+'" title="'+a+'" id="ID_'+(this.date.getTime()+this.count)+'" isLeaf="true" expanded="true"/>'},
createInstanceNode:function(a,b){this.count++;var d=encodeURIComponent(a);d=d.replace(/%2F/g,"/");encodeURIComponent(b).replace(/%2F/g,"/");var e=GeneralTools.makeWikiURL(a),f=GeneralTools.makeTSCURI(a);return"<instance "+(f!=false?'uri="'+f+'"':"")+' title_url="'+d+'" namespace= "" localurl="'+e+'" title="'+a+'"  id="ID_'+(this.date.getTime()+this.count)+'"  />'},createPropertyNode:function(a){this.count++;var b=encodeURIComponent(a);b=b.replace(/%2F/g,"/");return'<propertyTreeElement title_url="'+
b+'" title="'+a+'" id="ID_'+(this.date.getTime()+this.count)+'" isLeaf="true" expanded="true"/>'},createSchemaProperty:function(a,b,d,e,f){this.count++;rangeTypes="";for(var g=0,h=e.length;g<h;g++)rangeTypes+=f.indexOf(e[g])!=-1?"<rangeType>"+e[g]+"</rangeType>":"<rangeType>"+gLanguage.getMessage("TYPE_PAGE")+"</rangeType>";b=b==""?"0":b;d=d==""?"*":d;e=encodeURIComponent(a);e=e.replace(/%2F/g,"/");return'<property title_url="'+e+'" title="'+a+'" minCard="'+b+'" maxCard="'+d+'">'+rangeTypes+"</property>"},
renameInstanceNode:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedInstances,b);d.removeAttribute("title");d.removeAttribute("namespace");var e=a.split(":");if(e.length==2){d.setAttribute("title",e[1]);d.setAttribute("namespace",e[0])}else{d.setAttribute("title",a);d.setAttribute("namespace","")}},deleteInstanceNode:function(a){a=GeneralXMLTools.getNodeById(dataAccess.OB_cachedInstances,a);a.parentNode.removeChild(a)},addInstanceNode:function(a,b){var d=GeneralXMLTools.createDocumentFromString(this.createInstanceNode(a,
b));dataAccess.OB_cachedInstances.documentElement.removeAttribute("textToDisplay");dataAccess.OB_cachedInstances.documentElement.removeAttribute("isEmpty");GeneralXMLTools.importNode(dataAccess.OB_cachedInstances.documentElement,d.documentElement,true)},insertCategoryNode:function(a,b){var d=a!=null?GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,a):dataAccess.OB_cachedCategoryTree.documentElement,e=a!=null?GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a):dataAccess.OB_currentlyDisplayedTree.documentElement;
d.removeAttribute("isLeaf");d.setAttribute("expanded","true");e.removeAttribute("isLeaf");e.setAttribute("expanded","true");GeneralXMLTools.importNode(d,b.documentElement,true);GeneralXMLTools.importNode(e,b.documentElement,true)},insertPropertyNode:function(a,b){var d=a!=null?GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,a):dataAccess.OB_cachedPropertyTree.documentElement,e=a!=null?GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a):dataAccess.OB_currentlyDisplayedTree.documentElement;
d.removeAttribute("isLeaf");d.setAttribute("expanded","true");e.removeAttribute("isLeaf");e.setAttribute("expanded","true");GeneralXMLTools.importNode(d,b.documentElement,true);GeneralXMLTools.importNode(e,b.documentElement,true)},renameCategoryNode:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedCategoryTree,a),e=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a);d.removeAttribute("title");e.removeAttribute("title");d.setAttribute("title",b);e.setAttribute("title",
b)},renamePropertyNode:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,a),e=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a);d.removeAttribute("title");e.removeAttribute("title");d.setAttribute("title",b);e.setAttribute("title",b)},renamePropertyTypeNode:function(a,b){var d=GeneralXMLTools.getNodeById(dataAccess.OB_cachedPropertyTree,a),e=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a);d.removeAttribute("type");e.removeAttribute("type");
d.setAttribute("type",b);e.setAttribute("type",b)}};var ontologyTools=new OBOntologyModifier,OBInputFieldValidator=Class.create();
OBInputFieldValidator.prototype={initialize:function(a,b,d,e){this.id=a;this.validate_fnc=e;this.control=d;this.blurListener=this.keyListener=null;this.timerRegistered=this.istyping=false;this.isValid=b;this.lastValidation=null;$(this.id)!=null&&this.registerListeners()},OBInputFieldValidator:function(a,b,d,e){this.id=a;this.validate_fnc=e;this.control=d;this.blurListener=this.keyListener=null;this.timerRegistered=this.istyping=false;this.isValid=b;this.lastValidation=null;$(this.id)!=null&&this.registerListeners()},
registerListeners:function(){var a=$(this.id);this.keyListener=this.onKeyEvent.bindAsEventListener(this);this.blurListener=this.onBlurEvent.bindAsEventListener(this);Event.observe(a,"input",this.keyListener);Event.observe(a,"keyup",this.keyListener);Event.observe(a,"keydown",this.keyListener);Event.observe(a,"blur",this.blurListener)},deregisterListeners:function(){var a=$(this.id);if(a!=null){Event.stopObserving(a,"input",this.keyListener);Event.stopObserving(a,"keyup",this.keyListener);Event.stopObserving(a,
"keydown",this.keyListener);Event.stopObserving(a,"blur",this.blurListener)}},onKeyEvent:function(a){this.istyping=true;if(!(a.keyCode==9||a.ctrlKey||a.altKey||a.keyCode==18||a.keyCode==17))if(!((a.ctrlKey||a.altKey)&&a.keyCode==32))if(!(a.keyCode>=37&&a.keyCode<=40))if(!this.timerRegistered){this.control.reset(this.id);this.timedCallback(this.validate.bind(this));this.timerRegistered=true}},onBlurEvent:function(){this.lastValidation!=null&&this.lastValidation!=$F(this.id)&&this.validate()},timedCallback:function(a){if(this.istyping){this.istyping=
false;a=this.timedCallback.bind(this,a);setTimeout(a,1E3)}else{a(this.id);this.istyping=this.timerRegistered=false}},validate:function(){this.lastValidation=$F(this.id);this.isValid=this.validate_fnc(this.id);this.isValid!==null&&this.control.enable(this.isValid,this.id)}};var OBChangedTitleValidator=Class.create();
OBChangedTitleValidator.prototype=Object.extend(new OBInputFieldValidator,{initialize:function(a,b,d,e){this.OBInputFieldValidator(a,false,e,this._checkIfArticleExists.bind(this));this.ns=b;this.mustExist=d;this.pendingElement=new OBPendingIndicator;this.hintDIV=document.createElement("div");$(a).parentNode.appendChild(this.hintDIV)},_checkIfArticleExists:function(){var a=$F(this.id);if(a=="")this.control.enable(false,this.id);else{this.pendingElement.show(this.id);sajax_do_call("smwf_om_ExistsArticleIgnoreRedirect",
[this.ns==""?a:this.ns+":"+a],function(b,d){this.pendingElement.hide();var e=d.responseText.match(/(true|false)/);this.hintDIV.innerHTML="";isChanged=false;if(cardChanged==true||typeChanged==true||rangeChanged==true)isChanged=true;if($F(b)=="")this.control.enable(false,b);else if(e==null){this.isValid=false;this.control.enable(false,b)}else if(e[0]=="true"){if(titleChanged==true){this.isValid=false;this.control.enable(false,b);this.hintDIV.innerHTML=gLanguage.getMessage("OB_TITLE_EXISTS")}if(titleChanged==
false)if(isChanged==true){this.isValid=true;this.control.enable(true,b)}}else{this.isValid=true;this.control.enable(true,b)}}.bind(this,this.id));return null}}});var OBInputTitleValidator=Class.create();
OBInputTitleValidator.prototype=Object.extend(new OBInputFieldValidator,{initialize:function(a,b,d,e){this.OBInputFieldValidator(a,false,e,this._checkIfArticleExists.bind(this));this.ns=b;this.mustExist=d;this.pendingElement=new OBPendingIndicator;this.hintDIV=document.createElement("div");$(a).parentNode.appendChild(this.hintDIV)},_checkIfArticleExists:function(){var a=$F(this.id);if(a=="")this.control.enable(false,this.id);else{this.pendingElement.show(this.id);sajax_do_call("smwf_om_ExistsArticleIgnoreRedirect",
[this.ns==""?a:this.ns+":"+a],function(b,d){this.pendingElement.hide();var e=d.responseText.match(/(true|false)/);this.titleChanged=true;this.hintDIV.innerHTML="";if($F(b)=="")this.control.enable(false,b);else if(e==null){this.isValid=false;this.control.enable(false,b)}else if(e[0]=="true"){this.isValid=this.mustExist;this.control.enable(this.mustExist,b);if(!this.isValid)this.hintDIV.innerHTML=gLanguage.getMessage("OB_TITLE_EXISTS")}else{this.isValid=!this.mustExist;this.control.enable(!this.mustExist,
b);if(!this.isValid)this.hintDIV.innerHTML=gLanguage.getMessage("OB_TITLE_NOTEXISTS")}}.bind(this,this.id));return null}}});var OBOntologySubMenu=Class.create();
OBOntologySubMenu.prototype={initialize:function(a,b){this.OBOntologySubMenu(a,b)},OBOntologySubMenu:function(a,b){this.id=a;this.objectname=b;this.envContainerID=this.commandID=null;this.oldHeight=0;this.menuOpened=false},showContent:function(a,b){this.menuOpened&&this._cancel();this.commandID=a;this.envContainerID=b;$(this.id).replace(this.getUserDefinedControls());this.oldHeight=$(b).getHeight();this.adjustSize();this.setValidators();this.setFocus();this.menuOpened=true},showContentProperty:function(a,
b,d,e,f){this.menuOpened&&this._cancel();this.commandID=a;this.envContainerID=b;this.propertyName=d;this.propertyMinCard=e;this.propertyType=f;a=0;for(d=1;d<this.builtinTypes.length;d++)this.builtinTypes[d]==this.propertyType&&a++;$(this.id).replace(this.getUserDefinedControls());if(a==0){this.isRange=true;this.showRange(true)}rangeChanged=cardChanged=typeChanged=titleChanged=false;this.oldHeight=$(b).getHeight();this.adjustSize();this.setTitleValidators();this.setFocus()},adjustSize:function(){var a=
this.oldHeight-$(this.id).getHeight()-2+"px";$(this.envContainerID).setStyle({height:a})},_cancel:function(){var a=this.oldHeight-2+"px";$(this.envContainerID).setStyle({height:a});$(this.id).replace('<div id="'+this.id+'">');this.menuOpened=false},setValidators:function(){},getUserDefinedControls:function(){},doCommand:function(){},enable:function(){},reset:function(){}};var OBCatgeorySubMenu=Class.create();
OBCatgeorySubMenu.prototype=Object.extend(new OBOntologySubMenu,{initialize:function(a,b){this.OBOntologySubMenu(a,b);this.selectedID=this.selectedTitle=this.titleInputValidator=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},selectionChanged:function(a,b,d){if(d==SMW_CATEGORY_NS){this.selectedTitle=b;this.selectedID=a}},doCommand:function(){switch(this.commandID){case SMW_OB_COMMAND_ADDSUBCATEGORY:ontologyTools.addSubcategory($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);
this.cancel();break;case SMW_OB_COMMAND_ADDSUBCATEGORY_SAMELEVEL:ontologyTools.addSubcategoryOnSameLevel($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();break;case SMW_OB_COMMAND_SUBCATEGORY_RENAME:ontologyTools.renameCategory($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();break;default:alert("Unknown command!")}},getCommandText:function(){switch(this.commandID){case SMW_OB_COMMAND_SUBCATEGORY_RENAME:return"OB_RENAME";case SMW_OB_COMMAND_ADDSUBCATEGORY_SAMELEVEL:case SMW_OB_COMMAND_ADDSUBCATEGORY:return"OB_CREATE";
default:return"Unknown command"}},getUserDefinedControls:function(){return'<div id="'+this.id+'"><div style="display: block; height: 22px;"><input style="display:block; width:45%; float:left" id="'+this.id+'_input_ontologytools" type="text" value="'+(this.commandID==SMW_OB_COMMAND_SUBCATEGORY_RENAME?this.selectedTitle.replace(/_/g," "):"")+'"/><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage("OB_ENTER_TITLE")+'</span> | <a onclick="'+this.objectname+'.cancel()">'+
gLanguage.getMessage("CANCEL")+"</a>"+(this.commandID==SMW_OB_COMMAND_SUBCATEGORY_RENAME?' | <a onclick="'+this.objectname+'.preview()" id="'+this.id+'_preview_ontologytools">'+gLanguage.getMessage("OB_PREVIEW")+"</a>":"")+'</div><div id="preview_category_tree"/></div>'},setValidators:function(){this.titleInputValidator=new OBInputTitleValidator(this.id+"_input_ontologytools",gLanguage.getMessage("CATEGORY_NS_WOC"),false,this)},setFocus:function(){$(this.id+"_input_ontologytools").focus()},cancel:function(){this.titleInputValidator.deregisterListeners();
this._cancel()},preview:function(){var a=new OBPendingIndicator;a.show($("preview_category_tree"));sajax_do_call("smwf_ob_PreviewRefactoring",[this.selectedTitle,SMW_CATEGORY_NS],this.pastePreview.bind(this,a))},pastePreview:function(a,b){a.hide();var d='<table border="0" class="menuBarcategoryTree">'+b.responseText+"</table>";$("preview_category_tree").innerHTML=d;this.adjustSize()},enableCommand:function(a,b){a?$(this.id+"_apply_ontologytools").replace('<a style="margin-left: 10px;" id="'+this.id+
'_apply_ontologytools" onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage(this.getCommandText())+"</a>"):$(this.id+"_apply_ontologytools").replace('<span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage(b)+"</span>")},enable:function(a,b){var d=a?"#0F0":$F(b)==""?"#FFF":"#F00";this.enableCommand(a,a?this.getCommandText():$F(b)==""?"OB_ENTER_TITLE":"OB_TITLE_EXISTS");$(b).setStyle({backgroundColor:d})},reset:function(a){this.enableCommand(false,"OB_ENTER_TITLE");
$(a).setStyle({backgroundColor:"#FFF"})}});var OBPropertySubMenu=Class.create();
OBPropertySubMenu.prototype=Object.extend(new OBOntologySubMenu,{initialize:function(a,b){this.OBOntologySubMenu(a,b);this.selectedID=this.selectedTitle=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},selectionChanged:function(a,b,d){if(d==SMW_PROPERTY_NS){this.selectedTitle=b;this.selectedID=a}},doCommand:function(){switch(this.commandID){case SMW_OB_COMMAND_ADDSUBPROPERTY:ontologyTools.addSubproperty($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();
break;case SMW_OB_COMMAND_ADDSUBPROPERTY_SAMELEVEL:ontologyTools.addSubpropertyOnSameLevel($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();break;case SMW_OB_COMMAND_SUBPROPERTY_RENAME:ontologyTools.renameProperty($F(this.id+"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();break;default:alert("Unknown command!")}},getCommandText:function(){switch(this.commandID){case SMW_OB_COMMAND_SUBPROPERTY_RENAME:return"OB_RENAME";case SMW_OB_COMMAND_ADDSUBPROPERTY_SAMELEVEL:case SMW_OB_COMMAND_ADDSUBPROPERTY:return"OB_CREATE";
default:return"Unknown command"}},getUserDefinedControls:function(){return'<div id="'+this.id+'"><div style="display: block; height: 22px;"><input style="display:block; width:45%; float:left" id="'+this.id+'_input_ontologytools" type="text" value="'+(this.commandID==SMW_OB_COMMAND_SUBPROPERTY_RENAME?this.selectedTitle.replace(/_/g," "):"")+'"/><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage("OB_ENTER_TITLE")+'</span> | <a onclick="'+this.objectname+'.cancel()">'+
gLanguage.getMessage("CANCEL")+"</a>"+(this.commandID==SMW_OB_COMMAND_SUBPROPERTY_RENAME?' | <a onclick="'+this.objectname+'.preview()" id="'+this.id+'_preview_ontologytools">'+gLanguage.getMessage("OB_PREVIEW")+"</a>":"")+'</div><div id="preview_property_tree"/></div>'},setValidators:function(){this.titleInputValidator=new OBInputTitleValidator(this.id+"_input_ontologytools",gLanguage.getMessage("PROPERTY_NS_WOC"),false,this)},setFocus:function(){$(this.id+"_input_ontologytools").focus()},cancel:function(){this.titleInputValidator.deregisterListeners();
this._cancel()},preview:function(){sajax_do_call("smwf_ob_PreviewRefactoring",[this.selectedTitle,SMW_PROPERTY_NS],this.pastePreview.bind(this))},pastePreview:function(a){a='<table border="0" class="menuBarpropertyTree">'+a.responseText+"</table>";$("preview_property_tree").innerHTML=a;this.adjustSize()},enableCommand:function(a,b){a?$(this.id+"_apply_ontologytools").replace('<a style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools" onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage(this.getCommandText())+
"</a>"):$(this.id+"_apply_ontologytools").replace('<span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage(b)+"</span>")},enable:function(a,b){var d=a?"#0F0":$F(b)==""?"#FFF":"#F00";this.enableCommand(a,a?this.getCommandText():$F(b)==""?"OB_ENTER_TITLE":"OB_TITLE_EXISTS");$(b).setStyle({backgroundColor:d})},reset:function(a){this.enableCommand(false,"OB_ENTER_TITLE");$(a).setStyle({backgroundColor:"#FFF"})}});var OBInstanceSubMenu=Class.create();
OBInstanceSubMenu.prototype=Object.extend(new OBOntologySubMenu,{initialize:function(a,b){this.OBOntologySubMenu(a,b);this.selectedID=this.selectedTitle=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},selectionChanged:function(a,b,d){if(d==SMW_INSTANCE_NS){this.selectedTitle=b;this.selectedID=a}else if(d==SMW_CATEGORY_NS){this.selectedCategoryTitle=b;this.selectedCategoryID=a}},doCommand:function(a){switch(a?a:this.commandID){case SMW_OB_COMMAND_INSTANCE_RENAME:ontologyTools.renameInstance($F(this.id+
"_input_ontologytools"),this.selectedTitle,this.selectedID);this.cancel();break;case SMW_OB_COMMAND_INSTANCE_DELETE:ontologyTools.deleteInstance(this.selectedTitle,this.selectedID);this.cancel();break;case SMW_OB_COMMAND_INSTANCE_CREATE:ontologyTools.createInstance($F(this.id+"_input_ontologytools"),this.selectedCategoryTitle,this.selectedCategoryID);this.cancel();break;default:alert("Unknown command!")}},getCommandText:function(){switch(this.commandID){case SMW_OB_COMMAND_INSTANCE_RENAME:return"OB_RENAME";
case SMW_OB_COMMAND_INSTANCE_CREATE:return"OB_CREATE";default:return"Unknown command"}},getUserDefinedControls:function(){var a="";if(this.commandID==SMW_OB_COMMAND_INSTANCE_RENAME){var b=this.selectedTitle.replace(/_/g," ");a+='<div id="'+this.id+'"><div style="display: block; height: 22px;"><input style="display:block; width:45%; float:left" id="'+this.id+'_input_ontologytools" type="text" value="'+b+'"/><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage("OB_ENTER_TITLE")+
'</span> | <a onclick="'+this.objectname+'.cancel()">'+gLanguage.getMessage("CANCEL")+'</a> | <a onclick="'+this.objectname+'.preview()" id="'+this.id+'_preview_ontologytools">'+gLanguage.getMessage("OB_PREVIEW")+'</a></div><div id="preview_instance_list"/></div>'}else if(this.commandID==SMW_OB_COMMAND_INSTANCE_DELETE){b=this.selectedTitle.replace(/_/g," ");a+='<div id="'+this.id+'"><div style="display: block; height: 22px;"><input style="display:block; width:45%; float:left" id="'+this.id+'_input_ontologytools" disabled="true" type="text" value="'+
b+'"/><a onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage("DELETE")+'</a> |  | <a onclick="'+this.objectname+'.cancel()">'+gLanguage.getMessage("CANCEL")+'</a> | <a onclick="'+this.objectname+'.preview()" id="'+this.id+'_preview_ontologytools">'+gLanguage.getMessage("OB_PREVIEW")+'</a></div><div id="preview_instance_list"/></div>'}else if(this.commandID==SMW_OB_COMMAND_INSTANCE_CREATE){this.selectedCategoryTitle.replace(/_/g," ");a+='<div id="'+this.id+'"><div style="display: block; height: 22px;"><input style="display:block; width:45%; float:left" id="'+
this.id+'_input_ontologytools" type="text" value=""/><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage("OB_ENTER_TITLE")+'</span> | <a onclick="'+this.objectname+'.cancel()">'+gLanguage.getMessage("CANCEL")+'</a> <div id="preview_instance_list"/></div>'}return a},setValidators:function(){this.titleInputValidator=new OBInputTitleValidator(this.id+"_input_ontologytools","",false,this)},setFocus:function(){$(this.id+"_input_ontologytools").focus()},cancel:function(){this.titleInputValidator.deregisterListeners();
this._cancel()},preview:function(){sajax_do_call("smwf_ob_PreviewRefactoring",[this.selectedTitle,SMW_INSTANCE_NS],this.pastePreview.bind(this))},pastePreview:function(a){a='<table border="0" class="menuBarInstance">'+a.responseText+"</table>";$("preview_instance_list").innerHTML=a;this.adjustSize()},enableCommand:function(a,b){a?$(this.id+"_apply_ontologytools").replace('<a style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools" onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage(this.getCommandText())+
"</a>"):$(this.id+"_apply_ontologytools").replace('<span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage(b)+"</span>")},enable:function(a,b){var d=a?"#0F0":$F(b)==""?"#FFF":"#F00";this.enableCommand(a,a?this.getCommandText():$F(b)==""?"OB_ENTER_TITLE":"OB_TITLE_EXISTS");$(b).setStyle({backgroundColor:d})},reset:function(a){this.enableCommand(false,"OB_ENTER_TITLE");$(a).setStyle({backgroundColor:"#FFF"})}});var OBSchemaPropertySubMenu=Class.create();
OBSchemaPropertySubMenu.prototype=Object.extend(new OBOntologySubMenu,{initialize:function(a,b){this.pageselected=this.MandatoryChecked=false;this.OBOntologySubMenu(a,b);this.minCardValidator=this.maxCardValidator=this.selectedID=this.selectedTitle=null;this.builtinTypes=[];this.count=1;selectionProvider.addListener(this,OB_SELECTIONLISTENER);this.requestTypes()},selectionChanged:function(a,b,d){if(d==SMW_CATEGORY_NS){this.selectedTitle=b;this.selectedID=a}},doCommand:function(){switch(this.commandID){case SMW_OB_COMMAND_ADD_SCHEMAPROPERTY:var a=
$F(this.id+"_propertytitle_ontologytools");if(this.MandatoryChecked==true)var b="1",d="";if(this.MandatoryChecked==false){b="0";d=""}this.MandatoryChecked=false;var e=[],f=[];$("typeRange1_ontologytools")!=null&&f.push($F("typeRange1_ontologytools"));if(this.pageselected==true)if($("typeRange2_ontologytools")!=null){e.push($F("typeRange2_ontologytools"));e!=""&&f.push($F("typeRange2_ontologytools"))}ontologyTools.addSchemaProperty(a,b,d,f,this.builtinTypes,this.selectedTitle,this.selectedID);this.cancel();
break;default:alert("Unknown command!")}},getCommandText:function(){switch(this.commandID){case SMW_OB_COMMAND_ADD_SCHEMAPROPERTY:return"OB_CREATE";default:return"Unknown command"}},getUserDefinedControls:function(){var a=this.newTypeInputBox(),b=this.newRangeInputBox();return'<div id="'+this.id+'"><table class="menuBarProperties"><tr><td width="60px;">'+gLanguage.getMessage("NAME")+'</td><td><input id="'+this.id+'_propertytitle_ontologytools" type="text" tabIndex="101"/></td></tr><tr><td>'+gLanguage.getMessage("Mandatory")+
'</td><td><input id="'+this.id+'_minCard_ontologytools" onclick="'+this.objectname+'.Mandatory(this)" type="checkbox" name="Mandatory" size="5" tabIndex="102"/></td></tr></table></table><table class="menuBarProperties" id="typesAndRanges"></table><table class="menuBarProperties"><tr><td width="60px;">'+gLanguage.getMessage("ADD_TYPE")+"</td><td>"+a+'</td></tr><tr><td width="60px;">'+gLanguage.getMessage("ADD_RANGE")+"</td><td>"+b+'</td></tr></table><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+
gLanguage.getMessage("OB_ENTER_TITLE")+'</span> | <a onclick="'+this.objectname+'.cancel()">'+gLanguage.getMessage("CANCEL")+"</a></div>"},Mandatory:function(a){if(a.checked==true)this.MandatoryChecked=true},setValidators:function(){this.titleInputValidator=new OBInputTitleValidator(this.id+"_propertytitle_ontologytools",gLanguage.getMessage("PROPERTY_NS_WOC"),false,this)},checkMaxCard:function(){var a=$F(this.id+"_maxCard_ontologytools");return a==""||a.match(/^\d+$/)!=null&&parseInt(a)>0},checkMinCard:function(){var a=
$F(this.id+"_minCard_ontologytools");return a==""||a.match(/^\d+$/)!=null&&parseInt(a)>=0},setFocus:function(){$(this.id+"_propertytitle_ontologytools").focus()},cancel:function(){this.titleInputValidator.deregisterListeners();this._cancel()},enable:function(a,b){var d=a?"#0F0":$F(b)==""?"#FFF":"#F00";$(b).setStyle({backgroundColor:d});this.enableCommand(this.allIsValid(),this.getCommandText())},reset:function(a){this.enableCommand(false,"OB_CREATE");$(a).setStyle({backgroundColor:"#FFF"})},enableCommand:function(a){a&&
$(this.id+"_apply_ontologytools").replace('<a style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools" onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage(this.getCommandText())+"</a>")},allIsValid:function(){return this.titleInputValidator.isValid},requestTypes:function(){function a(b){this.builtinTypes=this.builtinTypes.concat(b.responseText.split(","));GeneralBrowserTools.setCookieObject("smwh_builtinTypes",this.builtinTypes)}this.builtinTypes=GeneralBrowserTools.getCookieObject("smwh_builtinTypes");
if(this.builtinTypes==null){this.builtinTypes=[];sajax_do_call("smwf_tb_GetBuiltinDatatypes",[],a.bind(this))}sajax_do_call("smwf_tb_GetUserDatatypes",[],function(b){b=b.responseText.split(",");b.shift();this.builtinTypes=this.builtinTypes.concat(b)}.bind(this))},onchangeTypeSelector:function(a){if($F(a.currentTarget).toLowerCase()==gLanguage.getMessage("PAGE_TYPE")){$("typeRange2_ontologytools").enable();$("typeRange2_ontologytools").setStyle({backgroundColor:"#fff"});this.pageselected=true}else{$("typeRange2_ontologytools").value=
"";$("typeRange2_ontologytools").setStyle({backgroundColor:"#aaa"});$("typeRange2_ontologytools").disable();this.pageselected=false}},newTypeInputBox:function(){for(var a='<select id="typeRange'+this.count+'_ontologytools" name="types'+this.count+'" onchange="obSchemaPropertiesMenuProvider.onchangeTypeSelector(event)" tabIndex="103">',b=1;b<this.builtinTypes.length;b++)a+="<option>"+this.builtinTypes[b]+"</option>";a+="</select>";return a},newRangeInputBox:function(){return'<input class="wickEnabled" constraints="namespace: 14" disabled="false" type="text" id="typeRange'+
(this.count+1)+'_ontologytools" tabIndex="104"/>'},addType:function(){if(this.builtinTypes!=null){var a=$("typesAndRanges").firstChild==null?$("typesAndRanges"):$("typesAndRanges").firstChild;$(a.appendChild(document.createElement("tr"))).replace('<tr><td width="60px;">Type </td><td>'+this.newTypeInputBox()+"</td></tr>");this.count++;this.adjustSize()}},addRange:function(){var a=$("typesAndRanges").firstChild==null?$("typesAndRanges"):$("typesAndRanges").firstChild;autoCompleter.deregisterAllInputs();
$(a.appendChild(document.createElement("tr"))).replace('<tr><td width="60px;">'+gLanguage.getMessage("CATEGORY_NS_WOC")+" </td><td>"+this.newRangeInputBox()+"</td></tr>");autoCompleter.registerAllInputs();this.enable(true,"typeRange"+this.count+"_ontologytools");this.count++;this.adjustSize()},removeTypeOrRange:function(a,b){b&&/typeRange(\d+)/.exec(a);for(var d=$(a);d.parentNode.getAttribute("id")!="typesAndRanges";)d=d.parentNode;d.removeChild($(a).parentNode.parentNode);this.enableCommand(this.allIsValid(),
this.getCommandText());this.adjustSize()}});var obCategoryMenuProvider=new OBCatgeorySubMenu("categoryTreeMenu","obCategoryMenuProvider"),obPropertyMenuProvider=new OBPropertySubMenu("propertyTreeMenu","obPropertyMenuProvider"),obInstanceMenuProvider=new OBInstanceSubMenu("instanceListMenu","obInstanceMenuProvider"),obSchemaPropertiesMenuProvider=new OBSchemaPropertySubMenu("schemaPropertiesMenu","obSchemaPropertiesMenuProvider"),OBEditPropertySubMenu=Class.create();
OBEditPropertySubMenu.prototype=Object.extend(new OBOntologySubMenu,{initialize:function(a,b){this.OBOntologySubMenu(a,b);this.minCardValidator=this.maxCardValidator=this.selectedID=this.selectedTitle=null;this.rangeValidator=[];this.builtinTypes=[];this.count=1;selectionProvider.addListener(this,OB_SELECTIONLISTENER);this.requestTypes()},selectionChanged:function(a,b,d){if(d==SMW_CATEGORY_NS){this.selectedTitle=b;this.selectedID=a}},doCommand:function(){var a=this.propertyName,b=this.newTitle,d=
this.typeOrRange,e=this.propertyMinCard,f=this.propertyRange,g=this.propertyMinCard,h=this.typeOrRange,j=this.propertyRange;if(typeChanged==true)h=this.newType;if(h!="Page")j="";if(cardChanged==true)g=this.newCard;if(rangeChanged==true)j=this.newRange;if(cardChanged==true||typeChanged==true||rangeChanged==true){ontologyTools.editProperties(a,h,g,j,d,e,f,this.selectedID);cardChanged=rangeChanged=typeChanged=false}if(titleChanged==true){ontologyTools.renameProperty1(b,a,this.selectedID);titleChanged=
false}this.pendingIndicator.show(node)},getCommandText:function(){switch(this.commandID){case SMW_OB_COMMAND_ADD_SCHEMAPROPERTY:return"OB_CREATE";default:return"OB_SAVE_CHANGES"}},getUserDefinedControls:function(){var a="";if(this.propertyMinCard=="0"){a="";propertyMandatory=false}else{a='checked="true"';propertyMandatory=true}var b=this.propertyName,d=this.newTypeInputBox(),e=this.newRangeInputBox();return'<div id="'+this.id+'"><span style="margin-left: 10px;" id="'+this.id+'_ontologytools">'+gLanguage.getMessage("EditProperty")+
'</span><table class="menuBarProperties"><tr><td width="60px;">'+gLanguage.getMessage("NAME")+'</td><td><input id="'+this.id+'_propertytitle_ontologytools" type="text" value="'+b+'" onKeyup="obEditPropertiesMenuProvider.onchangeTitleSelector(event)" " tabIndex="101"/></td></tr><tr><td>'+gLanguage.getMessage("Mandatory")+'</td><td><input id="'+this.id+'_minCard_ontologytools" onclick="'+this.objectname+'.Mandatory(this)" type="checkbox"'+a+' name="Mandatory" size="5"tabIndex="102"/></td></tr></table></table><table class="menuBarProperties" id="typesAndRanges"></table><table class="menuBarProperties"><tr><td width="60px;">'+
gLanguage.getMessage("ADD_TYPE")+"</td><td>"+d+'</td></tr><tr><td width="60px;">'+gLanguage.getMessage("ADD_RANGE")+"</td><td>"+e+'</td></tr></table><span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage("OB_SAVE_CHANGES")+'</span> | <a onclick="'+this.objectname+'.cancel()">'+gLanguage.getMessage("CANCEL")+"</a></div>"},Mandatory:function(a){if(a.checked==true){MandatoryChecked=true;this.newCard="1"}if(a.checked==false){MandatoryChecked=false;this.newCard="0"}cardChanged=
MandatoryChecked!=propertyMandatory?true:false;cardChanged==true&&this.enableCommand(true,"OB_SAVE_CHANGES");cardChanged==false&&this.enableCommand(false,"OB_SAVE_CHANGES")},onchangeTitleSelector:function(a){a=$F(a.currentTarget);if(a!=this.propertyName){titleChanged=true;this.newTitle=a}else titleChanged=false;if(cardChanged==false&&typeChanged==false&&rangeChanged==false)titleChanged==true?this.enableCommand(true,"OB_SAVE_CHANGES"):this.enableCommand(false,"OB_SAVE_CHANGES")},setValidators:function(){this.titleInputValidator=
new OBInputTitleValidator(this.id+"_propertytitle_ontologytools",gLanguage.getMessage("PROPERTY_NS_WOC"),false,this)},setTitleValidators:function(){this.changedtitleInputValidator=new OBChangedTitleValidator(this.id+"_propertytitle_ontologytools",gLanguage.getMessage("PROPERTY_NS_WOC"),false,this)},checkMaxCard:function(){var a=$F(this.id+"_maxCard_ontologytools");return a==""||a.match(/^\d+$/)!=null&&parseInt(a)>0},checkMinCard:function(){var a=$F(this.id+"_minCard_ontologytools");return a==""||
a.match(/^\d+$/)!=null&&parseInt(a)>=0},setFocus:function(){$(this.id+"_propertytitle_ontologytools").focus()},cancel:function(){this._cancel()},enable:function(a,b){var d=titleChanged==false?"#FFF":a?"#0F0":$F(b)==""?"#FFF":"#F00";$(b).setStyle({backgroundColor:d});this.enableCommand(this.allIsValid(),this.getCommandText())},reset:function(a){this.enableCommand(false,"OB_CREATE");$(a).setStyle({backgroundColor:"#FFF"})},enableCommand:function(a,b){a?$(this.id+"_apply_ontologytools").replace('<a style="margin-left: 10px;" id="'+
this.id+'_apply_ontologytools" onclick="'+this.objectname+'.doCommand()">'+gLanguage.getMessage(this.getCommandText())+"</a>"):$(this.id+"_apply_ontologytools").replace('<span style="margin-left: 10px;" id="'+this.id+'_apply_ontologytools">'+gLanguage.getMessage(b)+"</span>")},allIsValid:function(){return this.changedtitleInputValidator.isValid},requestTypes:function(){function a(b){this.builtinTypes=this.builtinTypes.concat(b.responseText.split(","));GeneralBrowserTools.setCookieObject("smwh_builtinTypes",
this.builtinTypes)}this.builtinTypes=GeneralBrowserTools.getCookieObject("smwh_builtinTypes");if(this.builtinTypes==null){this.builtinTypes=[];sajax_do_call("smwf_tb_GetBuiltinDatatypes",[],a.bind(this))}sajax_do_call("smwf_tb_GetUserDatatypes",[],function(b){b=b.responseText.split(",");b.shift();this.builtinTypes=this.builtinTypes.concat(b)}.bind(this))},onchangeTypeSelector:function(a){this.newType=a=$F(a.currentTarget);if(a.toLowerCase()==gLanguage.getMessage("PAGE_TYPE")){$("typeRange2_ontologytools").enable();
$("typeRange2_ontologytools").setStyle({backgroundColor:"#fff"});pageselected=true}else{$("typeRange2_ontologytools").value="";$("typeRange2_ontologytools").setStyle({backgroundColor:"#aaa"});$("typeRange2_ontologytools").disable();pageselected=false}if(a!=this.propertyType)typeChanged=true;if(a==this.propertyType)typeChanged=false;if(titleChanged==false&&cardChanged==false&&rangeChanged==false){typeChanged==true&&this.enableCommand(true,"OB_SAVE_CHANGES");typeChanged==false&&this.enableCommand(false,
"OB_SAVE_CHANGES")}},showRange:function(a){if(a==true){$("typeRange2_ontologytools").enable();$("typeRange2_ontologytools").setStyle({backgroundColor:"#fff"});$("typeRange2_ontologytools").value=this.propertyRange;pageselected=true}},newTypeInputBox:function(){this.typeOrRange=this.propertyType;for(var a=0,b=1;b<this.builtinTypes.length;b++)this.builtinTypes[b]==this.propertyType&&a++;if(a==0){this.newRange=this.propertyRange=this.propertyType;this.typeOrRange="Page"}a='<select id="typeRange'+this.count+
'_ontologytools" name="types'+this.count+'" onchange="obEditPropertiesMenuProvider.onchangeTypeSelector(event)" tabIndex="103">';a+="<option>"+this.typeOrRange+"</option>";for(b=1;b<this.builtinTypes.length;b++)if(this.builtinTypes[b]!=this.typeOrRange)a+="<option>"+this.builtinTypes[b]+"</option>";a+="</select>";return a},onchangeRangeSelector:function(a){a=$F(a.currentTarget);if(a!=this.propertyRange){rangeChanged=true;this.newRange=a}else rangeChanged=false;if(a==""){rangeChanged=true;this.newRange=
a}rangeChanged==true?this.enableCommand(true,"OB_SAVE_CHANGES"):this.enableCommand(false,"OB_SAVE_CHANGES")},newRangeInputBox:function(){return'<input class="wickEnabled" constraints="namespace: 14" disabled="false" type="text" id="typeRange'+(this.count+1)+'_ontologytools"'+this.count+'" onKeyup="obEditPropertiesMenuProvider.onchangeRangeSelector(event)" tabIndex="104"/>'},addType:function(){if(this.builtinTypes!=null){var a=$("typesAndRanges").firstChild==null?$("typesAndRanges"):$("typesAndRanges").firstChild;
$(a.appendChild(document.createElement("tr"))).replace('<tr><td width="60px;">Type </td><td>'+this.newTypeInputBox()+"</td></tr>");this.count++;this.adjustSize()}},addRange:function(){var a=$("typesAndRanges").firstChild==null?$("typesAndRanges"):$("typesAndRanges").firstChild;autoCompleter.deregisterAllInputs();$(a.appendChild(document.createElement("tr"))).replace('<tr><td width="60px;">'+gLanguage.getMessage("CATEGORY_NS_WOC")+" </td><td>"+this.newRangeInputBox()+"</td></tr>");autoCompleter.registerAllInputs();
this.rangeValidator[this.count]=new OBInputTitleValidator("typeRange"+this.count+"_ontologytools",gLanguage.getMessage("CATEGORY_NS_WOC"),false,this);this.enable(true,"typeRange"+this.count+"_ontologytools");this.count++;this.adjustSize()},removeTypeOrRange:function(a,b){if(b){var d=/typeRange(\d+)/.exec(a)[1];this.rangeValidator[d].deregisterListeners();this.rangeValidator[d]=null}for(d=$(a);d.parentNode.getAttribute("id")!="typesAndRanges";)d=d.parentNode;d.removeChild($(a).parentNode.parentNode);
this.enableCommand(this.allIsValid(),this.getCommandText());this.adjustSize()}});var obEditPropertiesMenuProvider=new OBEditPropertySubMenu("schemaPropertiesMenu","obEditPropertiesMenuProvider");var TreeTransformer=Class.create();
TreeTransformer.prototype={initialize:function(a){this.styleSheetPath=a;Event.observe(window,"load",this.initializeTree.bindAsEventListener(this));this.languageProvider=[]},initializeTree:function(){if(OB_bd.isKonqueror)alert(gLanguage.getMessage("KS_NOT_SUPPORTED"));else if(OB_bd.isGeckoOrOpera){this.OB_xsltProcessor_gecko=new XSLTProcessor;var a=new XMLHttpRequest;a.open("GET",wgServer+wgScriptPath+this.styleSheetPath,false);a.send(null);this.OB_xsltProcessor_gecko.importStylesheet(GeneralXMLTools.createDocumentFromString(a.responseText));this.OB_xsltProcessor_gecko.setParameter(null,
"param-img-directory",wgServer+wgScriptPath);this.OB_xsltProcessor_gecko.setParameter(null,"param-wiki-path",wgServer+wgArticlePath);this.OB_xsltProcessor_gecko.setParameter(null,"param-ns-concept",gLanguage.getMessage("CATEGORY_NS_WOC","cont"));this.OB_xsltProcessor_gecko.setParameter(null,"param-ns-property",gLanguage.getMessage("PROPERTY_NS_WOC","cont"))}else if(OB_bd.isIE){a=new ActiveXObject("MSXML2.FreeThreadedDOMDocument");a.async=false;a.load(wgServer+wgScriptPath+this.styleSheetPath);var b=
new ActiveXObject("MSXML2.XSLTemplate");b.stylesheet=a;this.OB_xsltProcessor_ie=b.createProcessor();this.OB_xsltProcessor_ie.addParameter("param-img-directory",wgServer+wgScriptPath);this.OB_xsltProcessor_ie.addParameter("param-wiki-path",wgServer+wgArticlePath);this.OB_xsltProcessor_ie.addParameter("param-ns-concept",gLanguage.getMessage("CATEGORY_NS_WOC","cont"));this.OB_xsltProcessor_ie.addParameter("param-ns-property",gLanguage.getMessage("PROPERTY_NS_WOC","cont"))}},addLanguageProvider:function(a){typeof a==
"function"&&this.languageProvider.push(a)},transformResultToHTML:function(a,b,d){if(a.status!=200)a.status==0?alert("Error: Could not connect to wiki. Webserver running?"):alert("Error: "+a.status+" "+a.statusText+": "+a.responseText);else if(a.responseText!="")if(OB_bd.isGecko){a=(new DOMParser).parseFromString(a.responseText,"text/xml");this.transformXMLToHTML(a,b,d?d:false);return a}else if(OB_bd.isIE){var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(a.responseText);this.transformXMLToHTML(e,
b,d?d:false);return e}},transformXMLToHTML:function(a,b,d){if(OB_bd.isGecko){this.OB_xsltProcessor_gecko.setParameter(null,"startDepth",d?1:2);a=this.OB_xsltProcessor_gecko.transformToFragment(a,document);GeneralXMLTools.removeAllChildNodes(b);b.appendChild(a);var e=/{{(\w+)}}/,f=this.languageProvider;GeneralXMLTools.getNodeByText(document,"{{").each(function(j){for(var k,m=j.textContent;k=e.exec(m);){var l=RegExp("{{"+k[1]+"}}","g"),n=gLanguage.getMessage(k[1]);if(n!=k[1])m=m.replace(l,n);f.each(function(o){o=
o(k[1]);if(o!=k[1])m=m.replace(l,o)})}j.textContent=m});b=GeneralXMLTools.getAttributeNodeByText(document,"{{");e=/{{(\w+)}}/;f=this.languageProvider;b.each(function(j){for(var k,m=j.textContent;k=e.exec(m);){var l=RegExp("{{"+k[1]+"}}","g"),n=gLanguage.getMessage(k[1]);m=n!=k[1]?m.replace(l,n):m.replace(l,"!!"+n+"!!");f.each(function(o){o=o(k[1]);m=o!=k[1]?m.replace(l,o):m.replace(l,"!!"+o+"!!")})}j.textContent=m})}else if(OB_bd.isIE){this.OB_xsltProcessor_ie.addParameter("startDepth",d?1:2);this.OB_xsltProcessor_ie.input=
a;this.OB_xsltProcessor_ie.transform();a=0;for(d=b.childNodes.length;a<d;a++)GeneralBrowserTools.purge(b.childNodes[a]);d=this.OB_xsltProcessor_ie.output;e=/{{(\w+)}}/;for(var g;g=e.exec(d);){var h=gLanguage.getMessage(g[1]);if(h!=g[1])d=d.replace(RegExp("{{"+g[1]+"}}","g"),h);f=this.languageProvider;for(a=0;a<f.length;a++){h=f[a](g[1]);if(h!=g[1])d=d.replace(RegExp("{{"+g[1]+"}}","g"),h)}}b.innerHTML=d}}};var transformer=new TreeTransformer("/extensions/SMWHalo/skins/OntologyBrowser/treeview.xslt");
function resetOntologyBrowser(){dataAccess.OB_categoriesInitialized=false;dataAccess.OB_attributesInitialized=false;if(globalActionListener.activeTreeName=="categoryTree")dataAccess.initializeRootCategories(0,true);else globalActionListener.activeTreeName=="propertyTree"&&dataAccess.initializeRootProperties(0,true);$("instanceList")!=null&&$("instanceList").down()!=null&&$("instanceList").down().remove();$("relattributes")!=null&&$("relattributes").down()!=null&&$("relattributes").down().remove()}
Event.observe(window,"load",function(){dataAccess=new OBDataAccess;dataAccess.initializeTree(null);var a=$("FilterBrowserInput");Event.observe(a,"keyup",globalActionListener.filterBrowsing.bindAsEventListener(globalActionListener,false));a=$("directPropertySwitch");Event.observe(a,"change",schemaActionPropertyListener.reloadProperties.bindAsEventListener(schemaActionPropertyListener,false));a=$("showForRange");Event.observe(a,"change",schemaActionPropertyListener.reloadProperties.bindAsEventListener(schemaActionPropertyListener,
false))});var OB_LEFT_ARROW=0,OB_RIGHT_ARROW=0,editOpened=false,addOpened=false,OBTreeActionListener=Class.create();
OBTreeActionListener.prototype={initialize:function(){this.OB_currentFilter=null},selectionChanged:function(){},_toggleExpand:function(a,b,d,e){Event.stop(a);for(var f=b.nextSibling;f.nodeName!="DIV";)f=f.nextSibling;if(f.style.display=="none"){if(b.childNodes.length>0)if(b.childNodes.item(0).nodeName=="IMG")b.childNodes.item(0).src=GeneralTools.getImgDirectory(b.childNodes.item(0).src)+"minus.gif";a=b.getAttribute("title");var g=b.getAttribute("id"),h=function(k){OB_tree_pendingIndicator.hide();
var m=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree.firstChild,g),l=GeneralXMLTools.getNodeById(d.firstChild,g);if(k.responseText.indexOf("noResult")!=-1){b.childNodes.item(0).style.visibility="hidden";m.setAttribute("isLeaf","true");l.setAttribute("isLeaf","true")}else{selectionProvider.fireBeforeRefresh();k=transformer.transformResultToHTML(k,f);selectionProvider.fireRefresh();GeneralXMLTools.importSubtree(m,k.firstChild);GeneralXMLTools.importSubtree(l,k.firstChild)}},j=function(k){transformer.transformXMLToHTML(k,
f,false);Element.show(f)};if(!f.hasChildNodes()){OB_tree_pendingIndicator.show(globalActionListener.activeTreeName);e(g,a,h,j)}Element.show(f);e=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree.firstChild,g);e.setAttribute("expanded","true");e=GeneralXMLTools.getNodeById(d.firstChild,g);e.setAttribute("expanded","true")}else{Element.hide(f);if(b.childNodes.length>0){if(b.childNodes.item(0).nodeName=="IMG")b.childNodes.item(0).src=GeneralTools.getImgDirectory(b.childNodes.item(0).src)+
"plus.gif";a=b.getAttribute("title");g=b.getAttribute("id");e=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree.firstChild,g);e.setAttribute("expanded","false");e=GeneralXMLTools.getNodeById(d.firstChild,g);e.setAttribute("expanded","false")}}},_selectNextPartition:function(a,b,d,e,f,g){a=b.getAttribute("id");b=b.getAttribute("partitionnum");var h=GeneralXMLTools.getNodeById(d,a);a=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a);var j=h.parentNode,k=a.parentNode,
m=k.getAttribute("id");b++;a=k.tagName=="result";OB_tree_pendingIndicator.show(globalActionListener.activeTreeName);e(a,b,k.getAttribute("title"),function(l){OB_tree_pendingIndicator.hide();var n=GeneralXMLTools.createDocumentFromString(l.responseText);l=GeneralXMLTools.createDocumentFromString(l.responseText);var o=j.tagName=="result",u;if(o){u=document.getElementById(f);d=n;dataAccess.OB_currentlyDisplayedTree=l}else{u=GeneralBrowserTools.nextDIV(document.getElementById(m));GeneralXMLTools.removeAllChildNodes(j);
GeneralXMLTools.importSubtree(j,n.firstChild);GeneralXMLTools.removeAllChildNodes(k);GeneralXMLTools.importSubtree(k,l.firstChild)}selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(l,u,o);selectionProvider.fireRefresh();g(d)})},_selectPreviousPartition:function(a,b,d,e,f,g){a=b.getAttribute("id");b=b.getAttribute("partitionnum");var h=GeneralXMLTools.getNodeById(d,a);a=GeneralXMLTools.getNodeById(dataAccess.OB_currentlyDisplayedTree,a);var j=h.parentNode,k=a.parentNode,m=k.getAttribute("id");
if(b!=0){b--;a=k.tagName=="result";OB_tree_pendingIndicator.show(globalActionListener.activeTreeName);e(a,b,k.getAttribute("title"),function(l){OB_tree_pendingIndicator.hide();var n=GeneralXMLTools.createDocumentFromString(l.responseText);l=GeneralXMLTools.createDocumentFromString(l.responseText);var o=j.tagName=="result",u;if(o){u=document.getElementById(f);d=n;dataAccess.OB_currentlyDisplayedTree=l}else{u=GeneralBrowserTools.nextDIV(document.getElementById(m));GeneralXMLTools.removeAllChildNodes(j);
GeneralXMLTools.importSubtree(j,n.firstChild);GeneralXMLTools.removeAllChildNodes(k);GeneralXMLTools.importSubtree(k,l.firstChild)}selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(l,u,o);selectionProvider.fireRefresh();g(d)})}},_filterTree:function(a,b,d,e){a=GeneralXMLTools.createTreeViewDocument();var f=[],g=[],h=GeneralTools.splitSearchTerm(e);e=0;for(var j=h.length;e<j;e++)try{g[e]=RegExp(h[e],"i")}catch(k){return}this._filterTree_(f,b.firstChild,0,g);for(e=0;e<f.length;e++){b=
GeneralXMLTools.getAllParents(f[e]);GeneralXMLTools.addBranch(a.firstChild,b)}b=document.getElementById(d);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(a,b,true);selectionProvider.fireRefresh();if(d=="categoryTree")selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null);else d=="propertyTree"&&selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null);dataAccess.OB_currentlyDisplayedTree=a},_filterTree_:function(a,b,d,e){var f=b.childNodes;if(f)for(var g=
0;g<f.length;g++)if(f[g].tagName!="gissues")d=this._filterTree_(a,f[g],d,e);f=b.getAttribute("title");if(f!=null&&GeneralTools.matchArrayOfRegExp(f,e)){a[d]=b;d++}return d},_filterRootLevel:function(a,b,d){if(!(OB_bd.isIE&&a.type!="click"&&a.keyCode!=13))if(!(OB_bd.isGeckoOrOpera&&a.type!="click"&&a.which!=13)){xmlDoc=GeneralXMLTools.createTreeViewDocument();a=document.getElementsByTagName("input");this.OB_currentFilter=a[0].value;b=b.firstChild.childNodes;for(var e=0;e<b.length;e++)if(b[e].getAttribute("title")){if(b[e].getAttribute("title").indexOf(a[0].value)!=
-1){b[e].childNodes.length>0&&b[e].setAttribute("expanded","true");if(OB_bd.isGeckoOrOpera)xmlDoc.firstChild.appendChild(document.importNode(b[e],true));else OB_bd.isIE&&xmlDoc.firstChild.appendChild(b[e].cloneNode(true))}}else if(OB_bd.isGeckoOrOpera)xmlDoc.firstChild.appendChild(document.importNode(b[e],true));else OB_bd.isIE&&xmlDoc.firstChild.appendChild(b[e].cloneNode(true));d=document.getElementById(d);transformer.transformXMLToHTML(xmlDoc,d,true);dataAccess.OB_currentlyDisplayedTree=xmlDoc}}};
var OBCategoryTreeActionListener=Class.create();
OBCategoryTreeActionListener.prototype=Object.extend(new OBTreeActionListener,{initialize:function(){this.selectedCategoryURI=this.oldSelectedNode=this.selectedCategoryID=this.selectedCategory=null;this.draggableCategories=[];selectionProvider.addListener(this,OB_SELECTIONLISTENER);selectionProvider.addListener(this,OB_REFRESHLISTENER);selectionProvider.addListener(this,OB_BEFOREREFRESHLISTENER);this.ignoreNextSelection=false;Draggables.addObserver(this);Droppables.add("categoryTreeSwitch",{accept:"concept",
hoverclass:"dragHover",onDrop:this.onDrop.bind(this)})},toggleExpand:function(a,b){this._toggleExpand(a,b,dataAccess.OB_cachedCategoryTree,dataAccess.getCategorySubTree.bind(dataAccess))},navigateToEntity:function(a,b,d,e){smwhgLogger.log(d,"OB","inspect_entity");GeneralBrowserTools.navigateToPage(gLanguage.getMessage("CATEGORY_NS_WOC"),d,e)},selectionChanged:function(a,b,d,e){if(d==SMW_CATEGORY_NS){this.selectedCategory=b;this.selectedCategoryID=a;this.oldSelectedNode=GeneralBrowserTools.toggleHighlighting(this.oldSelectedNode,
e)}},beforeRefresh:function(){if(!(wgUserGroups==null||wgUserGroups.indexOf("sysop")==-1&&wgUserGroups.indexOf("gardener")==-1))if(!OB_bd.isIE){this.draggableCategories.each(function(a){a.destroy()});$$("a.concept").each(function(a){Droppables.remove(a.getAttribute("id"))});this.draggableCategories=[]}},refresh:function(){if(!(wgUserGroups==null||wgUserGroups.indexOf("sysop")==-1&&wgUserGroups.indexOf("gardener")==-1))if(!OB_bd.isIE){var a=function(d){this.draggableCategories.push(new Draggable(d.getAttribute("id"),
{revert:true,ghosting:true}));Droppables.add(d.getAttribute("id"),{accept:"concept",hoverclass:"dragHover",onDrop:b})}.bind(this),b=this.onDrop.bind(this);$$("a.concept").each(a)}},onStart:function(a,b){if(b.element.hasClassName("concept"))this.ignoreNextSelection=true},onDrop:function(a,b){var d=a.getAttribute("id"),e=b.getAttribute("id");ontologyTools.moveCategory(d,e)},showSubMenu:function(a){this.selectedCategory==null?alert(gLanguage.getMessage("OB_SELECT_CATEGORY")):obCategoryMenuProvider.showContent(a,
"categoryTree")},select:function(a,b,d,e){if(this.ignoreNextSelection&&OB_bd.isGecko)this.ignoreNextSelection=false;else if(GeneralTools.getEvent(a).ctrlKey)GeneralBrowserTools.navigateToPage(gLanguage.getMessage("CATEGORY_NS_WOC"),e);else{for(var f=b.nextSibling;f.nodeName!="DIV";)f=f.nextSibling;selectionProvider.fireSelectionChanged(d,e,SMW_CATEGORY_NS,b);this.selectedCategoryURI=b.getAttribute("uri");selectionProvider.fireSelectedTripleChanged(null,"rdf:type",this.selectedCategoryURI);if(!f.hasChildNodes()||
f.style.display=="none")this.toggleExpand(a,b,d);var g=document.getElementById("instanceList"),h=document.getElementById("relattributes");if(!$("relattRangeType").visible()){$("relattRangeType").show();$("relattValues").hide()}smwhgLogger.log(e,"OB","clicked");b=function(j){OB_instance_pendingIndicator.hide();if(g.firstChild){GeneralBrowserTools.purge(g.firstChild);g.removeChild(g.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedInstances=k;selectionProvider.fireBeforeRefresh();
transformer.transformResultToHTML(j,g,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)};a=function(j){OB_relatt_pendingIndicator.hide();if(h.firstChild){GeneralBrowserTools.purge(h.firstChild);h.removeChild(h.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedProperties=k;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,h);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,
null,SMW_PROPERTY_NS,null)};if(OB_LEFT_ARROW==0)if($("hideInstancesButton").getAttribute("hidden")!="true"){OB_instance_pendingIndicator.show();d=$("assertedCategoriesSwitch").checked;dataAccess.getInstances(e,0,d,b)}if(OB_RIGHT_ARROW==0){OB_relatt_pendingIndicator.show();b=!$("directPropertySwitch").checked;d=$("showForRange").checked?"_2":"_1";dataAccess.getProperties(e,b,d,a)}}},selectNextPartition:function(a,b){this._selectNextPartition(a,b,dataAccess.OB_cachedCategoryTree,dataAccess.getCategoryPartition.bind(dataAccess),
"categoryTree",function(d){dataAccess.OB_cachedCategoryTree=d;selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)})},selectPreviousPartition:function(a,b){this._selectPreviousPartition(a,b,dataAccess.OB_cachedCategoryTree,dataAccess.getCategoryPartition.bind(dataAccess),"categoryTree",function(d){dataAccess.OB_cachedCategoryTree=d;selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)})}});var OBInstanceActionListener=Class.create();
OBInstanceActionListener.prototype={initialize:function(){this.selectedInstanceURI=this.oldSelectedInstance=this.selectedInstance=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},navigateToEntity:function(a,b,d,e){smwhgLogger.log(d,"OB","inspect_entity");GeneralBrowserTools.navigateToPage(null,d,e)},selectionChanged:function(a,b,d,e){if(d==SMW_INSTANCE_NS){this.selectedInstance=b;this.oldSelectedInstance=GeneralBrowserTools.toggleHighlighting(this.oldSelectedInstance,e)}else if(d==SMW_CATEGORY_NS)this.selectedCategory=
b},showSubMenu:function(a){if(this.selectedInstance==null&&a!=SMW_OB_COMMAND_INSTANCE_CREATE)alert(gLanguage.getMessage("OB_SELECT_INSTANCE"));else this.selectedCategory==null&&a==SMW_OB_COMMAND_INSTANCE_CREATE?alert(gLanguage.getMessage("OB_SELECT_CATEGORY")):obInstanceMenuProvider.showContent(a,"instanceList")},showSuperCategory:function(a,b,d){globalActionListener.switchTreeComponent(null,"categoryTree",true);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","category##"+d,obAdvancedOptions.getDataSource()],
function(e){var f=$("categoryTree");if(f.firstChild){GeneralBrowserTools.purge(f.firstChild);f.removeChild(f.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(e.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(e.responseText,f)})},selectInstance:function(a,b,d,e,f){if(GeneralTools.getEvent(a).ctrlKey)GeneralBrowserTools.navigateToPage(null,e);else{if(!$("relattValues").visible()){$("relattValues").show();$("relattRangeType").hide()}var g=
$("relattributes"),h=$("categoryTree");selectionProvider.fireSelectionChanged(d,f+":"+e,SMW_INSTANCE_NS,b);this.selectedInstanceURI=b.getAttribute("uri");selectionProvider.fireSelectedTripleChanged(this.selectedInstanceURI,"rdf:type",categoryActionListener.selectedCategoryURI);smwhgLogger.log(e,"OB","clicked");a=function(m){OB_relatt_pendingIndicator.hide();if(g.firstChild){GeneralBrowserTools.purge(g.firstChild);g.removeChild(g.firstChild)}var l=GeneralXMLTools.createDocumentFromString(m.responseText);
dataAccess.OB_cachedProperties=l;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(m,g);OB_bd.isGecko&&GeneralBrowserTools.repasteMarkup("needRepaste");selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)};d=function(m){OB_tree_pendingIndicator.hide();if(h.firstChild){GeneralBrowserTools.purge(h.firstChild);h.removeChild(h.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(m.responseText);selectionProvider.fireBeforeRefresh();
dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(m.responseText,h);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)};if(OB_RIGHT_ARROW==0){OB_relatt_pendingIndicator.show();var j=b.getAttribute("uri")==null?f+":"+e:b.getAttribute("uri"),k=!$("directPropertySwitch").checked;dataAccess.getAnnotations(j,k,a)}if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();j=b.getAttribute("uri")==null?f+":"+e:b.getAttribute("uri");sajax_do_call("smwf_ob_OntologyBrowserAccess",
["getCategoryForInstance",j,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],d)}}},selectNextPartition:function(a,b){var d=b.getAttribute("partitionnum"),e=b.getAttribute("dataSrc");d++;OB_instance_pendingIndicator.show();if(e){e=e.split(",");if(e.shift()=="getInstancesUsingProperty"){dataAccess.getInstancesUsingProperty(e[0],d,this.selectPartitionCallback.bind(this));return}}if(globalActionListener.activeTreeName=="categoryTree"){e=$("assertedCategoriesSwitch").checked;dataAccess.getInstances(categoryActionListener.selectedCategory,
d,e,this.selectPartitionCallback.bind(this))}else globalActionListener.activeTreeName=="propertyTree"&&dataAccess.getInstancesUsingProperty(propertyActionListener.selectedProperty,d,this.selectPartitionCallback.bind(this))},selectPreviousPartition:function(a,b){var d=b.getAttribute("partitionnum");d--;OB_instance_pendingIndicator.show();if(globalActionListener.activeTreeName=="categoryTree"){var e=$("assertedCategoriesSwitch").checked;dataAccess.getInstances(categoryActionListener.selectedCategory,
d,e,this.selectPartitionCallback.bind(this))}else globalActionListener.activeTreeName=="propertyTree"&&dataAccess.getInstancesUsingProperty(propertyActionListener.selectedProperty,d,this.selectPartitionCallback.bind(this))},selectPartitionCallback:function(a){OB_instance_pendingIndicator.hide();var b=$("instanceList");GeneralXMLTools.removeAllChildNodes(b);a=GeneralXMLTools.createDocumentFromString(a.responseText);dataAccess.OB_cachedInstances=a;selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(a,
b,true);selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null);selectionProvider.fireRefresh();b.scrollTop=0},toggleInstanceBox:function(){if($("instanceContainer").visible()){$("hideInstancesButton").innerHTML=gLanguage.getMessage("SHOW_INSTANCES");$("hideInstancesButton").setAttribute("hidden","true");Effect.Fold("instanceContainer");Effect.Fold($("leftArrow"))}else{$("hideInstancesButton").removeAttribute("hidden");new Effect.Grow("instanceContainer");$("hideInstancesButton").innerHTML=
gLanguage.getMessage("HIDE_INSTANCES");new Effect.Grow($("leftArrow"))}},toggleMetadata:function(a,b,d){d=$(d);var e=$("instanceList").scrollTop,f=Event.pointerX(a)+16;a=Event.pointerY(a)+16-e;d.style.top=a+"px";d.style.left=f+"px";if(d.visible()){d.hide();b.removeClassName("metadataContainerSelected")}else{d.show();b.addClassName("metadataContainerSelected")}}};var OBEditPropertyActionListener=Class.create();
OBEditPropertyActionListener.prototype={initialize:function(){this.oldSelectedProperty=this.selectedCategory=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},selectionChanged:function(a,b,d,e){if(d==SMW_CATEGORY_NS){this.selectedCategory=b;a=$("currentSelectedCategory");if(a!=null)a.innerHTML=b==null?"...":"'"+b+"'"}else if(d==SMW_PROPERTY_NS)this.oldSelectedProperty=GeneralBrowserTools.toggleHighlighting(this.oldSelectedProperty,e)},showSubMenu:function(a){this.selectedCategory==null?
alert(gLanguage.getMessage("OB_SELECT_CATEGORY")):obEditPropertiesMenuProvider.showContent(a,"relattributes")},showSubMenuProperty:function(a,b,d,e,f){if(this.selectedCategory==null)alert(gLanguage.getMessage("OB_SELECT_CATEGORY"));else{addOpened==true&&obSchemaPropertiesMenuProvider.cancel();editOpened=true;obEditPropertiesMenuProvider.showContentProperty(a,"relattributes",d,e,f)}},navigateToEntity:function(a,b,d,e){smwhgLogger.log(d,"OB","inspect_entity");GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),
d,e)},selectProperty:function(a,b,d){function e(j){OB_tree_pendingIndicator.hide();if(g.firstChild){GeneralBrowserTools.purge(g.firstChild);g.removeChild(g.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(j.responseText,g);selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}function f(j){OB_instance_pendingIndicator.hide();if(h.firstChild){GeneralBrowserTools.purge(h.firstChild);
h.removeChild(h.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedInstances=k;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,h,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}var g=$("categoryTree"),h=$("instanceList");selectionProvider.fireSelectionChanged(null,d,SMW_PROPERTY_NS,b);smwhgLogger.log(d,"OB","clicked");if(a.ctrlKey)GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),
d);else{if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",d,obAdvancedOptions.getDataSource()],e)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstancesUsingProperty(d,0,f)}}},selectRangeInstance:function(a,b,d){a.ctrlKey&&GeneralBrowserTools.navigateToPage(gLanguage.getMessage("CATEGORY_NS_WOC"),d)},selectedNavigationSwitch:function(a,b,d,e,f,g,h){function j(n){OB_tree_pendingIndicator.hide();if(m.firstChild){GeneralBrowserTools.purge(m.firstChild);
m.removeChild(m.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(n.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(n.responseText,m);selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}function k(n){OB_instance_pendingIndicator.hide();if(l.firstChild){GeneralBrowserTools.purge(l.firstChild);l.removeChild(l.firstChild)}var o=GeneralXMLTools.createDocumentFromString(n.responseText);dataAccess.OB_cachedInstances=o;selectionProvider.fireBeforeRefresh();
transformer.transformResultToHTML(n,l,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}var m=$("categoryTree"),l=$("instanceList");if(g==0){if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",e,obAdvancedOptions.getDataSource()],j)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstancesUsingProperty(e,0,k)}}else if(g==1){if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();
sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",e,obAdvancedOptions.getDataSource()],j)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstanceUsingPropertyValue(e,f=="null"?h:f,0,k)}}},reloadProperties:function(){var a=document.getElementById("relattributes");OB_relatt_pendingIndicator.show();var b=!$("directPropertySwitch").checked,d=$("showForRange").checked?"_2":"_1";dataAccess.getProperties(this.selectedCategory,b,d,function(e){OB_relatt_pendingIndicator.hide();
if(a.firstChild){GeneralBrowserTools.purge(a.firstChild);a.removeChild(a.firstChild)}var f=GeneralXMLTools.createDocumentFromString(e.responseText);dataAccess.OB_cachedProperties=f;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(e,a);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)})}};var OBPropertyTreeActionListener=Class.create();
OBPropertyTreeActionListener.prototype=Object.extend(new OBTreeActionListener,{initialize:function(){this.oldSelectedProperty=this.selectedPropertyID=this.selectedProperty=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER);selectionProvider.addListener(this,OB_REFRESHLISTENER);selectionProvider.addListener(this,OB_BEFOREREFRESHLISTENER);Draggables.addObserver(this);this.draggableProperties=[];Droppables.add("propertyTreeSwitch",{accept:"property",hoverclass:"dragHover",onDrop:this.onDrop.bind(this)})},
navigateToEntity:function(a,b,d,e){smwhgLogger.log(d,"OB","inspect_entity");GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),d,e)},selectionChanged:function(a,b,d,e){if(d==SMW_PROPERTY_NS){this.selectedProperty=b;this.selectedPropertyID=a;this.oldSelectedProperty=GeneralBrowserTools.toggleHighlighting(this.oldSelectedProperty,e)}},beforeRefresh:function(){if(!(wgUserGroups==null||wgUserGroups.indexOf("sysop")==-1&&wgUserGroups.indexOf("gardener")==-1))if(!OB_bd.isIE){this.draggableProperties.each(function(a){a.destroy()});
$$("a.property").each(function(a){Droppables.remove(a.getAttribute("id"))});this.draggableProperties=[]}},refresh:function(){if(!(wgUserGroups==null||wgUserGroups.indexOf("sysop")==-1&&wgUserGroups.indexOf("gardener")==-1))if(!OB_bd.isIE){var a=function(d){this.draggableProperties.push(new Draggable(d.getAttribute("id"),{revert:true,ghosting:true}));Droppables.add(d.getAttribute("id"),{accept:"property",hoverclass:"dragHover",onDrop:b})}.bind(this),b=this.onDrop.bind(this);$$("a.property").each(a)}},
onStart:function(){},onDrop:function(a,b){var d=a.getAttribute("id"),e=b.getAttribute("id");ontologyTools.moveProperty(d,e)},showSubMenu:function(a){this.selectedProperty==null?alert(gLanguage.getMessage("OB_SELECT_PROPERTY")):obPropertyMenuProvider.showContent(a,"propertyTree")},select:function(a,b,d,e){if(GeneralTools.getEvent(a).ctrlKey)GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),e);else{for(var f=b.nextSibling;f.nodeName!="DIV";)f=f.nextSibling;if(!f.hasChildNodes()||
f.style.display=="none")this.toggleExpand(a,b,d);var g=document.getElementById("instanceList"),h=$("relattributes");selectionProvider.fireSelectionChanged(d,e,SMW_PROPERTY_NS,b);smwhgLogger.log(e,"OB","clicked");d=function(j){OB_instance_pendingIndicator.hide();if(g.firstChild){GeneralBrowserTools.purge(g.firstChild);g.removeChild(g.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedInstances=k;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,
g,true);selectionProvider.fireRefresh()};a=function(j){OB_relatt_pendingIndicator.hide();if(h.firstChild){GeneralBrowserTools.purge(h.firstChild);h.removeChild(h.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedProperties=k;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,h);selectionProvider.fireRefresh();jQuery(".annotation").each(function(){var m=$(this.getAttribute("id"));if(m){var l=m.getAttribute("uri"),n=m.getAttribute("title"),
o=m.parentNode.nextSibling;m=o.getAttribute("uri");o.getAttribute("typeURI");o=o.textContent.trim();l=jQuery("<a onclick=\"schemaActionPropertyListener.selectedNavigationSwitch(event, this, '"+l+"', '"+n+"', '"+m+"', 0, '"+o+"')\">Select all</a><br><a onclick=\"schemaActionPropertyListener.selectedNavigationSwitch(event, this, '"+l+"', '"+n+"', '"+m+"', 1, '"+o+"')\">Select one</a>");jQuery(this).qtip({content:l,show:{effect:{length:500},when:{event:"mouseover"}},hide:{when:{event:"mouseout"},fixed:true},
position:{corner:{target:"topLeft",tooltip:"bottomLeft"}},style:{tip:"bottomLeft",width:{max:500}}})}})};if(OB_LEFT_ARROW==0){OB_instance_pendingIndicator.show();dataAccess.getInstancesUsingProperty(e,0,d);selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}if(OB_RIGHT_ARROW==0){OB_relatt_pendingIndicator.show();b=b.getAttribute("uri")==null?gLanguage.getMessage("PROPERTY_NS")+e:b.getAttribute("uri");dataAccess.getPropertyValues(b,a)}}},toggleExpand:function(a,b){this._toggleExpand(a,
b,dataAccess.OB_cachedPropertyTree,dataAccess.getPropertySubTree.bind(dataAccess))},selectNextPartition:function(a,b){this._selectNextPartition(a,b,dataAccess.OB_cachedPropertyTree,dataAccess.getPropertyPartition.bind(dataAccess),"propertyTree",function(d){dataAccess.OB_cachedPropertyTree=d;selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null);$("propertyTree").scrollTop=0})},selectPreviousPartition:function(a,b){this._selectPreviousPartition(a,b,dataAccess.OB_cachedPropertyTree,
dataAccess.getPropertyPartition.bind(dataAccess),"propertyTree",function(d){dataAccess.OB_cachedPropertyTree=d;selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null);$("propertyTree").scrollTop=0})}});var OBAnnotationActionListener=Class.create();
OBAnnotationActionListener.prototype={initialize:function(){},navigateToTarget:function(a,b,d){GeneralBrowserTools.navigateToPage(null,d)},selectProperty:function(a,b,d){var e=b.getAttribute("uri"),f=b.parentNode.nextSibling,g=f.getAttribute("uri"),h=f.getAttribute("typeURI");f=f.textContent.trim();selectionProvider.fireSelectedTripleChanged(instanceActionListener.selectedInstanceURI,e,g==null?'"'+f+'"^^'+h:g);schemaActionPropertyListener.selectProperty(a,b,d)},toggleMetadata:function(a,b,d){d=$(d);
var e=$("instanceList").scrollTop,f=Event.pointerX(a)+16;a=Event.pointerY(a)+16-e;d.style.top=a+"px";d.style.left=f+"px";if(d.visible()){d.hide();b.removeClassName("metadataContainerSelected")}else{d.show();b.addClassName("metadataContainerSelected")}}};var OBSchemaPropertyActionListener=Class.create();
OBSchemaPropertyActionListener.prototype={initialize:function(){this.oldSelectedProperty=this.selectedCategory=null;selectionProvider.addListener(this,OB_SELECTIONLISTENER)},selectionChanged:function(a,b,d,e){if(d==SMW_CATEGORY_NS){this.selectedCategory=b;a=$("currentSelectedCategory");if(a!=null)a.innerHTML=b==null?"...":"'"+b+"'"}else if(d==SMW_PROPERTY_NS)this.oldSelectedProperty=GeneralBrowserTools.toggleHighlighting(this.oldSelectedProperty,e)},showSubMenu:function(a){if(this.selectedCategory==
null)alert(gLanguage.getMessage("OB_SELECT_CATEGORY"));else{editOpened==true&&obEditPropertiesMenuProvider.cancel();addOpened=true;obSchemaPropertiesMenuProvider.showContent(a,"relattributes")}},navigateToEntity:function(a,b,d,e){smwhgLogger.log(d,"OB","inspect_entity");GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),d,e)},selectProperty:function(a,b,d){function e(j){OB_tree_pendingIndicator.hide();if(g.firstChild){GeneralBrowserTools.purge(g.firstChild);g.removeChild(g.firstChild)}dataAccess.OB_cachedCategoryTree=
GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(j.responseText,g);selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}function f(j){OB_instance_pendingIndicator.hide();if(h.firstChild){GeneralBrowserTools.purge(h.firstChild);h.removeChild(h.firstChild)}var k=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedInstances=k;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,
h,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}var g=$("categoryTree"),h=$("instanceList");selectionProvider.fireSelectionChanged(null,d,SMW_PROPERTY_NS,b);smwhgLogger.log(d,"OB","clicked");if(a.ctrlKey)GeneralBrowserTools.navigateToPage(gLanguage.getMessage("PROPERTY_NS_WOC"),d);else{if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",d,obAdvancedOptions.getDataSource(),
obAdvancedOptions.getBundle()],e)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstancesUsingProperty(d,0,f)}}},selectRangeInstance:function(a,b,d){a.ctrlKey&&GeneralBrowserTools.navigateToPage(gLanguage.getMessage("CATEGORY_NS_WOC"),d)},selectedNavigationSwitch:function(a,b,d,e,f,g,h){function j(n){OB_tree_pendingIndicator.hide();if(m.firstChild){GeneralBrowserTools.purge(m.firstChild);m.removeChild(m.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(n.responseText);
dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(n.responseText,m);selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}function k(n){OB_instance_pendingIndicator.hide();if(l.firstChild){GeneralBrowserTools.purge(l.firstChild);l.removeChild(l.firstChild)}var o=GeneralXMLTools.createDocumentFromString(n.responseText);dataAccess.OB_cachedInstances=o;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(n,l,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,
null,SMW_INSTANCE_NS,null)}var m=$("categoryTree"),l=$("instanceList");if(g==0){if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",e,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],j)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstancesUsingProperty(e,0,k)}}else if(g==1){if(OB_LEFT_ARROW==1){OB_tree_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getCategoryForProperty",
e,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],j)}if(OB_RIGHT_ARROW==1){OB_instance_pendingIndicator.show();dataAccess.getInstanceUsingPropertyValue(e,f=="null"?h:f,0,k)}}},reloadProperties:function(){var a=document.getElementById("relattributes");OB_relatt_pendingIndicator.show();var b=!$("directPropertySwitch").checked,d=$("showForRange").checked?"_2":"_1";dataAccess.getProperties(this.selectedCategory,b,d,function(e){OB_relatt_pendingIndicator.hide();if(a.firstChild){GeneralBrowserTools.purge(a.firstChild);
a.removeChild(a.firstChild)}var f=GeneralXMLTools.createDocumentFromString(e.responseText);dataAccess.OB_cachedProperties=f;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(e,a);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)})}};var OBGlobalActionListener=Class.create();
OBGlobalActionListener.prototype={initialize:function(){this.activeTreeName="categoryTree";new Form.Element.Observer($("treeFilter"),0.5,this.filterTree.bindAsEventListener(this));new Form.Element.Observer($("instanceFilter"),0.5,this.filterInstances.bindAsEventListener(this));new Form.Element.Observer($("propertyFilter"),0.5,this.filterProperties.bindAsEventListener(this));Event.observe(document,"keydown",function(a){a.target&&a.target.localName=="HTML"&&$("FilterBrowserInput").focus();a.keyCode==
27&&this.closeAllMetadataviews()}.bind(this));selectionProvider.addListener(this,OB_REFRESHLISTENER);selectionProvider.addListener(this,OB_SELECTEDTRIPLELISTENER)},selectedTripleChanged:function(){},refresh:function(){_smw_hideAllTooltips();smw_tooltipInit();jQuery(".metadataContainerSwitch").each(function(){var a=this.getAttribute("subjectid"),b=this.getAttribute("subjecttype"),d=this.getAttribute("data");a=jQuery("<a onclick=\"globalActionListener.selectedMetadataSwitch(event, '"+a+"', '"+b+"', 0, '"+
d+"')\">"+gLanguage.getMessage("SMW_OB_META_COMMAND_SHOW")+"</a><br><a onclick=\"globalActionListener.selectedMetadataSwitch(event, '"+a+"', '"+b+"', 1, '"+d+"')\">"+gLanguage.getMessage("SMW_OB_META_COMMAND_RATE")+"</a>");jQuery(this).qtip({content:a,show:{effect:{length:500},when:{event:"mouseover"}},hide:{when:{event:"click"},fixed:true},position:{corner:{target:"topLeft",tooltip:"bottomLeft"}},style:{tip:"bottomLeft",width:{max:500}}})})},selectedMetadataSwitch:function(a,b,d,e,f){if(e==0)switch(d){case "instance":instanceActionListener.toggleMetadata(a,
$(b),f);break;case "annotation":annotationActionListener.toggleMetadata(a,$(b),f);break}else if(e==1){switch(d){case "instance":var g=$(b).getAttribute("uri"),h="rdf:type",j=categoryActionListener.selectedCategoryURI,k=$(b).innerHTML;break;case "annotation":g=instanceActionListener.selectedInstanceURI;h=$(b).getAttribute("uri");b=$(b);b.getAttribute("uri");a=b.parentNode.nextSibling.firstChild;b=b.parentNode.nextSibling;if(a.nodeType==3)var m=b.getAttribute("typeURI"),l=b.textContent.trim();else var n=
a.getAttribute("uri");j=n==null?'"'+l+'"^^'+m:n;k=l;break}typeof LOD!=="undefined"&&LOD.ratingEditor.selectedTripleInOB(g,h,j,k)}},switchTreeComponent:function(a,b,d){$$(".treeContainer").each(function(e){e.hide()});$(b).show();$(b+"Switch").addClassName("selectedSwitch");$$(".treeSwitch").each(function(e){e.id!=b+"Switch"&&e.removeClassName("selectedSwitch")});$$(".menuBarTree").each(function(e){e.hide()});(a=$("menuBar"+b))&&a.show();this.activeTreeName=b;if(!d)if(b=="categoryTree"){dataAccess.initializeRootCategories(0);
$("instanceContainer").show();$("rightArrow").show();$("relattributesContainer").show()}else if(b=="propertyTree"){dataAccess.initializeRootProperties(0);$("instanceContainer").show();$("rightArrow").show();$("relattributesContainer").show()}selectionProvider.fireTreeTabChanged(b)},filterTree:function(a){var b=$F("treeFilter"),d,e;if(this.activeTreeName=="categoryTree"){e=categoryActionListener;d=dataAccess.OB_cachedCategoryTree;if(b==""){dataAccess.initializeRootCategories(0);selectionProvider.fireBeforeRefresh();
transformer.transformXMLToHTML(dataAccess.OB_currentlyDisplayedTree,$(this.activeTreeName),true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}else e._filterTree(a,d,this.activeTreeName,b)}else if(this.activeTreeName=="propertyTree"){e=propertyActionListener;d=dataAccess.OB_cachedPropertyTree;if(b==""){dataAccess.initializeRootProperties(0);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(dataAccess.OB_currentlyDisplayedTree,
$(this.activeTreeName),true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)}else e._filterTree(a,d,this.activeTreeName,b)}else selectionProvider.fireFilterTree(this.activeTreeName,b)},filterInstances:function(){if(dataAccess.OB_cachedInstances!=null){var a=$F("instanceFilter"),b=[],d=GeneralTools.splitSearchTerm(a);a=0;for(var e=d.length;a<e;a++)try{b[a]=RegExp(d[a],"i")}catch(f){return}d=GeneralXMLTools.createDocumentFromString("<instanceList/>");
var g=dataAccess.OB_cachedInstances.firstChild;a=0;for(e=g.childNodes.length;a<e;a++){var h=g.childNodes[a],j=h.getAttribute("title");j&&GeneralTools.matchArrayOfRegExp(j,b)&&GeneralXMLTools.importNode(d.firstChild,h,true);h.tagName=="instancePartition"&&GeneralXMLTools.importNode(d.firstChild,h,true)}selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(d,$("instanceList"),true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}},
filterProperties:function(){if(dataAccess.OB_cachedProperties!=null){var a=$F("propertyFilter"),b=[],d=GeneralTools.splitSearchTerm(a);a=0;for(var e=d.length;a<e;a++)try{b[a]=RegExp(d[a],"i")}catch(f){return}d=GeneralXMLTools.createDocumentFromString("<"+dataAccess.OB_cachedProperties.firstChild.tagName+"/>");var g=dataAccess.OB_cachedProperties.firstChild;a=0;for(e=g.childNodes.length;a<e;a++){var h=g.childNodes[a],j=h.getAttribute("title");j&&GeneralTools.matchArrayOfRegExp(j,b)&&GeneralXMLTools.importNode(d.firstChild,
h,true);h.tagName=="propertyPartition"&&GeneralXMLTools.importNode(d.firstChild,h,true)}selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(d,$("relattributes"),true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null);GeneralBrowserTools.repasteMarkup("needRepaste")}},filterRoot:function(a){var b,d;if(this.activeTreeName=="categoryTree"){b=categoryActionListener;d=dataAccess.OB_cachedCategoryTree}else if(this.activeTreeName=="propertyTree"){b=
propertyActionListener;d=dataAccess.OB_cachedPropertyTree}b._filterRootLevel(a,d,this.activeTreeName)},filterBrowsing:function(a,b){function d(j){OB_tree_pendingIndicator.hide();var k=$("categoryTree");if(k.firstChild){GeneralBrowserTools.purge(k.firstChild);k.removeChild(k.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(j.responseText,k);selectionProvider.fireSelectionChanged(null,null,
SMW_CATEGORY_NS,null)}function e(j){OB_tree_pendingIndicator.hide();var k=$("propertyTree");if(k.firstChild){GeneralBrowserTools.purge(k.firstChild);k.removeChild(k.firstChild)}dataAccess.OB_cachedPropertyTree=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(j.responseText,k);selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)}function f(j){OB_instance_pendingIndicator.hide();var k=$("instanceList");if(k.firstChild){GeneralBrowserTools.purge(k.firstChild);
k.removeChild(k.firstChild)}var m=GeneralXMLTools.createDocumentFromString(j.responseText);dataAccess.OB_cachedInstances=m;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,k,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_INSTANCE_NS,null)}function g(j){OB_relatt_pendingIndicator.hide();var k=$("relattributes");if(k.firstChild){GeneralBrowserTools.purge(k.firstChild);k.removeChild(k.firstChild)}var m=GeneralXMLTools.createDocumentFromString(j.responseText);
dataAccess.OB_cachedProperties=m;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(j,k,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)}if(!(!b&&a.keyCode!=13)){var h=$("FilterBrowserInput").value;if(h.length<=1)alert(gLanguage.getMessage("ENTER_MORE_LETTERS"));else{if(this.activeTreeName=="categoryTree"){OB_tree_pendingIndicator.show(this.activeTreeName);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse",
"category##"+h,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],d)}else if(this.activeTreeName=="propertyTree"){OB_tree_pendingIndicator.show(this.activeTreeName);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","propertyTree##"+h,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e)}else selectionProvider.fireFilterBrowsing(this.activeTreeName,h);if(this.activeTreeName=="categoryTree"||this.activeTreeName=="propertyTree"){OB_instance_pendingIndicator.show();
OB_relatt_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","instance##"+h,obAdvancedOptions.getDataSource()],f);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","property##"+h,obAdvancedOptions.getDataSource()],g)}}}},reset:function(){if(this.activeTreeName=="categoryTree")dataAccess.initializeRootCategories(0,true);else this.activeTreeName=="propertyTree"&&dataAccess.initializeRootProperties(0,true);selectionProvider.fireReset(this.activeTreeName);
$$("input").each(function(a){if(a.getAttribute("id")!="searchInput")a.value=""})},toogleCatInstArrow:function(a){a=Event.element(a);smwhgLogger.log("","OB","flipflow_left");if(OB_LEFT_ARROW==0){OB_LEFT_ARROW=1;a.setAttribute("src",wgScriptPath+"/extensions/SMWHalo/skins/OntologyBrowser/images/bigarrow_left.gif")}else{OB_LEFT_ARROW=0;a.setAttribute("src",wgScriptPath+"/extensions/SMWHalo/skins/OntologyBrowser/images/bigarrow.gif")}},toogleInstPropArrow:function(a){a=Event.element(a);smwhgLogger.log("",
"OB","flipflow_right");if(OB_RIGHT_ARROW==0){OB_RIGHT_ARROW=1;a.setAttribute("src",wgScriptPath+"/extensions/SMWHalo/skins/OntologyBrowser/images/bigarrow_left.gif")}else{OB_RIGHT_ARROW=0;a.setAttribute("src",wgScriptPath+"/extensions/SMWHalo/skins/OntologyBrowser/images/bigarrow.gif")}},closeMetadataview:function(a,b){$(b).hide()},closeAllMetadataviews:function(){$$(".metadataContainer").each(function(a){a.hide()})}};var categoryActionListener=null,instanceActionListener=null,globalActionListener=null,OB_partitionSize=80,OBDataAccess=Class.create();
OBDataAccess.prototype={initialize:function(){this.OB_cachedInstances=this.OB_cachedPropertyTree=this.OB_cachedCategoryTree=null;this.OB_cachedProperties=GeneralXMLTools.createDocumentFromString("<propertyList/>");this.OB_currentlyDisplayedTree=null;this.OB_attributesInitialized=this.OB_categoriesInitialized=false;categoryActionListener=new OBCategoryTreeActionListener;instanceActionListener=new OBInstanceActionListener;propertyActionListener=new OBPropertyTreeActionListener;globalActionListener=
new OBGlobalActionListener;annotationActionListener=new OBAnnotationActionListener;schemaActionPropertyListener=new OBSchemaPropertyActionListener;schemaEditPropertyListener=new OBEditPropertyActionListener;OB_tree_pendingIndicator=new OBPendingIndicator($("categoryTree"));OB_instance_pendingIndicator=new OBPendingIndicator($("instanceList"));OB_relatt_pendingIndicator=new OBPendingIndicator($("relattributes"))},initializeTree:function(){var a=GeneralBrowserTools.getURLParameter("entitytitle"),b=
GeneralBrowserTools.getURLParameter("ns"),d=GeneralBrowserTools.getURLParameter("searchTerm");if(d!=undefined){$("FilterBrowserInput").value=d;globalActionListener.filterBrowsing(null,true)}else if(a==undefined&&b==undefined)this.initializeRootCategories();else if(b==gLanguage.getMessage("CATEGORY_NS_WOC"))this.filterBrowseCategories(a);else if(b==undefined||b=="")this.filterBrowseInstances(a);else b==gLanguage.getMessage("PROPERTY_NS_WOC")&&this.filterBrowseProperties(a)},initializeRootCategoriesCallback:function(a){OB_tree_pendingIndicator.hide();
if(a.status!=200)alert("Error: "+a.status+" "+a.statusText+": "+a.responseText);else{this.OB_categoriesInitialized=true;var b=$("categoryTree");this.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(a.responseText);if(globalActionListener.activeTreeName=="categoryTree")this.OB_currentlyDisplayedTree=GeneralXMLTools.createDocumentFromString(a.responseText);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(this.OB_currentlyDisplayedTree,b,true);selectionProvider.fireRefresh();
selectionProvider.fireSelectionChanged(null,null,SMW_CATEGORY_NS,null)}},initializeRootPropertyCallback:function(a){OB_tree_pendingIndicator.hide();if(a.status!=200)alert("Error: "+a.status+" "+a.statusText+": "+a.responseText);else{this.OB_attributesInitialized=true;var b=$("propertyTree");this.OB_cachedPropertyTree=GeneralXMLTools.createDocumentFromString(a.responseText);if(globalActionListener.activeTreeName=="propertyTree")this.OB_currentlyDisplayedTree=GeneralXMLTools.createDocumentFromString(a.responseText);
selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(this.OB_currentlyDisplayedTree,b,true);selectionProvider.fireRefresh();selectionProvider.fireSelectionChanged(null,null,SMW_PROPERTY_NS,null)}},updateTree:function(a,b){var d=GeneralXMLTools.createDocumentFromString(a);selectionProvider.fireBeforeRefresh();transformer.transformXMLToHTML(d,b,true);selectionProvider.fireRefresh();return d},initializeRootCategories:function(a,b){if(!this.OB_categoriesInitialized||b){OB_tree_pendingIndicator.show(globalActionListener.activeTreeName);
sajax_do_call("smwf_ob_OntologyBrowserAccess",["getRootCategories",OB_partitionSize+"##"+a,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],this.initializeRootCategoriesCallback.bind(this))}else{this.OB_currentlyDisplayedTree=GeneralXMLTools.createDocumentFromString("<result/>");GeneralXMLTools.importSubtree(this.OB_currentlyDisplayedTree.firstChild,this.OB_cachedCategoryTree.firstChild,true)}},initializeRootProperties:function(a,b){if(!this.OB_attributesInitialized||b){OB_tree_pendingIndicator.show(globalActionListener.activeTreeName);
sajax_do_call("smwf_ob_OntologyBrowserAccess",["getRootProperties",OB_partitionSize+"##"+a,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],this.initializeRootPropertyCallback.bind(this))}else{this.OB_currentlyDisplayedTree=GeneralXMLTools.createDocumentFromString("<result/>");GeneralXMLTools.importSubtree(this.OB_currentlyDisplayedTree.firstChild,this.OB_cachedPropertyTree.firstChild,true)}},getCategorySubTree:function(a,b,d,e){var f=GeneralXMLTools.getNodeById(this.OB_cachedCategoryTree,
a);if(f!=null&&f.getElementsByTagName("conceptTreeElement").length>0){a=GeneralXMLTools.getNodeById(this.OB_currentlyDisplayedTree,a);GeneralXMLTools.importSubtree(a,f);a=GeneralXMLTools.createDocumentFromString("<result/>");GeneralXMLTools.importSubtree(a.firstChild,f);e(a)}else this.getCategoryPartition(false,0,b,d)},getPropertySubTree:function(a,b,d,e){var f=GeneralXMLTools.getNodeById(this.OB_cachedPropertyTree,a);if(f!=null&&f.getElementsByTagName("propertyTreeElement").length>0){a=GeneralXMLTools.getNodeById(this.OB_currentlyDisplayedTree,
a);GeneralXMLTools.importSubtree(a,f);a=GeneralXMLTools.createDocumentFromString("<result/>");GeneralXMLTools.importSubtree(a.firstChild,f);e(a)}else sajax_do_call("smwf_ob_OntologyBrowserAccess",["getSubProperties",b+"##"+OB_partitionSize+"##0",obAdvancedOptions.getDataSource()],d)},getInstances:function(a,b,d,e){var f=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getInstance",a+"##"+OB_partitionSize+"##"+b+"##"+d+"##"+f,obAdvancedOptions.getDataSource()],
e)},getProperties:function(a,b,d,e){sajax_do_call("smwf_ob_OntologyBrowserAccess",["getProperties",a+"##"+b+"##"+d,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e)},getAnnotations:function(a,b,d){var e=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getAnnotations",a+"##500##0##"+e+"##"+b,obAdvancedOptions.getDataSource()],d)},getPropertyValues:function(a,b){var d=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",
["getPropertyValues",a+"##500##0##"+d,obAdvancedOptions.getDataSource()],b)},getAnnotationsByURI:function(a,b){var d=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getAnnotationsByURI",a+"##500##0##"+d,obAdvancedOptions.getDataSource()],b)},getCategoryPartition:function(a,b,d,e){a?sajax_do_call("smwf_ob_OntologyBrowserAccess",["getRootCategories",OB_partitionSize+"##"+b,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e):sajax_do_call("smwf_ob_OntologyBrowserAccess",
["getSubCategory",d+"##"+OB_partitionSize+"##"+b,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e)},getPropertyPartition:function(a,b,d,e){a?sajax_do_call("smwf_ob_OntologyBrowserAccess",["getRootProperties",OB_partitionSize+"##"+b,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e):sajax_do_call("smwf_ob_OntologyBrowserAccess",["getSubProperties",d+"##"+OB_partitionSize+"##"+b,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],e)},getInstancesUsingProperty:function(a,
b,d){var e=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getInstancesUsingProperty",a+"##"+OB_partitionSize+"##"+b+"##"+e,obAdvancedOptions.getDataSource()],d)},getInstanceUsingPropertyValue:function(a,b,d,e){var f=obAdvancedOptions.requestedMetaproperties();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getInstanceUsingPropertyValue",a+"##"+b+"##"+OB_partitionSize+"##"+d+"##"+f,obAdvancedOptions.getDataSource()],e)},filterBrowseCategories:function(a){OB_tree_pendingIndicator.show();
globalActionListener.switchTreeComponent(null,"categoryTree",true);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","category,"+a,obAdvancedOptions.getDataSource(),obAdvancedOptions.getBundle()],function(b){OB_tree_pendingIndicator.hide();var d=$("categoryTree");if(d.firstChild){GeneralBrowserTools.purge(d.firstChild);d.removeChild(d.firstChild)}dataAccess.OB_cachedCategoryTree=GeneralXMLTools.createDocumentFromString(b.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(b.responseText,
d)})},filterBrowseInstances:function(a){function b(d){OB_relatt_pendingIndicator.hide();var e=$("relattributes");if(e.firstChild){GeneralBrowserTools.purge(e.firstChild);e.removeChild(e.firstChild)}var f=GeneralXMLTools.createDocumentFromString(d.responseText);dataAccess.OB_cachedProperties=f;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(d,e);selectionProvider.fireRefresh();OB_bd.isGecko&&GeneralBrowserTools.repasteMarkup("chemFoEq")}OB_instance_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",
["filterBrowse","instance,"+a,obAdvancedOptions.getDataSource()],function(d){OB_instance_pendingIndicator.hide();var e=$("instanceList");if(e.firstChild){GeneralBrowserTools.purge(e.firstChild);e.removeChild(e.firstChild)}var f=GeneralXMLTools.createDocumentFromString(d.responseText);if(f.firstChild.childNodes.length==1){var g=f.firstChild.firstChild;OB_relatt_pendingIndicator.show();sajax_do_call("smwf_ob_OntologyBrowserAccess",["getAnnotations",g.getAttribute("title"),obAdvancedOptions.getDataSource()],
b)}dataAccess.OB_cachedInstances=f;selectionProvider.fireBeforeRefresh();transformer.transformResultToHTML(d,e,true);selectionProvider.fireRefresh()})},filterBrowseProperties:function(a){OB_tree_pendingIndicator.show();globalActionListener.switchTreeComponent(null,"propertyTree",true);sajax_do_call("smwf_ob_OntologyBrowserAccess",["filterBrowse","propertyTree,"+a,obAdvancedOptions.getDataSource()],function(b){OB_tree_pendingIndicator.hide();var d=$("propertyTree");if(d.firstChild){GeneralBrowserTools.purge(d.firstChild);
d.removeChild(d.firstChild)}dataAccess.OB_cachedPropertyTree=GeneralXMLTools.createDocumentFromString(b.responseText);dataAccess.OB_currentlyDisplayedTree=dataAccess.updateTree(b.responseText,d)})}};var OBAdvancedOptions=Class.create();
OBAdvancedOptions.prototype={initialize:function(){this.bundle=this.dataSource=""},getDataSource:function(){return this.dataSource},getBundle:function(){return this.bundle},setDataSource:function(a){this.dataSource=a},requestedMetaproperties:function(){return"(SWP2_AUTHORITY)"},updateDataSources:function(){var a="";$("dataSourceSelector").descendants().each(function(b){if(b.selected==true)a+=","+b.getAttribute("sourceid")});if(a.length>0)a=a.substr(1);this.dataSource=a},updateBundles:function(){var a=
"";$("bundleSelector").descendants().each(function(b){if(b.selected==true)a+=","+b.getAttribute("bundleid")});if(a.length>0)a=a.substr(1);this.bundle=a},foldAdvancedOptionsBox:function(){var a=$("aoFoldIcon"),b="aoFoldOpen",d="aoFoldClosed";if(a.classNames().toArray().indexOf("aoFoldOpen")!=-1){b="aoFoldClosed";d="aoFoldOpen";doOpen=false;$("aoContent").hide()}else $("aoContent").show();a.addClassName(b);a.removeClassName(d)},onLoad:function(){if($("dataSourceSelector")!=null){obAdvancedOptions.updateDataSources();
Event.observe("dataSourceSelector","change",function(){obAdvancedOptions.updateDataSources();resetOntologyBrowser()})}obAdvancedOptions.updateBundles();Event.observe("bundleSelector","change",function(){obAdvancedOptions.updateBundles();resetOntologyBrowser()});Event.observe("aoFoldIcon","click",function(){obAdvancedOptions.foldAdvancedOptionsBox()});Event.observe("aoTitle","click",function(){obAdvancedOptions.foldAdvancedOptionsBox()});$("aoContent").hide()}};var obAdvancedOptions=new OBAdvancedOptions;
Event.observe(window,"load",obAdvancedOptions.onLoad.bindAsEventListener(obAdvancedOptions));addOnloadHook(smw_tooltipInit);BubbleTT={};BubbleTT.Platform={};var tt=null,all_tt=[],imagePath=wgScriptPath+"/extensions/SemanticMediaWiki/skins/images/",SMWTT_WIDTH_P=200,SMWTT_HEIGHT_P=80,SMWTT_WIDTH_I=175,SMWTT_HEIGHT_I=70;function smw_tooltipInit(){for(var a=document.getElementsByTagName("span"),b=0;b<a.length;b++){a[b].className=="smwttpersist"&&smw_makePersistentTooltip(a[b]);a[b].className=="smwttinline"&&smw_makeInlineTooltip(a[b])}}
function smw_makeInlineTooltip(a){var b=a.getElementsByTagName("span");a.className="smwttactiveinline";for(var d=0;d<b.length;d++)if(b[d].className=="smwttcontent")b[d].style.display="none";a.onmouseover=smw_showTooltipInline;a.onmouseout=smw_hideTooltip}
function smw_makePersistentTooltip(a){var b=a.getElementsByTagName("span");a.className="smwttactivepersist";for(var d=0;d<b.length;d++){if(b[d].className=="smwtticon"){img=document.createElement("img");img.setAttribute("src",imagePath+b[d].innerHTML);img.className="smwttimg";a.replaceChild(img,a.firstChild)}if(b[d].className=="smwttcontent")b[d].style.display="none"}BubbleTT.Platform.browser.isIE?a.attachEvent("onclick",smw_showTooltipPersist):a.addEventListener("click",smw_showTooltipPersist,false)}
function smw_showTooltipPersist(a){var b,d;if(BubbleTT.Platform.browser.isIE){c=BubbleTT.getElementCoordinates(window.event.srcElement);b=c.left;d=c.top}else{b=a.pageX;d=a.pageY}for(a=BubbleTT.Platform.browser.isIE?window.event.srcElement:a.target;a.className!="smwttactivepersist";)a=a.parentNode;tt=BubbleTT.createBubbleForPoint(true,a,b,d,SMWTT_WIDTH_P,SMWTT_HEIGHT_P);all_tt.push(tt);BubbleTT.fillBubble(tt,a);BubbleTT.Platform.browser.isIE?a.detachEvent("onclick",smw_showTooltipPersist):a.removeEventListener("click",
smw_showTooltipPersist,false)}function smw_showTooltipInline(a){if(tt==null){var b,d;if(BubbleTT.Platform.browser.isIE){c=BubbleTT.getElementCoordinates(window.event.srcElement);b=c.left;d=c.top}else{b=a.pageX;d=a.pageY}for(a=BubbleTT.Platform.browser.isIE?window.event.srcElement:a.target;a.className!="smwttactiveinline";)a=a.parentNode;tt=BubbleTT.createBubbleForPoint(false,a,b,d,SMWTT_WIDTH_I,SMWTT_HEIGHT_I);BubbleTT.fillBubble(tt,a)}}function smw_hideTooltip(){if(tt){tt.close();tt=null}}
function _smw_hideAllTooltips(){for(var a=0;a<all_tt.length;a++)all_tt[a].close();all_tt=[]}BubbleTT.getElementCoordinates=function(a){var b=0,d=0;if(a.nodeType!=1)a=a.parentNode;for(;a!=null;){b+=a.offsetLeft;d+=a.offsetTop-(a.scrollTop?a.scrollTop:0);a=a.offsetParent}d+=document.documentElement.scrollTop;return{left:b,top:d}};BubbleTT._bubbleMargins={top:33,bottom:42,left:33,right:40};BubbleTT._arrowOffsets={top:0,bottom:9,left:1,right:8};BubbleTT._bubblePadding=15;BubbleTT._bubblePointOffset=15;
BubbleTT._halfArrowWidth=18;
BubbleTT.createBubbleForPoint=function(a,b,d,e,f,g){var h=b.ownerDocument,j={_closed:false,_doc:h,close:function(){if(!this._closed){this._doc.body.removeChild(this._div);this._content=this._div=this._doc=null;this._closed=true;if(a)BubbleTT.Platform.browser.isIE?b.attachEvent("onclick",smw_showTooltipPersist):b.addEventListener("click",smw_showTooltipPersist,false)}}},k=h.body.offsetWidth,m=h.body.offsetHeight,l=BubbleTT._bubbleMargins,n=l.left+f+l.right,o=l.top+g+l.bottom,u=!BubbleTT.Platform.browser.isIE||
BubbleTT.Platform.browser.majorVersion>6,v=function(r,q,x,y){r.style.position="absolute";r.style.width=x+"px";r.style.height=y+"px";if(u)r.style.background="url("+q+")";else r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q+"', sizingMethod='crop')"},s=h.createElement("div");s.style.width=n+"px";s.style.height=o+"px";s.style.position="absolute";s.style.zIndex=1E3;j._div=s;var t=h.createElement("div");t.style.width="100%";t.style.height="100%";t.style.position="relative";
s.appendChild(t);var p=function(r,q,x,y,z){var w=h.createElement("div");w.style.left=q+"px";w.style.top=x+"px";v(w,r,y,z);t.appendChild(w)};p(imagePath+"bubble-top-left.png",0,0,l.left,l.top);p(imagePath+"bubble-top.png",l.left,0,f,l.top);p(imagePath+"bubble-top-right.png",l.left+f,0,l.right,l.top);p(imagePath+"bubble-left.png",0,l.top,l.left,g);p(imagePath+"bubble-right.png",l.left+f,l.top,l.right,g);p(imagePath+"bubble-bottom-left.png",0,l.top+g,l.left,l.bottom);p(imagePath+"bubble-bottom.png",
l.left,l.top+g,f,l.bottom);p(imagePath+"bubble-bottom-right.png",l.left+f,l.top+g,l.right,l.bottom);if(a){p=h.createElement("div");p.style.left=n-l.right+BubbleTT._bubblePadding-16-2+"px";p.style.top=l.top-BubbleTT._bubblePadding+1+"px";p.style.cursor="pointer";v(p,imagePath+"close-button.png",16,16);BubbleTT.DOM.registerEventWithObject(p,"click",j,j.close);t.appendChild(p)}p=h.createElement("div");p.style.position="absolute";p.style.left=l.left+"px";p.style.top=l.top+"px";p.style.width=f+"px";p.style.height=
g+"px";p.style.overflow="auto";p.style.background="white";t.appendChild(p);j.content=p;(function(){if(d-BubbleTT._halfArrowWidth-BubbleTT._bubblePadding>0&&d+BubbleTT._halfArrowWidth+BubbleTT._bubblePadding<k){var r=d-Math.round(f/2)-l.left;r=d<k/2?Math.max(r,-(l.left-BubbleTT._bubblePadding)):Math.min(r,k+(l.right-BubbleTT._bubblePadding)-n);if(e-BubbleTT._bubblePointOffset-o>0){var q=h.createElement("div");q.style.left=d-BubbleTT._halfArrowWidth-r+"px";q.style.top=l.top+g+"px";v(q,imagePath+"bubble-bottom-arrow.png",
37,l.bottom);t.appendChild(q);s.style.left=r+"px";s.style.top=e-BubbleTT._bubblePointOffset-o+BubbleTT._arrowOffsets.bottom+"px";return}else if(e+BubbleTT._bubblePointOffset+o<m){q=h.createElement("div");q.style.left=d-BubbleTT._halfArrowWidth-r+"px";q.style.top="0px";v(q,imagePath+"bubble-top-arrow.png",37,l.top);t.appendChild(q);s.style.left=r+"px";s.style.top=e+BubbleTT._bubblePointOffset-BubbleTT._arrowOffsets.top+"px";return}}r=e-Math.round(g/2)-l.top;r=e<m/2?Math.max(r,-(l.top-BubbleTT._bubblePadding)):
Math.min(r,m+(l.bottom-BubbleTT._bubblePadding)-o);if(d-BubbleTT._bubblePointOffset-n>0){q=h.createElement("div");q.style.left=l.left+f+"px";q.style.top=e-BubbleTT._halfArrowWidth-r+"px";v(q,imagePath+"bubble-right-arrow.png",l.right,37);t.appendChild(q);s.style.left=d-BubbleTT._bubblePointOffset-n+BubbleTT._arrowOffsets.right+"px"}else{q=h.createElement("div");q.style.left="0px";q.style.top=e-BubbleTT._halfArrowWidth-r+"px";v(q,imagePath+"bubble-left-arrow.png",l.left,37);t.appendChild(q);s.style.left=
d+BubbleTT._bubblePointOffset-BubbleTT._arrowOffsets.left+"px"}s.style.top=r+"px"})();h.body.appendChild(s);return j};BubbleTT.fillBubble=function(a,b){doc=a._doc;div=doc.createElement("div");div.className="smwtt";spans=b.getElementsByTagName("span");for(i=0;i<spans.length;i++)if(spans[i].className=="smwttcontent"){div.innerHTML=spans[i].innerHTML.replace(/\n/g,"<br />");div.innerHTML=spans[i].innerHTML.replace(/<!--br--\>/g,"<br />")}a.content.appendChild(div)};
BubbleTT.Platform.os={isMac:false,isWin:false,isWin32:false,isUnix:false};BubbleTT.Platform.browser={isIE:false,isNetscape:false,isMozilla:false,isFirefox:false,isOpera:false,isSafari:false,majorVersion:0,minorVersion:0};
(function(){var a=navigator.appName.toLowerCase(),b=navigator.userAgent.toLowerCase();BubbleTT.Platform.os.isMac=b.indexOf("mac")!=-1;BubbleTT.Platform.os.isWin=b.indexOf("win")!=-1;BubbleTT.Platform.os.isWin32=BubbleTT.Platform.isWin&&(b.indexOf("95")!=-1||b.indexOf("98")!=-1||b.indexOf("nt")!=-1||b.indexOf("win32")!=-1||b.indexOf("32bit")!=-1);BubbleTT.Platform.os.isUnix=b.indexOf("x11")!=-1;BubbleTT.Platform.browser.isIE=a.indexOf("microsoft")!=-1;BubbleTT.Platform.browser.isNetscape=a.indexOf("netscape")!=
-1;BubbleTT.Platform.browser.isMozilla=b.indexOf("mozilla")!=-1;BubbleTT.Platform.browser.isFirefox=b.indexOf("firefox")!=-1;BubbleTT.Platform.browser.isOpera=a.indexOf("opera")!=-1;a=function(f){f=f.split(".");BubbleTT.Platform.browser.majorVersion=parseInt(f[0]);BubbleTT.Platform.browser.minorVersion=parseInt(f[1])};var d=function(f,g,h){g=f.indexOf(g,h);return g>=0?g:f.length};if(BubbleTT.Platform.browser.isMozilla){var e=b.indexOf("mozilla/");e>=0&&a(b.substring(e+8,d(b," ",e)))}if(BubbleTT.Platform.browser.isIE){e=
b.indexOf("msie ");e>=0&&a(b.substring(e+5,d(b,";",e)))}if(BubbleTT.Platform.browser.isNetscape){e=b.indexOf("rv:");e>=0&&a(b.substring(e+3,d(b,")",e)))}if(BubbleTT.Platform.browser.isFirefox){e=b.indexOf("firefox/");e>=0&&a(b.substring(e+8,d(b," ",e)))}})();BubbleTT.Platform.getDefaultLocale=function(){return BubbleTT.Platform.clientLocale};BubbleTT.DOM={};BubbleTT.DOM.registerEventWithObject=function(a,b,d,e){BubbleTT.DOM.registerEvent(a,b,function(f,g,h){return e.call(d,f,g,h)})};
BubbleTT.DOM.registerEvent=function(a,b,d){var e=function(f){if(f=f?f:event?event:null){var g=f.target?f.target:f.srcElement?f.srcElement:null;if(g)g=g.nodeType==1||g.nodeType==9?g:g.parentNode;return d(a,f,g)}return true};BubbleTT.Platform.browser.isIE?a.attachEvent("on"+b,e):a.addEventListener(b,e,false)};
