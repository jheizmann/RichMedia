var Query=Class.create();
Query.prototype={initialize:function(id,parent,name){this.id=id;this.parent=parent;this.name=name;this.hasSubquery=false;this.categories=Array();this.instances=Array();this.properties=Array();this.subqueryIds=Array()},addCategoryGroup:function(cat,oldid){if(oldid==null)this.categories.push(cat);else this.categories[oldid]=cat},addInstanceGroup:function(ins,oldid){if(oldid==null)this.instances.push(ins);else this.instances[oldid]=ins},addPropertyGroup:function(pgroup,subIds,oldid){if(oldid==null)this.properties.push(pgroup);
else this.properties[oldid]=pgroup;if(subIds.length>0){this.hasSubquery=true;for(var i=0;i<subIds.length;i++)this.subqueryIds.push(subIds[i])}},hasSubqueries:function(){return this.hasSubquery},updateTree:function(){if(this.id==0&&this.isEmpty())return gLanguage.getMessage("QI_EMPTY_QUERY");var nodeLink=$("qiMainTab1").className=="qiDefTabActive";var tree='<table class="qiTree">';if(this.id==0)tree+='<tr><td colspan="2">'+'<a href="javascript:void(0);" onclick="qihelper.setActiveQuery(0)">'+gLanguage.getMessage("QI_MAIN_QUERY_NAME")+
"</a></td></tr>";for(var i=0;i<this.categories.length;i++){tree+='<tr><td width="16"><img src="'+qihelper.imgpath+'../../concept.gif"/></td><td> ';for(var j=0,js=this.categories[i].length;j<js;j++){if(nodeLink)tree+='<a href="javascript:void(0)" onclick="qihelper.selectNode(this, \'category-'+this.id+"-"+i+"-"+j+"')\">"+this.categories[i][j]+"</a>";else tree+=this.categories[i][j];if(j<js-1)tree+=' <span style="font-weight:bold">'+gLanguage.getMessage("QI_OR")+"</span> "}tree+="</td></tr>"}for(var i=
0;i<this.instances.length;i++){tree+='<tr><td width="16"><img src="'+qihelper.imgpath+'../../instance.gif"/></td><td> ';for(var j=0,js=this.instances[i].length;j<js;j++){if(nodeLink)tree+='<a href="javascript:void(0)" onclick="qihelper.selectNode(this, \'instance-'+this.id+"-"+i+"-"+j+"')\">"+this.instances[i][j]+"</a>";else tree+=this.instances[i][j];if(j<js-1)tree+=' <span style="font-weight:bold">'+gLanguage.getMessage("QI_OR")+"</span> "}tree+="</td></tr>"}for(var i=0;i<this.properties.length;i++){tree+=
'<tr><td width="16"><img src="'+qihelper.imgpath+'../../property.gif"/></td><td> ';if(nodeLink)tree+='<a href="javascript:void(0);" onclick="qihelper.selectNode(this, \'property-'+this.id+"-"+i+"')\">";tree+=this.properties[i].getName();if(nodeLink)tree+="</a>";tree+="</td></tr>"+'<tr><td><img src="'+qihelper.imgpath+'lastlink.gif"/></td><td>';propvalues=this.properties[i].getValues();for(var j=0,js=propvalues.length;j<js;j++)if(propvalues[j][0]=="subquery")tree+='<img src="'+qihelper.imgpath+'subquery.png"/> '+
'<a href="javascript:void(0);" onclick="qihelper.setActiveQuery('+propvalues[j][2]+')">'+gLanguage.getMessage("QI_SUBQUERY")+" "+propvalues[j][2]+"</a></td></tr><tr><td> </td><td>___SUBQUERY_"+propvalues[j][2]+"___";else{var res="";switch(propvalues[j][1]){case "<":res="&lt;=";break;case ">":res="&gt;=";break;case "<<":res="&lt;";break;case ">>":res="&gt;";break;default:res=propvalues[j][1];break}var pvalue=propvalues[j][2];res=(this.properties[i].getArity()>2?propvalues[j][0]:"")+" "+res+" ";if(propvalues[j][2]==
"*")res+="<i>"+gLanguage.getMessage("QI_ALL_VALUES")+"</i>";else res+=propvalues[j][2];if(propvalues[j][3])res+=" "+propvalues[j][3];tree+=res;if(j<js-1)tree+=' <span style="font-weight:bold">'+(this.properties[i].getArity()==2?gLanguage.getMessage("QI_OR"):";")+"</span> "}}tree+="</table>";return tree},getAskText:function(){var asktext="";for(var i=0;i<this.categories.length;i++){asktext+="[["+gLanguage.getMessage("CATEGORY_NS");for(var j=0;j<this.categories[i].length;j++){asktext+=this.categories[i][j].unescapeHTML();
if(j<this.categories[i].length-1)asktext+="||"}asktext+="]]"}for(var i=0;i<this.instances.length;i++){asktext+="[[";for(var j=0;j<this.instances[i].length;j++){asktext+=this.instances[i][j].unescapeHTML();if(j<this.instances[i].length-1)asktext+="||"}asktext+="]]"}for(var i=0;i<this.properties.length;i++){if(this.properties[i].isShown()&&this.properties[i].getArity()==2)asktext+="[["+this.properties[i].getName()+"::*]]";if(this.properties[i].mustBeSet()&&this.properties[i].getValues().length==1&&
this.properties[i].getValues()[0][2]=="*")asktext+="[["+this.properties[i].getName()+"::+]]";if(this.properties[i].getArity()>2){var valueSet=false;var tmpAsk="[["+this.properties[i].getName().unescapeHTML()+"::";var vals=this.properties[i].getValues();for(var j=0;j<vals.length;j++){if(j!=0)tmpAsk+=";";if(vals[j][1]!="=")tmpAsk+=vals[j][1];if(vals[j][2]!="*"){tmpAsk+=vals[j][2].unescapeHTML();valueSet=true}}tmpAsk+="]]";if(valueSet)asktext+=tmpAsk;else if(this.properties[i].mustBeSet())asktext+="[["+
this.properties[i].getName().unescapeHTML()+"::+]]"}else{var vals=this.properties[i].getValues();if(vals.length==1&&vals[0][2]=="*");else{asktext+="[["+this.properties[i].getName().unescapeHTML()+"::";for(var j=0;j<vals.length;j++){if(j!=0)asktext+="||";if(vals[j][1]!="=")asktext+=vals[j][1];if(vals[j][0]=="subquery")asktext+="Subquery:"+vals[j][2]+":";else asktext+=vals[j][2].unescapeHTML()}asktext+="]]"}}}return asktext},getParserAsk:function(){var asktext="";for(var i=0;i<this.categories.length;i++){asktext+=
"[["+gLanguage.getMessage("CATEGORY_NS");for(var j=0;j<this.categories[i].length;j++){asktext+=this.categories[i][j].unescapeHTML();if(j<this.categories[i].length-1)asktext+="||"}asktext+="]]"}for(var i=0;i<this.instances.length;i++){asktext+="[[";for(var j=0;j<this.instances[i].length;j++){asktext+=this.instances[i][j].unescapeHTML();if(j<this.instances[i].length-1)asktext+="||"}asktext+="]]"}for(var i=0;i<this.properties.length;i++){if(this.properties[i].mustBeSet()&&this.properties[i].getValues().length==
1&&this.properties[i].getValues()[0][2]=="*")asktext+="[["+this.properties[i].getName().unescapeHTML()+"::+]]";if(this.properties[i].getArity()>2){var valueSet=false;var tmpAsk="[["+this.properties[i].getName().unescapeHTML()+"::";var vals=this.properties[i].getValues();for(var j=0;j<vals.length;j++){if(j!=0)tmpAsk+=";";if(vals[j][1]!="=")tmpAsk+=vals[j][1];if(vals[j][2]!="*"){tmpAsk+=vals[j][2].unescapeHTML();valueSet=true}}tmpAsk+="]]";if(valueSet)asktext+=tmpAsk;else if(this.properties[i].mustBeSet())asktext+=
"[["+this.properties[i].getName().unescapeHTML()+"::+]]"}else{var vals=this.properties[i].getValues();if(vals.length==1&&vals[0][2]=="*");else{asktext+="[["+this.properties[i].getName().unescapeHTML()+"::";for(var j=0;j<vals.length;j++){if(j!=0)asktext+="||";if(vals[j][1]!="=")asktext+=vals[j][1];if(vals[j][0]=="subquery")asktext+="Subquery:"+vals[j][2]+":";else asktext+=vals[j][2].unescapeHTML();if(vals[j][3]&&vals[j][3].length>0)asktext+=" "+vals[j][3].unescapeHTML()}asktext+="]]"}}}return asktext},
getDisplayStatements:function(){var displayStatements=new Array;for(var i=0;i<this.properties.length;i++)if(this.properties[i].isShown()){var prop=this.properties[i].getName();var pname=prop;if(this.properties[i].getShowUnit())prop+=" #"+this.properties[i].getShowUnit();if(!this.properties[i].getColName())prop+=" = ";else if(pname!=this.properties[i].getColName())prop+=" = "+this.properties[i].getColName();if(displayStatements.inArray(prop))continue;displayStatements.push(prop)}return displayStatements},
isEmpty:function(){if(this.categories.length==0&&this.instances.length==0&&this.properties.length==0)return true;else return false},getName:function(){return this.name},getSubqueryIds:function(){return this.subqueryIds},getParent:function(){return this.parent},getCategoryGroup:function(id){return this.categories[id]},getInstanceGroup:function(id){return this.instances[id]},getPropertyGroup:function(id){return this.properties[id]},getAllProperties:function(){return this.properties},removeCategoryGroup:function(id){if(id<
this.categories.length-1)this.categories[id]=this.categories.pop();else this.categories.pop()},removeInstanceGroup:function(id){if(id<this.instances.length-1)this.instances[id]=this.instances.pop();else this.instances.pop()},removePropertyGroup:function(id){if(id<this.properties.length-1)this.properties[id]=this.properties.pop();else this.properties.pop()}};var QIList=function(){this.list=[]};
QIList.prototype={search:function(){var term=$("qiLoadConditionTerm").value,type;if(!term)return;for(var i=0;i<$("qiLoadCondition").options.length;i++)if($("qiLoadCondition").options[i].selected){type=$("qiLoadCondition").options[i].value;break}this.reset(true);sajax_do_call("smwf_qi_QIAccess",["searchQueries",term,type],this.fetchResults.bind(this))},fetchResults:function(result){if(result.readyState==4&&result.status==200)data=result.responseText;else return;var resObj=!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(data.replace(/"(\\.|[^"\\])*"/g,
""))&&eval("("+data+")");this.list=[];if(resObj.length==0)this.addTableRow(null,true);else for(var i=0;i<resObj.length;i++){var item=resObj[i];this.list.push(item);this.addTableRow(resObj[i])}$("qiLoadTabResult").style.display="inline"},addTableRow:function(item,noresults){var cont='<span style="cursor:pointer" onclick="qihelper.queryList.selectRow(this)">%s</span>';var row=$("qiLoadTabResultTable").insertRow(-1);var cell=row.insertCell(0);if(noresults){cell.setAttribute("colspan","3");cell.innerHTML=
gLanguage.getMessage("QI_NO_QUERIES_FOUND");return}cell.innerHTML=cont.replace("%s",item.name?item.name:"<i>"+gLanguage.getMessage("QI_NOT_SPECIFIED")+"</i>");cell=row.insertCell(1);cell.innerHTML=cont.replace("%s",item.format?item.format:"table");cell=row.insertCell(2);cell.innerHTML=cont.replace("%s",'<a href="'+wgScript+"/"+item.page.replace(/ /g,"_")+'">'+item.page+"</a>")},selectRow:function(span){var num;for(var i=1,n=$("qiLoadTabResultTable").rows.length;i<n;i++){if(span&&$("qiLoadTabResultTable").rows[i]==
span.parentNode.parentNode)num=i;$("qiLoadTabResultTable").rows[i].className=""}if(span){$("qiLoadTabResultTable").rows[num].className="qiLoadTabResultTableSelected";qihelper.initFromQueryString(this.list[num-1].query);$("qiDefTabInLoad").style.display="inline";$("qiLoadQueryButton").style.display="inline"}else{$("qiDefTabInLoad").style.display="none";$("qiLoadQueryButton").style.display="none"}},reset:function(inSearch){if(!inSearch)$("qiLoadConditionTerm").value="";for(var i=1,n=$("qiLoadTabResultTable").rows.length;i<
n;i++)$("qiLoadTabResultTable").deleteRow(1);$("qiDefTabInLoad").style.display="none";$("qiLoadTabResult").style.display="none";$("qiLoadQueryButton").style.display="none"}};var qihelper=null;var QIHelperSavedQuery;var QIHelper=Class.create();
QIHelper.prototype={initialize:function(){this.imgpath=wgScriptPath+"/extensions/SMWHalo/skins/QueryInterface/images/";this.divQiDefTabHeight=300;this.divPreviewcontentHeight=160;if(!this.numTypes){this.numTypes=new Array;this.getNumericDatatypes()}this.queries=Array();this.activeQuery=null;this.activeQueryId=null;this.nextQueryId=0;this.activeInputs=0;this.activeDialogue=null;this.propname=null;this.proparity=null;this.propIsEnum=false;this.propRange=new Array;this.enumValues=null;this.loadedFromId=
null;this.addQuery(null,gLanguage.getMessage("QI_MAIN_QUERY_NAME"));this.updateTree();this.setActiveQuery(0);this.updateColumnPreview();this.pendingElement=null;this.queryPartsFromInitByAsk=Array();this.propertyTypesList=new PropertyList;this.specialQPParameters=new Array;this.sortColumn=null;this.DS_SELECTED=0;this.TPEE_SELECTED=1;this.propertyAddClicked=false;$("qistatus").innerHTML=gLanguage.getMessage("QI_START_CREATING_QUERY");if(!this.noTabSwitch)this.switchTab(1,true);this.sourceChanged=0;
if($("usetriplestore"))Event.observe($("usetriplestore"),"click",this.resetTscOptions.bind(this));if(!this.queryList)this.queryList=new QIList},setExcelBridge:function(){this.isExcelBridge=1},switchlayout:function(){if($("layoutcontent").style.display=="none"){$("layoutcontent").style.display="";$("queryprinteroptions").style.display="";$("layouttitle-link").removeClassName("plusminus");$("layouttitle-link").addClassName("minusplus");this.getSpecialQPParameters($("layout_format").value)}else{$("layoutcontent").style.display=
"none";$("queryprinteroptions").style.display="none";$("layouttitle-link").removeClassName("minusplus");$("layouttitle-link").addClassName("plusminus")}},switchDefinition:function(){if($("qiquerydefinition").style.display=="none"){$("qiquerydefinition").style.display="";$("definitiontitle-link").removeClassName("plusminus");$("definitiontitle-link").addClassName("minusplus");$("previewcontent").style.height=this.divPreviewcontentHeight+"px"}else{$("qiquerydefinition").style.display="none";$("definitiontitle-link").removeClassName("minusplus");
$("definitiontitle-link").addClassName("plusminus");$("previewcontent").style.height=this.divQiDefTabHeight+this.divPreviewcontentHeight+"px"}},switchResult:function(){if($("qiresultcontent").style.display=="none"){$("qiresultcontent").style.display="";$("qiresulttitle-link").removeClassName("plusminus");$("qiresulttitle-link").addClassName("minusplus");this.updatePreview()}else{$("qiresultcontent").style.display="none";$("qiresulttitle-link").removeClassName("minusplus");$("qiresulttitle-link").addClassName("plusminus")}},
switchOption:function(){if($("qioptioncontent").style.display=="none"){$("qioptioncontent").style.display="";$("qioptiontitle-link").removeClassName("plusminus");$("qioptiontitle-link").addClassName("minusplus");this.updatePreview()}else{$("qioptioncontent").style.display="none";$("qioptiontitle-link").removeClassName("minusplus");$("qioptiontitle-link").addClassName("plusminus")}},resetSelection:function(selector,defaultVal){if(defaultVal==null)defaultVal=-1;if(selector)for(var i=0;i<selector.options.length;i++)if(i==
defaultVal)selector.options[i].selected="selected";else selector.options[i].selected=null},resetTscOptions:function(){this.resetSelection($("qidatasourceselector"),0);if($("qio_showrating")!=null)$("qio_showrating").checked=null;if($("qio_showmetadata")!=null)$("qio_showmetadata").checked=null;if($("qio_showdatasource_div"))$("qio_showdatasource_div").style.display="none";this.updateSrcAndPreview();if($("usetriplestore").checked)this.selectDsTpee(this.DS_SELECTED);else this.selectDsTpee(-1)},clickUseTsc:function(){if($("usetriplestore")){$("usetriplestore").checked=
"checked";this.updateSrcAndPreview()}},clickMetadata:function(){if($("qio_showmetadata")&&$("qio_showmetadata").checked)$("qio_showdatasource_div").style.display="block";else $("qio_showdatasource_div").style.display="none";this.clickUseTsc()},clickTpee:function(){for(var i=0;i<$("qitpeeselector").options.length;i++){var div="qitpeeparams_"+$("qitpeeselector").options[i].value;$(div).style.display="none";if($("qitpeeselector").options[i].selected)$(div).style.display=""}this.clickUseTsc()},selectDsTpee:function(val,
noupdate){if(!($("qiTpeeSelected")&&$("qiDsSelected")))return;if(!$("qiTpeeSelected")){$("qiDsSelected").style.display=val==-1?"none":"";return}var radio=$("qioptioncontent").getElementsBySelector('[name="qiDsTpeeSelector"]');if(val==this.TPEE_SELECTED){$("qiDsSelected").style.display="none";$("qiTpeeSelected").style.display="";radio[1].checked="checked";if(!noupdate)this.clickUseTsc()}else if(val==this.DS_SELECTED){$("qiDsSelected").style.display="";$("qiTpeeSelected").style.display="none";radio[0].checked=
"checked";if(!noupdate)this.clickUseTsc()}else{$("qiDsSelected").style.display="none";$("qiTpeeSelected").style.display="none";radio[0].checked=null;radio[1].checked=null;$("usetriplestore").checked=null;if(!noupdate)this.updateSrcAndPreview()}},tpeeOrder:function(move){var policy_id="";for(var i=0;i<$("qitpeeselector").options.length;i++)if($("qitpeeselector").options[i].selected){policy_id=$("qitpeeselector").options[i].value;break}if(policy_id.length==0)return;var table=$("qitpeeparamval_"+policy_id+
"_PAR_ORDER");if(!table)return;for(var i=0;i<table.rows.length;i++)if(table.rows[i].cells[0].className=="qiTpeeSelected"){var newRow=-1;if(move=="up"&&i>0)newRow=i-1;if(move=="down"&&i<table.rows.length-1)newRow=i+1;if(newRow==-1)break;var html=table.rows[i].cells[0].innerHTML;var sourceId=table.rows[i].cells[0].getAttribute("_sourceid");table.deleteRow(i);var row=table.insertRow(newRow);var cell=row.insertCell(0);cell.className="qiTpeeSelected";cell.setAttribute("_sourceid",sourceId);cell.innerHTML=
html;break}this.clickUseTsc()},tpeeOrderSelect:function(el){var table=el.parentNode;while(table.nodeName.toUpperCase()!="TABLE")table=table.parentNode;for(var i=0;i<table.rows.length;i++)table.rows[i].cells[0].className=null;el.className="qiTpeeSelected"},updatePreview:function(){if($("previewcontent").style.display==""&&$("qiresultcontent").style.display=="")this.previewResultPrinter()},updateQuerySource:function(){if($("qiDefTab3").className.indexOf("qiDefTabActive")>-1)this.showFullAsk("parser",
false)},updateSrcAndPreview:function(){this.updateQuerySource();this.updatePreview()},getSpecialQPParameters:function(qp,callWhenFinished){var callback=function(request){this.parameterPendingElement.hide();var columns=3;var html="<b>"+gLanguage.getMessage("QI_SPECIAL_QP_PARAMS")+"</b> <i>"+qp+'</i>:<table style="width: 100%;">';var qpParameters=request.responseText.evalJSON();var i=0;qpParameters.each(function(e){var visibleName=gLanguage.getMessage("QI_QP_PARAM_"+e.name);if(visibleName=="QI_QP_PARAM_"+
e.name)visibleName=e.name;if(i%columns==0)html+="<tr>";html+="<td onmouseover=\"Tip('"+e.description+"');\">"+visibleName+"</td>";if(e.values instanceof Array)html+="<td>"+createSelectionBox(e.name,e.values)+"</td>";else if(e.type=="string"||e.type=="int")html+="<td>"+createInputBox(e.name,e.values,e.constraints)+"</td>";else if(e.type=="boolean")html+="<td>"+createCheckBox(e.name,e.defaultValue)+"</td>";if(i%columns==2)html+="</tr>";i++});html+="</table>";autoCompleter.deregisterAllInputs();$("queryprinteroptions").innerHTML=
html;autoCompleter.registerAllInputs();this.specialQPParameters=qpParameters;if(callWhenFinished)callWhenFinished()};var createSelectionBox=function(id,values){var html='<select id="'+"qp_param_"+id+'" onchange="qihelper.updateSrcAndPreview()">';values.each(function(v){html+='<option value="'+v+'">'+v+"</option>"});html+="</select>";return html};var createInputBox=function(id,values,constraints){var aclAttributes="";if(constraints!=null)aclAttributes='class="wickEnabled" constraints="'+constraints+
'"';var html='<input id="'+"qp_param_"+id+'" type="text" '+aclAttributes+' onchange="qihelper.updateSrcAndPreview()"/>';return html};var createCheckBox=function(id,defaultValue){var defaultValueAtt=defaultValue?'checked="checked"':"";var html='<input id="'+"qp_param_"+id+'" type="checkbox" '+defaultValueAtt+' onchange="qihelper.updateSrcAndPreview()"/>';return html};if(this.parameterPendingElement)this.parameterPendingElement.remove();this.parameterPendingElement=new OBPendingIndicator($("querylayout"));
this.parameterPendingElement.show();sajax_do_call("smwf_qi_QIAccess",["getSupportedParameters",qp],callback.bind(this))},serializeSpecialQPParameters:function(sep){var paramStr="";var first=true;this.specialQPParameters.each(function(p){var element=$("qp_param_"+p.name);if(p.type=="boolean"&&element.checked)paramStr+=first?p.name:sep+" "+p.name;else if(element.value!=""&&element.value!=p.defaultValue)paramStr+=first?p.name+"="+element.value.replace(/,/g,"%2C"):sep+" "+p.name+"="+element.value;first=
false});return paramStr},switchpreview:function(){if($("previewcontent").style.display=="none"){$("previewcontent").style.display="";$("previewtitle-link").removeClassName("plusminus");$("previewtitle-link").addClassName("minusplus");this.previewResultPrinter()}else{$("previewcontent").style.display="none";$("previewtitle-link").removeClassName("minusplus");$("previewtitle-link").addClassName("plusminus")}},getNumericDatatypes:function(){sajax_do_call("smwf_qi_QIAccess",["getNumericTypes","dummy"],
this.setNumericDatatypes.bind(this))},setNumericDatatypes:function(request){var types=request.responseText.split(",");for(var i=0;i<types.length;i++){var tmp=types[i].replace(/^\s+|\s+$/g,"");this.numTypes[tmp]=true}},addQuery:function(parent,name){this.queries.push(new Query(this.nextQueryId,parent,name));this.nextQueryId++},insertQuery:function(id,parent,name){if(this.queries[id]){this.queries[id]=new Query(id,parent,name);return}while(this.nextQueryId<=id)this.addQuery(parent,name)},setActiveQuery:function(id){this.activeQuery=
this.queries[id];this.activeQueryId=id;this.emptyDialogue();this.updateBreadcrumbs(id)},resetQuery:function(){$("shade").style.display="inline";$("resetdialogue").style.display="inline"},doReset:function(){if(window.smwhgLogger)smwhgLogger.log("Reset Query","QI","query_reset");this.emptyDialogue();this.initialize();$("shade").style.display="none";$("resetdialogue").style.display="none";this.updatePreview()},updateTree:function(){var treeXML="";var queryIds=new Array;queryIds.push(0);for(var i=0;i<
queryIds.length;i++){var activeQuery=this.queries[queryIds[i]];if(!activeQuery)continue;var xml=activeQuery.updateTree();if(i==0)treeXML=xml;else treeXML=treeXML.replace("___SUBQUERY_"+i+"___",xml);for(var j=0;j<activeQuery.subqueryIds.length;j++)queryIds.push(activeQuery.subqueryIds[j])}$("treeanchor").innerHTML=treeXML},previewQuery:function(){if(window.smwhgLogger)smwhgLogger.log("Preview Query","QI","query_preview");$("shade").toggle();try{this.pendingElement.remove()}catch(e){}this.pendingElement=
new OBPendingIndicator($("shade"));this.pendingElement.show();$("fullpreviewbox").toggle();$("fullpreview").innerHTML='<img src="'+wgServer+wgScriptPath+'/extensions/SMWHalo/skins/OntologyBrowser/images/ajax-loader.gif" />';if(!this.queries[0].isEmpty()){var ask=this.recurseQuery(0,"parser");this.queries[0].getDisplayStatements().each(function(s){ask+="|?"+s});var params=ask.replace(/,/g,"%2C")+",";var reasonerAndDs=this.getReasonerAndParams();if(reasonerAndDs.length>0)params+=reasonerAndDs.replace(/,/g,
"%2C")+"|";params+=$("layout_sort").value==gLanguage.getMessage("QI_ARTICLE_TITLE")?"":"sort="+$("layout_sort").value+"|";params+="format="+$("layout_format").value+"|";params+=this.serializeSpecialQPParameters("|");params+="|merge=false";var currentPage=null;if(window.parent.wgPageName){currentPage=window.parent.wgPageName.wgCanonicalNamespace||"";currentPage+=":"+window.parent.wgPageName}sajax_do_call("smwf_qi_QIAccess",["getQueryResult",params,currentPage],this.openPreview.bind(this))}else{var request=
Array();request.responseText=gLanguage.getMessage("QI_EMPTY_QUERY");this.openPreview(request)}},previewResultPrinter:function(){if(window.smwhgLogger)smwhgLogger.log("Preview Result Printer","QI","query_result_preview");try{this.pendingElement.remove()}catch(e){}this.pendingElement=new OBPendingIndicator($("previewcontent"));this.pendingElement.show();var ask=this.getQueryFromTree();if(ask.length>0){var currentPage=null;if(window.parent.wgPageName){currentPage=window.parent.wgPageName.wgCanonicalNamespace||
"";currentPage+=":"+window.parent.wgPageName}sajax_do_call("smwf_qi_QIAccess",["getQueryResult",ask,currentPage],this.openResultPreview.bind(this))}else{var request=Array();request.responseText=gLanguage.getMessage("QI_EMPTY_QUERY");this.openResultPreview(request)}},getQueryFromTree:function(){if(!this.queries[0].isEmpty()){var ask=this.recurseQuery(0,"parser");var xsdDatetime=/(\d{4,4}-\d{1,2}-\d{1,2})T(\d{2,2}:\d{2,2}:\d{2,2})Z/;var currentDate=(new Date).toJSON();var matches=xsdDatetime.exec(currentDate);
var nowDateTime=matches[1]+"T"+matches[2];var todayDateTime=matches[1]+"T00:00:00";ask=ask.replace(/\{\{NOW\}\}/gi,nowDateTime);ask=ask.replace(/\{\{TODAY\}\}/gi,todayDateTime);ask=ask.replace(/,/g,"%2C");this.queries[0].getDisplayStatements().each(function(s){ask+="|?"+s});var params=ask+",";var reasonerAndDs=this.getReasonerAndParams();if(reasonerAndDs.length>0)params+=reasonerAndDs.replace(/,/g,"%2C")+"|";params+="format="+$("layout_format").value+"|";if($("layout_sort").value!=gLanguage.getMessage("QI_ARTICLE_TITLE"))params+=
"sort="+$("layout_sort").value+"|";params+=this.serializeSpecialQPParameters("|");params+="|merge=false";return params}return""},openPreview:function(request){switch($("layout_format").value){case "ofc-pie":case "ofc-bar":case "ofc-bar_3d":case "ofc-line":case "ofc-scatterline":$("previewcontent").innerHTML="";break}this.pastePreview(request,$("fullpreview"))},openResultPreview:function(request){this.pastePreview(request,$("previewcontent"))},pastePreview:function(request,preview){this.pendingElement.hide();
var resultHTML;var resultCode;switch($("layout_format").value){case "ofc-pie":case "ofc-bar":case "ofc-bar_3d":case "ofc-line":case "ofc-scatterline":var tuple=request.responseText.split("|||");resultHTML=tuple[0];resultCode=tuple[1];break;default:resultHTML=request.responseText;resultCode=null}preview.innerHTML=resultHTML;$("fullpreviewbox").width="";smw_tooltipInit();switch($("layout_format").value){case "timeline":case "eventline":this.parseWikilinks2Html();smw_timeline_init();$("fullpreviewbox").width=
"500px";break;case "exhibit":if(typeof createExhibit=="function")createExhibit();break;case "ofc-pie":case "ofc-bar":case "ofc-bar_3d":case "ofc-line":case "ofc-scatterline":ofc_data_objs=[];if(resultCode!=null)eval(resultCode);resetOfc();break;case "tabularform":tf.loadForms();break}},reloadOfcPreview:function(){if($("layout_format").value.indexOf("ofc-")==0)this.updatePreview()},parseWikilinks2Html:function(){if($("layout_link")!=null&&$("layout_link").value=="none")return;var text=$("previewcontent").innerHTML;
var newt="";var seek="[[";var p=text.indexOf(seek);while(p!=-1){if(seek=="[["){newt+=text.substring(0,p);text=text.substring(p+2);seek="]]"}else{var wikilink=text.substr(0,p);text=text.substr(p+2);if(wikilink.indexOf(":")==0)wikilink=wikilink.substring(1);var link=wikilink.split("|");var url=link[0];var title=link[0];if(link.length==2)title=link[1];newt+='<a href="'+wgServer+wgScript+"/"+GeneralTools.URLEncode(link[0].replace(" ","_"))+'">'+title+"</a>";seek="[["}p=text.indexOf(seek)}newt+=text;$("previewcontent").innerHTML=
newt},updateBreadcrumbs:function(id,action){var nav=Array();while(this.queries[id].getParent()!=null){nav.unshift(id);id=this.queries[id].getParent()}nav.unshift(id);var html="";for(var i=0;i<nav.length;i++){if(i>0)html+="&gt;";html+='<span class="qibuttonEmp" onclick="qihelper.setActiveQuery('+nav[i]+')">';html+=this.queries[nav[i]].getName()+"</span>"}if(action)html+=": <b>"+action+"</b>";var breadcrumpDIV=$("treeviewbreadcrumbs");if(breadcrumpDIV)breadcrumpDIV.innerHTML=html},updateHeightBoxcontent:function(){var off=
0;var dim=$("treeviewbreadcrumbs").getDimensions();off+=dim.height+3;dim=$("qistatus").getDimensions();off+=dim.height+3;dim=$("dialoguebuttons").getDimensions();off+=dim.height+3;$("boxcontent").style.height=300-off+"px"},updateColumnPreview:function(){var columns=new Array;columns.push(gLanguage.getMessage("QI_ARTICLE_TITLE"));var tmparr=this.queries[0].getAllProperties();for(var i=0;i<tmparr.length;i++)if(tmparr[i].isShown())columns.push(tmparr[i].getName());$("layout_sort").innerHTML="";for(var i=
0;i<columns.length;i++){$("layout_sort").options[$("layout_sort").length]=new Option(columns[i],columns[i]);if(this.sortColumn==columns[i])$("layout_sort").options[$("layout_sort").length-1].selected="selected"}},getFullParserAsk:function(){var asktext=this.recurseQuery(0,"parser");var displays=this.queries[0].getDisplayStatements();var fullQuery="{{#ask: "+asktext;for(var i=0;i<displays.length;i++)fullQuery+="| ?"+displays[i];fullQuery+=" | format="+$("layout_format").value;fullQuery+=$("layout_sort").value==
gLanguage.getMessage("QI_ARTICLE_TITLE")?"":" | sort="+$("layout_sort").value;var qParams=this.serializeSpecialQPParameters("|");if(qParams.length>0){if(!qParams.match(/^\s*\|/))fullQuery+="| ";fullQuery+=qParams}qParams=this.getReasonerAndParams();if(qParams.length>0)fullQuery+="| "+qParams;if($("qiQueryName").value)fullQuery+="| queryname="+$("qiQueryName").value;fullQuery+="| merge=false|}}";return fullQuery},getAskQueryFromGui:function(){if($("qiDefTab3").className.indexOf("qiDefTabActive")!=
-1)return $("fullAskText").value;else return this.getFullParserAsk()},insertAsNotification:function(){var query=this.getFullParserAsk();document.cookie="NOTIFICATION_QUERY=<snq>"+query+"</snq>";if(query!=""){var snPage=$("qi-insert-notification-btn").readAttribute("specialpage");snPage=unescape(snPage);location.href=snPage}},getReasonerAndParams:function(){var args=[];if($("usetriplestore")!=null&&$("usetriplestore").checked)args.push("source=tsc");var selectedDataSources=[];var selectorDsTpee=$("qioptioncontent")?
$("qioptioncontent").getElementsBySelector('[name="qiDsTpeeSelector"]'):[];var dataSources=$("qidatasourceselector");if(selectorDsTpee.length>0&&selectorDsTpee[0].checked||selectorDsTpee.length==0&&dataSources){for(var i=0;i<dataSources.options.length;i++)if(dataSources.options[i].selected)selectedDataSources.push(dataSources.options[i].value);if(!(selectedDataSources.length==1&&selectedDataSources[0]=="-Wiki-"))args.push("dataspace="+selectedDataSources.join(","))}if($("qio_showrating")!=null&&$("qio_showrating").checked)args.push("enableRating=true");
if($("qio_showmetadata")!=null&&$("qio_showmetadata").checked)if($("qio_showdatasource").checked)args.push("metadata=(DATASOURCE_LABEL_FROM)");else if($("qio_showmetadata").value)args.push("metadata="+$("qio_showmetadata").value);else args.push("metadata=*");if(selectorDsTpee.length>0&&selectorDsTpee[1].checked){var tpee="";for(var i=0;i<$("qitpeeselector").options.length;i++)if($("qitpeeselector").options[i].selected){tpee=$("qitpeeselector").options[i].value;args.push("policyid="+tpee);break}if($("qitpeeparams_"+
tpee)){var span=$$("#qitpeeparams_"+tpee+" span");var jsonParams=[];for(var i=0;i<span.length;i++){var pname=span[i].name?span[i].name.replace("qitpeeparams_ "+tpee+"_",""):span[i].innerHTML;var val=$("qitpeeparamval_"+tpee+"_"+pname)&&($("qitpeeparamval_"+tpee+"_"+pname).value||$("qitpeeparamval_"+tpee+"_"+pname).innerHTML);if(pname&&val){if(pname=="PAR_USER")val=$("qi_tsc_wikigraph").innerHTML+"/"+$("qi_tsc_userns").innerHTML+"/"+val;if(pname=="PAR_ORDER"){var vals=[];var table=$("qitpeeparamval_"+
tpee+"_"+pname);for(var r=0;r<table.rows.length;r++)vals.push('\\"'+table.rows[r].cells[0].getAttribute("_sourceid")+'\\"');if(vals.length>0)val="["+vals.join(",")+"]"}jsonParams.push('"'+pname+'":"'+val+'"')}}if(jsonParams.length>0)args.push("policyparams={"+jsonParams.join(",")+"}");if($("qitpeeparamval_"+tpee+"_PAR_ORDER")){var printouts=this.queries[0].getDisplayStatements();args.push("policyvar="+(printouts[0]?printouts[0]:""))}args.push("graph=")}}if(args.length>0)return args.join("| ");return""},
recurseQuery:function(id,type){if(!this.queries[id])return"";var sq=this.queries[id].getSubqueryIds();if(sq.length==0)if(type=="parser")return this.queries[id].getParserAsk();else return this.queries[id].getAskText();else if(type=="parser"){var tmptext=this.queries[id].getParserAsk();for(var i=0;i<sq.length;i++){var regex=null;eval("regex = /Subquery:"+sq[i]+":/g");tmptext=tmptext.replace(regex,"<q>"+this.recurseQuery(sq[i],"ask")+"</q>")}return tmptext}else{var tmptext=this.queries[id].getAskText();
for(var i=0;i<sq.length;i++){var regex=null;eval("regex = /Subquery:"+sq[i]+":/g");tmptext=tmptext.replace(regex,"<q>"+this.recurseQuery(sq[i],"parser")+"</q>")}return tmptext}},resetDialogueContent:function(reset){$("qidelete").style.display="none";$("qistatus").innerHTML="";autoCompleter.deregisterAllInputs();if(reset)this.loadedFromId=null;for(var i=0,n=$("dialoguecontent").rows.length;i<n;i++)$("dialoguecontent").deleteRow(0);while(1){var n=$("dialoguecontent").parentNode.nextSibling;if(!n)break;
n.parentNode.removeChild(n)}},newCategoryDialogue:function(reset){this.emptyDialogue();if(reset)this.updateTree();this.updateBreadcrumbs(this.activeQueryId,gLanguage.getMessage(reset?"QI_BC_ADD_CATEGORY":"QI_BC_EDIT_CATEGORY"));this.activeDialogue="category";this.resetDialogueContent(reset);var newrow=$("dialoguecontent").insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage("CATEGORY");cell=newrow.insertCell(1);cell.innerHTML='<input type="text" id="input0" class="wickEnabled general-forms" constraints="namespace: 14" autocomplete="OFF" '+
"onmouseover=\"Tip('"+gLanguage.getMessage("AUTOCOMPLETION_HINT")+"');\"/>";cell=newrow.insertCell(2);newrow=$("dialoguecontent").insertRow(-1);cell=newrow.insertCell(0);cell.style.textAlign="left";cell.setAttribute("colspan","3");cell.innerHTML='<a href="javascript:void(0)" onclick="qihelper.addDialogueInput()">'+gLanguage.getMessage("QI_BC_ADD_OTHER_CATEGORY")+"</a>";$("dialoguebuttons").style.display="inline";$("dialoguebuttons").getElementsByTagName("button").item(0).innerHTML=gLanguage.getMessage(reset?
"QI_BUTTON_ADD":"QI_BUTTON_UPDATE");autoCompleter.registerAllInputs();if(reset)$("input0").focus();this.updateHeightBoxcontent()},newInstanceDialogue:function(reset){this.emptyDialogue();if(reset)this.updateTree();this.updateBreadcrumbs(this.activeQueryId,gLanguage.getMessage(reset?"QI_BC_ADD_INSTANCE":"QI_BC_EDIT_INSTANCE"));this.activeDialogue="instance";this.resetDialogueContent(reset);var catConstraint="";if(this.activeQuery.categories.length>0){catConstraint="ask:";var categories=this.activeQuery.categories;
categories.each(function(c){catConstraint+="[["+gLanguage.getMessage("CATEGORY_NS","cont")+c+"]]"});catConstraint+="|"}var newrow=$("dialoguecontent").insertRow(-1);var cell=newrow.insertCell(0);cell.innerHTML=gLanguage.getMessage("QI_INSTANCE");cell=newrow.insertCell(1);cell.innerHTML='<input type="text" id="input0" class="wickEnabled general-forms" constraints="'+catConstraint+'namespace: 0" autocomplete="OFF" '+"onmouseover=\"Tip('"+gLanguage.getMessage("AUTOCOMPLETION_HINT")+"');\"/>";cell=newrow.insertCell(2);
newrow=$("dialoguecontent").insertRow(-1);cell=newrow.insertCell(0);cell.style.textAlign="left";cell.setAttribute("colspan","3");cell.innerHTML='<a href="javascript:void(0)" onclick="qihelper.addDialogueInput()">'+gLanguage.getMessage("QI_BC_ADD_OTHER_INSTANCE")+"</a>";$("dialoguebuttons").style.display="inline";$("dialoguebuttons").getElementsByTagName("button").item(0).innerHTML=gLanguage.getMessage(reset?"QI_BUTTON_ADD":"QI_BUTTON_UPDATE");autoCompleter.registerAllInputs();if(reset)$("input0").focus();
this.updateHeightBoxcontent()},newPropertyDialogue:function(reset){this.emptyDialogue();if(reset)this.updateTree();this.updateBreadcrumbs(this.activeQueryId,gLanguage.getMessage(reset?"QI_BC_ADD_PROPERTY":"QI_BC_EDIT_PROPERTY"));this.activeDialogue="property";this.propname="";this.resetDialogueContent();this.addPropertyChainInput();this.completePropertyDialogue();$("dialoguebuttons").style.display="inline";$("dialoguebuttons").getElementsByTagName("button").item(0).innerHTML=gLanguage.getMessage(reset?
"QI_BUTTON_ADD":"QI_BUTTON_UPDATE");this.proparity=2;autoCompleter.registerAllInputs();if(reset)$("input_p0").focus();this.updateHeightBoxcontent()},getCategoryConstraints:function(){var cats=this.activeQuery.categories;var constraintsCategories="";for(var i=0,n=cats.length;i<n;i++){var catconstraint=cats[i].join(",");if(i<n-1)catconstraint+=","}constraintsCategories+=gLanguage.getMessage("CATEGORY_NS","cont")+catconstraint;return constraintsCategories},addPropertyChainInput:function(propName){autoCompleter.deregisterAllInputs();
var constraintsCategories="";var idx=$("dialoguecontent").rows.length;if(idx>0)idx=(idx-1)/2;if(idx>0){var pName=$("input_p"+(idx-1)).value;if(this.propRange[pName.toLowerCase()])constraintsCategories=this.propRange[pName.toLowerCase()]}if(constraintsCategories.length==0)constraintsCategories=this.getCategoryConstraints();var constraintstring="schema-property-domain: "+constraintsCategories+"|annotation-property: "+constraintsCategories+"|namespace: 102";var newrow=$("dialoguecontent").insertRow(idx*
2);var cell=newrow.insertCell(0);if(idx==0)cell.innerHTML=gLanguage.getMessage("QI_PROPERTYNAME");else cell.innerHTML=' <img src="'+this.imgpath+'chain.png" alt="chain"/>';cell=newrow.insertCell(1);cell.style.textAlign="left";cell.style.verticalAlign="middle";var tmpHTML='<input type="text" id="input_p'+idx+'" '+'class="wickEnabled general-forms" constraints="'+constraintstring+'" '+(idx>0?'style="font-weight:bold;" ':"")+'onblur="qihelper.getPropertyInformation()" '+'onchange="qihelper.clearPropertyType('+
idx+');" '+(propName?'value="'+propName+'" ':"")+"onmouseover=\"Tip('"+gLanguage.getMessage("AUTOCOMPLETION_HINT")+"');\""+"/>";if(idx>0)tmpHTML+=' <img src="'+this.imgpath+'delete.png" alt="deleteInput" onclick="qihelper.removePropertyChainInput()"/>';cell.innerHTML=tmpHTML;newrow=$("dialoguecontent").insertRow(idx*2+1);newrow.style.lineHeight="1";newrow.insertCell(0);cell=newrow.insertCell(1);cell.style.textAlign="left";cell.style.fontSize="60%";cell.style.color="#AAAAAA";cell.innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+
":";if(idx==0){newrow=$("dialoguecontent").insertRow(-1);cell=newrow.insertCell(0);cell=newrow.insertCell(1);cell.style.textAlign="left";cell.setAttribute("colspan",2);cell.innerHTML='<div id="addchain"></div>'}else{try{var img=$("dialoguecontent").rows[(idx-1)*2].getElementsByTagName("td")[1].getElementsByTagName("img");if(img.length>0)img[0].parentNode.removeChild(img[0])}catch(e){}try{var input=$("dialoguecontent").rows[(idx-1)*2].getElementsByTagName("td")[1].getElementsByTagName("input");input[0].style.fontWeight=
"normal"}catch(e){}}autoCompleter.registerAllInputs();if(!propName)$("input_p"+idx).focus();this.toggleAddchain(false)},setPropertyRestriction:function(){if(this.oldPropertyRestriction==null)this.oldPropertyRestriction=-1;var table=$("dialoguecontent_pradio");if(!table)return;var radio=table.getElementsByTagName("input");$("usesub_text").style.display=radio[2].checked?"block":"none";if(radio[1].checked){$("dialoguecontent_pvalues").style.display="inline";if($("dialoguecontent_pvalues").rows.length==
0)this.addRestrictionInput()}else $("dialoguecontent_pvalues").style.display="none";for(var i=0,n=radio.length;i<n;i++)if(radio[i].checked){this.oldPropertyRestriction=radio[i].value;break}},addRestrictionInput:function(){autoCompleter.deregisterAllInputs();var arity=this.proparity?this.proparity:2;if($("dialoguecontent_pvalues").rows.length==0||arity>2)var newrow=$("dialoguecontent_pvalues").insertRow(-1);else var newrow=$("dialoguecontent_pvalues").insertRow($("dialoguecontent_pvalues").rows.length-
1);try{var newRowIndex=$("dialoguecontent_pvalues").rows[newrow.rowIndex-1].id;newRowIndex=parseInt(newRowIndex.substr(5))+1}catch(e){newRowIndex=1}if(!newRowIndex)newRowIndex=1;newrow.id="row_r"+newRowIndex;var cell=newrow.insertCell(0);if(newrow.rowIndex==0)cell.innerHTML=gLanguage.getMessage("QI_PROPERTYVALUE");else{cell.innerHTML=gLanguage.getMessage("QI_OR").toUpperCase();cell.style.fontWeight="bold";cell.style.textAlign="right"}var param=this.propTypename?this.propTypename:gLanguage.getMessage("QI_PAGE");
var ptype=this.propTypetype?this.propTypetype:"_wpg";var numericType=this.numTypes[param.toLowerCase()]?1:0;var propNameAC=gLanguage.getMessage("PROPERTY_NS")+this.propname.replace(/\s/g,"_");var ac_constraint="annotation-value: "+propNameAC;if(ptype=="_wpg")if(this.propname.toLowerCase()==gLanguage.getMessage("HAS_TYPE"))ac_constraint="namespace: 104";else if(this.propRange[this.propname.toLowerCase()])ac_constraint="instance-property-range: "+propNameAC;else ac_constraint+="|namespace: 0";else if(ptype==
"_dat"){ac_constraint="fixvalues: {{NOW}},{{TODAY}}|annotation-value: "+propNameAC;numericType=1}else if(ptype=="_str")numericType=2;cell=newrow.insertCell(1);cell.innerHTML=this.createRestrictionSelector("=",false,numericType);cell=newrow.insertCell(2);if(this.propIsEnum){var oSelect=document.createElement("SELECT");oSelect.id="input_r"+newRowIndex;var optOff=0;if(arity==2&&newRowIndex==1){oSelect.options[0]=new Option(gLanguage.getMessage("QI_ALL_VALUES"),"*");optOff=1}for(var i=0;i<this.enumValues.length;i++){oSelect.options[i+
optOff]=new Option(this.enumValues[i],this.enumValues[i]);oSelect.options[i+optOff].style.width="100%"}cell.appendChild(oSelect)}else{var oInput=document.createElement("INPUT");oInput.type="text";oInput.id="input_r"+newRowIndex;oInput.className="wickEnabled general-forms";oInput.setAttribute("autocomplete","OFF");oInput.setAttribute("constraints",ac_constraint);cell.appendChild(oInput);try{var uIdx=arity==2?0:newRowIndex-1;if(this.propUnits.length>0&&this.propUnits[uIdx].length>0){var oSelect=document.createElement("SELECT");
oSelect.id="input_ru"+newRowIndex;for(var i=0,m=this.propUnits[uIdx].length;i<m;i++)oSelect.options[i]=new Option(this.propUnits[uIdx][i],this.propUnits[uIdx][i]);cell.appendChild(oSelect)}}catch(e){}}if(arity==2)if($("dialoguecontent_pvalues").rows.length>1){cell=newrow.insertCell(-1);cell.innerHTML='<img src="'+this.imgpath+'delete.png" alt="deleteInput" onclick="qihelper.removeRestrictionInput(this)"/>'}else{newrow=$("dialoguecontent_pvalues").insertRow(-1);cell=newrow.insertCell(-1);cell.setAttribute("colspan",
"4");cell.innerHTML='<a href="javascript:void(0);" onclick="qihelper.addRestrictionInput()">'+gLanguage.getMessage("QI_DC_ADD_OTHER_RESTRICT")+"</a>"}if($("dialoguecontent_pvalues").style.display!="none")$("input_r"+newRowIndex).focus();autoCompleter.registerAllInputs()},removeRestrictionInput:function(element){var tr=element.parentNode.parentNode;tr.parentNode.removeChild(tr)},removePropertyChainInput:function(){var idx=($("dialoguecontent").rows.length-1)/2-1;if(idx==0)return;$("dialoguecontent").deleteRow(idx*
2+1);$("dialoguecontent").deleteRow(idx*2);if(idx>1){var img=document.createElement("img");img.src=this.imgpath+"delete.png";img.alt="deleteInput";img.setAttribute("onclick","qihelper.removePropertyChainInput()");$("dialoguecontent").rows[idx*2-2].getElementsByTagName("td")[1].appendChild(img);$("dialoguecontent").rows[idx*2-2].getElementsByTagName("td")[1].getElementsByTagName("input").item(0).style.fontWeight="bold"}this.toggleAddchain(true)},emptyDialogue:function(){this.activeDialogue=null;this.loadedFromId=
null;this.propIsEnum=false;this.enumValues=null;this.propname=null;this.proparity=null;this.propTypename=null;this.propTypetype=null;this.propUnits=null;for(var i=0,n=$("dialoguecontent").rows.length;i<n;i++)$("dialoguecontent").deleteRow(0);while(n=$("dialoguecontent").parentNode.nextSibling)n.parentNode.removeChild(n);$("dialoguebuttons").style.display="none";$("qistatus").innerHTML="";$("qidelete").style.display="none";this.activeInputs=0;this.updateBreadcrumbs(this.activeQueryId)},addDialogueInput:function(){autoCompleter.deregisterAllInputs();
var inputs=$("dialoguecontent").getElementsByTagName("input");var id=inputs[inputs.length-1].id;id=parseInt(id.substring(5))+1;var newRowId=$("dialoguecontent").rows.length-1;var newrow=$("dialoguecontent").insertRow(newRowId);var cell=newrow.insertCell(0);cell.style.fontWeight="bold";cell.innerHTML=gLanguage.getMessage("QI_OR").toUpperCase();cell=newrow.insertCell(1);var ns;if(this.activeDialogue=="category")ns="14";else if(this.activeDialogue=="instance")ns="0";cell.innerHTML='<input class="wickEnabled general-forms" constraints="namespace: '+
ns+'" autocomplete="OFF" '+'type="text" id="input'+id+'" onmouseover="Tip(\''+gLanguage.getMessage("AUTOCOMPLETION_HINT")+"');\"/>";cell=newrow.insertCell(-1);cell.innerHTML='<img src="'+this.imgpath+'delete.png" alt="deleteInput" onclick="qihelper.removeInput(this);"/>';$("input"+id).focus();autoCompleter.registerAllInputs()},removeInput:function(el){var tr=el.parentNode.parentNode;tr.parentNode.removeChild(tr)},clearPropertyType:function(idx){$("dialoguecontent").rows[idx*2+1].cells[1].innerHTML=
gLanguage.getMessage("QI_PROPERTY_TYPE")+":"},getPropertyInformation:function(){var idx=($("dialoguecontent").rows.length-1)/2-1;var propname=$("input_p"+idx).value;if(propname!=""&&propname!=this.propname){this.propname=propname;if(this.pendingElement)try{this.pendingElement.remove()}catch(e){}if($("dialoguecontent_pvalues"))while($("dialoguecontent_pradio").rows.length>1)$("dialoguecontent_pradio").deleteRow(1);sajax_do_call("smwf_qi_QIAccess",["getPropertyInformation",escapeQueryHTML(propname)],
this.adaptDialogueToProperty.bind(this))}},adaptDialogueToProperty:function(request){this.propIsEnum=false;autoCompleter.deregisterAllInputs();if(this.activeDialogue!=null){try{var oldsubid=$("dialoguecontent_pradio").getElementsByTagName("input")[2].value}catch(e){var oldsubid=this.nextQueryId}if($("dialoguecontent_pvalues"))while($("dialoguecontent_pvalues").rows.length>0)$("dialoguecontent_pvalues").deleteRow(0);if($("dialoguecontent_pradio"))$("dialoguecontent_pradio").insertRow(-1);var tmpHTML=
"";this.proparity=2;var parameterNames=[gLanguage.getMessage("QI_PAGE")];var parameterTypes=[];var possibleValues=new Array;var possibleUnits=new Array;var propertyName=$("dialoguecontent").rows[$("dialoguecontent").rows.length-3].getElementsByTagName("input")[0].value;if(request.status==200){var schemaData=GeneralXMLTools.createDocumentFromString(request.responseText);this.proparity=parseInt(schemaData.documentElement.getAttribute("arity"));if(schemaData.documentElement.getAttribute("name")!=propertyName)return;
propertyName=schemaData.documentElement.getAttribute("name");parameterNames=[];parameterRanges=[];for(var i=0,n=schemaData.documentElement.childNodes.length;i<n;i++){parameterNames.push(schemaData.documentElement.childNodes[i].getAttribute("name"));parameterTypes.push(schemaData.documentElement.childNodes[i].getAttribute("type"));var range=schemaData.documentElement.childNodes[i].getAttribute("range");if(range)parameterRanges.push(range);var allowedValues=schemaData.documentElement.childNodes[i].getElementsByTagName("allowedValue");
for(var j=0,m=allowedValues.length;j<m;j++)possibleValues.push(allowedValues[j].getAttribute("value"));var units=schemaData.documentElement.childNodes[i].getElementsByTagName("unit");possibleUnits.push(new Array);for(var j=0,m=units.length;j<m;j++)possibleUnits[i].push(units[j].getAttribute("label"))}this.propUnits=possibleUnits;if(possibleUnits.length>0&&possibleUnits[0].length>0&&!this.numTypes[parameterNames[0].toLowerCase()])this.numTypes[parameterNames[0].toLowerCase()]=true;if(parameterRanges.length>
0)this.propRange[propertyName.toLowerCase()]=parameterRanges.join(",")}var rowCount=origRowCount=$("dialoguecontent").rows.length;while(rowCount>3&&propertyName.length>0&&$("dialoguecontent").rows[rowCount-3].cells[1].firstChild.value!=propertyName){$("dialoguecontent").deleteRow(rowCount-2);$("dialoguecontent").deleteRow(rowCount-3);rowCount=$("dialoguecontent").rows.length}if(rowCount<origRowCount){var img=document.createElement("img");img.src=this.imgpath+"delete.png";img.alt="deleteInput";img.setAttribute("onclick",
"qihelper.removePropertyChainInput()");$("dialoguecontent").rows[rowCount-3].cells[1].appendChild(img)}var propNameAC=gLanguage.getMessage("PROPERTY_NS")+propertyName.replace(/\s/g,"_");if(this.proparity==2){var ac_constraint="";if(parameterTypes[0]=="_wpg"){ac_constraint='constraints="'+this.propRange[propertyName.toLowerCase()]?"instance-property-range: ":"annotation-value: "+propNameAC+'|namespace: 0"';this.toggleSubqueryAddchain(true)}else if(parameterTypes[0]=="_dat"){ac_constraint='constraints="fixvalues: {{NOW}},{{TODAY}}|annotation-value: '+
propNameAC+'"';this.toggleSubqueryAddchain(false)}else{ac_constraint='constraints="annotation-value: '+propNameAC+'"';this.toggleSubqueryAddchain(false)}this.propTypename=parameterNames[0];this.propTypetype=parameterTypes[0];$("dialoguecontent").rows[$("dialoguecontent").rows.length-2].cells[1].innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+": "+parameterNames[0];if(possibleUnits.length>0&&possibleUnits[0].length>0){for(var i=0;i<possibleUnits[0].length;i++)$("input_c4").options[i]=new Option(possibleUnits[0][i],
possibleUnits[0][i]);$("input_c4d").style.display=$("input_c1").checked?null:"none"}else{$("input_c4").outerHTML='<select id="input_c4"></select>';$("input_c4d").style.display="none"}if(possibleValues.length>0){this.propIsEnum=true;this.enumValues=new Array;for(var i=0;i<possibleValues.length;i++)this.enumValues.push(possibleValues[i])}if(parameterTypes[0]=="_wpg"){$("dialoguecontent_pradio").getElementsByTagName("input")[2].value=oldsubid;$("dialoguecontent_pradio").getElementsByTagName("input")[2].disabled=
""}else $("dialoguecontent_pradio").getElementsByTagName("input")[2].disabled="true"}else{$("dialoguecontent_pradio").getElementsByTagName("input")[2].disabled="true";$("dialoguecontent").rows[$("dialoguecontent").rows.length-2].cells[1].innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+": "+gLanguage.getMessage("TYPE_RECORD");this.propTypename=gLanguage.getMessage("TYPE_RECORD");this.propTypetype="_rec";this.toggleSubqueryAddchain(false);var row=$("dialoguecontent_pvalues").insertRow(-1);var cell=
row.insertCell(-1);cell.innerHTML=gLanguage.getMessage("QI_PROPERTYVALUE");for(var i=0;i<parameterNames.length;i++){row=$("dialoguecontent_pvalues").insertRow(-1);cell=row.insertCell(-1);cell.style.textAlign="right";cell.innerHTML=parameterNames[i];cell=row.insertCell(-1);cell.style.textAlign="right";if(this.numTypes[parameterNames[i].toLowerCase()])cell.innerHTML=this.createRestrictionSelector("=",false,1);else if(parameterNames[i]==gLanguage.getMessage("TYPE_STRING"))cell.innerHTML=this.createRestrictionSelector("=",
false,2);else cell.innerHTML=this.createRestrictionSelector("=",false,0);cell=row.insertCell(-1);if(parameterTypes[i]=="_wpg")cell.innerHTML='<input class="wickEnabled general-forms" constraints="'+this.propRange[parameterNames[i].toLowerCase()]?"instance-property-range: ":"annotation-value: "+propNameAC+'|namespace: 0" type="text" id="input_r'+(i+1)+'"/>';else if(parameterTypes[i]=="_dat")cell.innerHTML='<input type="text" id="input_r'+(i+1)+'" constraints="fixvalues: {{NOW}},{{TODAY}}|annotation-value: '+
propNameAC+'"/>';else{var tmpHTML='<input type="text" id="input_r'+(i+1)+'" constraints="annotation-value: '+propNameAC+'"/>';if(possibleUnits.length>0&&possibleUnits[i].length>0){tmpHTML+='<select id="input_ru'+(i+1)+'">';for(var j=0,m=possibleUnits[i].length;j<m;j++)tmpHTML+="<option>"+possibleUnits[i][j]+"</option>";tmpHTML+="</select>"}cell.innerHTML=tmpHTML}}}if(!"input_c3".value)$("input_c3").value=this.propname;if($("dialoguecontent_pradio").getElementsByTagName("input")[1].checked)this.setPropertyRestriction()}autoCompleter.registerAllInputs();
if(this.propertyAddClicked)this.addPropertyGroup(1)},completePropertyDialogue:function(){if(this.activeDialogue=="property"&&$("input_c1"))return;var node=document.createElement("hr");$("dialoguecontent").parentNode.parentNode.appendChild(node);node=document.createElement("table");var row=node.insertRow(-1);var cell=row.insertCell(0);cell.style.verticalAlign="top";cell.innerHTML=gLanguage.getMessage("QI_PROPERTYVALUE");cell=row.insertCell(1);var tmpHTML="<table><tr><td "+"onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_SHOW_IN_RES")+
"')\">"+'<input type="checkbox" id="input_c1"'+(this.activeQueryId==0?' checked="checked"':"")+" />"+" </td><td> "+"<span onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_SHOW_IN_RES")+"')\">"+gLanguage.getMessage("QI_SHOW_PROPERTY")+"</span></td><td> </td></tr>"+'<tr id="input_c3d"'+(this.activeQueryId>0?' style="display:none"':"")+"><td> </td>"+"<td>"+gLanguage.getMessage("QI_COLUMN_LABEL")+":</td>"+'<td><input type="text" id="input_c3"/></td></tr>'+'<tr id="input_c4d" style="display:none"><td> </td>'+
"<td>"+gLanguage.getMessage("QI_SHOWUNIT")+":</td>"+'<td><select id="input_c4"></select></td></tr>'+"<tr><td onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_MUST_BE_SET")+"')\">"+'<input type="checkbox" id="input_c2"/></td>'+"<td><span onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_MUST_BE_SET")+"')\">"+gLanguage.getMessage("QI_PROPERTY_MUST_BE_SET")+"</span></td><td> </td></tr></table>";cell.innerHTML=tmpHTML;$("dialoguecontent").parentNode.parentNode.appendChild(node);if(this.activeQueryId==
0)$("input_c1").onclick=function(){qihelper.toggleShowProperty()};else $("input_c1").disabled="disabled";node=document.createElement("hr");$("dialoguecontent").parentNode.parentNode.appendChild(node);node=document.createElement("table");node.className="propertyvalues";node.id="dialoguecontent_pradio";row=node.insertRow(-1);cell=row.insertCell(-1);cell.setAttribute("style","border-botton: 1px solid #AAAAAA;");cell.innerHTML=gLanguage.getMessage("QI_PROP_VALUES_RESTRICT")+": "+"<span onmouseover=\"Tip('"+
gLanguage.getMessage("QI_TT_NO_RESTRICTION")+"')\">"+'<input type="radio" name="input_r0" value="-1" checked="checked" />'+gLanguage.getMessage("QI_NONE")+"</span>&nbsp;<span onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_VALUE_RESTRICTION")+"')\">"+'<input type="radio" name="input_r0" value="-2" />'+gLanguage.getMessage("QI_SPECIFIC_VALUE")+"</span>&nbsp;<span onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_SUBQUERY")+"')\">"+'<input type="radio" name="input_r0" value="'+this.nextQueryId+'" />'+
'<span id="usesub">'+gLanguage.getMessage("QI_SUBQUERY")+"</span></span>&nbsp"+'<div id="usesub_text" style="display:none">'+gLanguage.getMessage("QI_SUBQUERY_TEXT")+"</div>";$("dialoguecontent").parentNode.parentNode.appendChild(node);node=document.createElement("table");node.style.display="none";node.id="dialoguecontent_pvalues";$("dialoguecontent").parentNode.parentNode.appendChild(node);var radiobuttons=$("dialoguecontent_pradio").getElementsByTagName("input");for(var i=0;i<radiobuttons.length;i++)radiobuttons[i].onclick=
function(){qihelper.setPropertyRestriction()}},toggleSubqueryAddchain:function(op){this.toggleSubquery(op);this.toggleAddchain(op)},toggleSubquery:function(op){if(op)try{$("usesub").className="";document.getElementsByName("input_r0")[2].disabled=""}catch(e){}else try{$("usesub").className="qiDisabled";document.getElementsByName("input_r0")[2].checked=false;document.getElementsByName("input_r0")[2].disabled=true}catch(e){}},toggleAddchain:function(op){if(!$("addchain"))return;if(op){var msg=$("dialoguecontent").getElementsByTagName("input").length>
1?gLanguage.getMessage("QI_ADD_PROPERTY_CHAIN"):gLanguage.getMessage("QI_CREATE_PROPERTY_CHAIN");$("addchain").innerHTML='<a href="javascript:void(0)" '+"onmouseover=\"Tip('"+gLanguage.getMessage("QI_TT_ADD_CHAIN")+"')\" "+'onclick="tt_Hide(); qihelper.addPropertyChainInput()">'+msg+"</a>"}else $("addchain").innerHTML=""},toggleShowProperty:function(){if($("input_c1").checked){if(!"input_c3".value)$("input_c3").value=this.propname;$("input_c3d").style.display=Prototype.Browser.IE?"inline":null;if($("input_c4").getElementsByTagName("option").length>
0)$("input_c4d").style.display=Prototype.Browser.IE?"inline":null}else{$("input_c3d").style.display="none";$("input_c4d").style.display="none"}},loadCategoryDialogue:function(id,focus){this.newCategoryDialogue(false);this.loadedFromId=id;var cats=this.activeQuery.getCategoryGroup(id);$("input0").value=unescapeQueryHTML(cats[0]);for(var i=1;i<cats.length;i++){this.addDialogueInput();$("input"+i).value=unescapeQueryHTML(cats[i])}if(focus)$("input"+focus).focus();$("qidelete").style.display="inline"},
loadInstanceDialogue:function(id,focus){this.newInstanceDialogue(false);this.loadedFromId=id;var ins=this.activeQuery.getInstanceGroup(id);$("input0").value=unescapeQueryHTML(ins[0]);for(var i=1;i<ins.length;i++){this.addDialogueInput();$("input"+i).value=unescapeQueryHTML(ins[i])}if(focus)$("input"+focus).focus();$("qidelete").style.display="inline"},loadPropertyDialogue:function(id){this.newPropertyDialogue(false);this.loadedFromId=id;var prop=this.activeQuery.getPropertyGroup(id);var vals=prop.getValues();
this.proparity=prop.getArity();var selector=prop.getSelector();this.propUnits=prop.getUnits();var propChain=unescapeQueryHTML(prop.getName()).split(".");$("input_p0").value=propChain[0];for(var i=1,n=propChain.length;i<n;i++){$("dialoguecontent").rows[i*2-1].cells[1].innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+": "+gLanguage.getMessage("QI_PAGE");this.addPropertyChainInput(propChain[i])}this.propname=propChain[propChain.length-1];this.completePropertyDialogue();$("input_c2").checked=prop.mustBeSet();
var typeRow=$("dialoguecontent").rows.length-2;if(this.proparity>2){$("dialoguecontent").rows[typeRow].cells[1].innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+": "+gLanguage.getMessage("TYPE_RECORD");this.toggleSubquery(false)}else{this.propTypename=selector>=0?gLanguage.getMessage("QI_PAGE"):vals[0][0];$("dialoguecontent").rows[typeRow].cells[1].innerHTML=gLanguage.getMessage("QI_PROPERTY_TYPE")+": "+this.propTypename;if(this.propTypename!=gLanguage.getMessage("QI_PAGE"))this.toggleSubquery(false);
else this.toggleAddchain(true)}$("input_c1").checked=prop.isShown();$("input_c3").value=prop.getColName();$("input_c3d").style.display=prop.isShown()?Prototype.Browser.IE?"inline":null:"none";if(selector>=0){document.getElementsByName("input_c1").disabled="disabled";document.getElementsByName("input_r0")[2].checked=true;document.getElementsByName("input_r0")[2].value=selector;$("usesub_text").style.display="block";this.toggleAddchain(false)}else{if(this.activeQueryId==0){if(prop.supportsUnits()&&
this.proparity==2){$("input_c4").value=prop.getShowUnit();for(var i=0;i<this.propUnits[0].length;i++){$("input_c4").options[i]=new Option(this.propUnits[0][i],this.propUnits[0][i]);if(prop.getShowUnit()==this.propUnits[0][i])$("input_c4").options[i].selected="selected"}$("input_c4d").style.display=prop.isShown()?Prototype.Browser.IE?"inline":null:"none"}}else $("input_c1").disabled="disabled";if(selector==-2){document.getElementsByName("input_r0")[1].checked=true;$("dialoguecontent_pvalues").style.display=
"inline"}if(prop.isEnumeration()){this.propIsEnum=true;this.enumValues=prop.getEnumValues()}var acChange=false;var rowOffset=0;if(this.proparity>2){var newrow=$("dialoguecontent_pvalues").insertRow(-1);var cell=newrow.insertCell(-1);cell.innerHTML=gLanguage.getMessage("QI_PROPERTYVALUE");rowOffset++}for(var i=0,n=vals.length;i<n;i++){var numType=0;var currRow=i+rowOffset;if(this.numTypes[vals[0][0].toLowerCase()]){numType=1;this.propTypetype="_num"}else if(vals[0][0]==gLanguage.getMessage("TYPE_STRING")){numType=
2;this.propTypetype="_str"}if(vals[0][0]==gLanguage.getMessage("TYPE_DATE"))this.propTypetype="_dat";this.addRestrictionInput();$("dialoguecontent_pvalues").rows[currRow].cells[1].innerHTML=this.createRestrictionSelector(vals[i][1],false,numType);if(!acChange)autoCompleter.deregisterAllInputs();acChange=true;try{var propUnits=prop.getUnits();var uIdx=this.proparity==2?0:i;var oSelect=$("dialoguecontent_pvalues").rows[currRow].cells[2].firstChild.nextSibling;for(var k=0,m=propUnits[uIdx].length;k<
m;k++){oSelect.options[k]=new Option(propUnits[uIdx][k],propUnits[uIdx][k]);if(propUnits[uIdx][k]==vals[i][3])oSelect.options[k].selected="selected"}}catch(e){}if(this.proparity>2){$("dialoguecontent_pvalues").rows[currRow].cells[0].innerHTML=vals[i][0];$("dialoguecontent_pvalues").rows[currRow].cells[0].style.fontWeight="normal"}if(vals[i][2]!="*")$("input_r"+(i+1)).value=vals[i][2].unescapeHTML()}if(acChange)autoCompleter.registerAllInputs()}$("qidelete").style.display="inline";if(!prop.isEnumeration())this.restoreAutocompletionConstraints()},
restoreAutocompletionConstraints:function(){var idx=($("dialoguecontent").rows.length-1)/2-1;var propname=$("input_p"+idx).value;if(propname!=""&&propname!=this.propname){this.propname=propname;if(this.pendingElement)this.pendingElement.remove();sajax_do_call("smwf_qi_QIAccess",["getPropertyInformation",escapeQueryHTML(propname)],this.restoreAutocompletionConstraintsCallback.bind(this))}},restoreAutocompletionConstraintsCallback:function(request){autoCompleter.deregisterAllInputs();if(request.status==
200){var schemaData=GeneralXMLTools.createDocumentFromString(request.responseText);var arity=parseInt(schemaData.documentElement.getAttribute("arity"));this.proparity=arity;var parameterNames=[];var parameterTypes=[];var ranges=[];for(var i=0,n=schemaData.documentElement.childNodes.length;i<n;i++){parameterNames.push(schemaData.documentElement.childNodes[i].getAttribute("name"));parameterTypes.push(schemaData.documentElement.childNodes[i].getAttribute("type"));var range=schemaData.documentElement.childNodes[i].getAttribute("range");
if(range)ranges.push(range)}var idx=($("dialoguecontent").rows.length-1)/2-1;var propertyName=$("input_p"+idx).value;propertyName=gLanguage.getMessage("PROPERTY_NS")+propertyName.replace(/\s/g,"_");this.propRange[propertyName.toLowerCase()]=ranges.join(",");var ac_constraint="";if(parameterTypes[0]=="_wpg")ac_constraint=this.propRange[propertyName.toLowerCase()]?"annotation-value: ":"instance-property-range: "+propertyName+"|namespace: 0";else if(parameterTypes[0]=="_dat")ac_constraint="fixvalues: {{NOW}},{{TODAY}}|annotation-value: "+
propertyName;else ac_constraint="annotation-value: "+propertyName;var i=1;while($("input_r"+i)!=null){$("input_r"+i).addClassName("wickEnabled");$("input_r"+i).setAttribute("constraints",ac_constraint);i++}}autoCompleter.registerAllInputs()},deleteActivePart:function(){switch(this.activeDialogue){case "category":if(window.smwhgLogger){var logstr="Remove category "+this.activeQuery.getCategoryGroup(this.loadedFromId).join(",")+" from query";smwhgLogger.log(logstr,"QI","query_category_removed")}this.activeQuery.removeCategoryGroup(this.loadedFromId);
break;case "instance":if(window.smwhgLogger){var logstr="Remove instance "+this.activeQuery.getInstanceGroup(this.loadedFromId).join(",")+" from query";smwhgLogger.log(logstr,"QI","query_instance_removed")}this.activeQuery.removeInstanceGroup(this.loadedFromId);break;case "property":var pgroup=this.activeQuery.getPropertyGroup(this.loadedFromId);if(window.smwhgLogger){var logstr="Remove property "+pgroup.getName()+" from query";smwhgLogger.log(logstr,"QI","query_property_removed")}if(pgroup.getValues()[0][0]==
"subquery"){if(window.smwhgLogger){var logstr="Remove subquery (property: "+pgroup.getName()+") from query";smwhgLogger.log(logstr,"QI","query_subquery_removed")}this.deleteSubqueries(pgroup.getValues()[0][2])}this.activeQuery.removePropertyGroup(this.loadedFromId);break}this.emptyDialogue();this.updateTree();this.updateColumnPreview();this.updateBreadcrumbs(this.activeQueryId);this.updateQuerySource();this.updatePreview()},deleteSubqueries:function(id){if(!this.queries[id])return;if(this.queries[id].hasSubqueries())for(var i=
0;i<this.queries[id].getSubqueryIds().length;i++)this.deleteSubqueries(this.queries[id].getSubqueryIds()[i]);this.queries[id]=null;this.updatePreview()},selectNode:function(el,label){var cells=$("treeanchor").getElementsByTagName("td");for(i=0;i<cells.length;i++)if(cells[i].style.backgroundColor){cells[i].style.backgroundColor=Prototype.Browser.IE?"":null;for(j=0;j<cells[i].childNodes.length;j++)if(cells[i].childNodes[j].style)cells[i].childNodes[j].style.color=Prototype.Browser.IE?"":null}el.parentNode.style.backgroundColor=
"#1122FF";for(i=0;i<el.parentNode.childNodes.length;i++)if(el.parentNode.childNodes[i].style)el.parentNode.childNodes[i].style.color="#FFFFFF";var vals=label.split("-");this.setActiveQuery(vals[1]);if(vals[0]=="category")this.loadCategoryDialogue(vals[2],vals[3]);else if(vals[0]=="instance")this.loadInstanceDialogue(vals[2],vals[3]);else this.loadPropertyDialogue(vals[2])},createRestrictionSelector:function(option,disabled,type){var html=disabled?'<select disabled="disabled">':"<select>";var optionsFunc=
function(op){var escapeXMLEntities=function(xml){var result=xml.replace(/</g,"&lt;");result=result.replace(/>/g,"&gt;");return result};if(!op)return;var selected=op[0]==option?'selected="selected"':"";html+='<option value="'+escapeXMLEntities(op[0])+'" '+selected+">"+op[2]+" ("+escapeXMLEntities(op[1])+")</option>"};if(type==1)[["=","=",gLanguage.getMessage("QI_EQUAL")],[">",">=",gLanguage.getMessage("QI_GT")],[">>",">",gLanguage.getMessage("QI_GT")],["<","<=",gLanguage.getMessage("QI_LT")],["<<",
"<",gLanguage.getMessage("QI_LT")],["!","!",gLanguage.getMessage("QI_NOT")]].each(optionsFunc);else if(type==2)[["=","=",gLanguage.getMessage("QI_EQUAL")],["!","!",gLanguage.getMessage("QI_NOT")],["~","~",gLanguage.getMessage("QI_LIKE")]].each(optionsFunc);else[["=","=",gLanguage.getMessage("QI_EQUAL")],["!","=",gLanguage.getMessage("QI_NOT")]].each(optionsFunc);return html+"</select>"},getPropertyValueSelector:function(){var radio=document.getElementsByName("input_r0");var val;if(radio.length==0)return;
for(var i=0;i<radio.length;i++)if(radio[i].checked){val=parseInt(radio[i].value);break}if(val==null||val>-1&&radio[2].disabled)return-1;return val},add:function(){if(this.activeDialogue=="property")this.addPropertyGroup();else this.addCatInstGroup();this.updateTree();this.updateSrcAndPreview();this.updateBreadcrumbs(this.activeQueryId);this.loadedFromID=null},addCatInstGroup:function(){var tmp=Array();var allinputs=true;var inputs=$("dialoguecontent").getElementsByTagName("input");for(var i=0;i<inputs.length;i++){if(inputs[i].id&&
inputs[i].id.match(/^input\d+$/))tmp.push(escapeQueryHTML(inputs[i].value));if(inputs[i].value=="")allinputs=false}if(!allinputs){$("qistatus").innerHTML=this.activeDialogue=="category"?gLanguage.getMessage("QI_ENTER_CATEGORY"):gLanguage.getMessage("QI_ENTER_INSTANCE");this.updateHeightBoxcontent()}else{if(window.smwhgLogger){var logstr="Add "+this.activeDialogue+" "+tmp.join(",")+" to query";smwhgLogger.log(logstr,"QI",this.activeDialogue=="category"?"query_category_added":"query_instance_added")}if(this.activeDialogue==
"category"){this.activeQuery.addCategoryGroup(tmp,this.loadedFromId);this.emptyDialogue();$("qistatus").innerHTML=gLanguage.getMessage("QI_CAT_ADDED_SUCCESSFUL")}else{this.activeQuery.addInstanceGroup(tmp,this.loadedFromId);this.emptyDialogue();$("qistatus").innerHTML=gLanguage.getMessage("QI_INST_ADDED_SUCCESSFUL")}}},addPropertyGroup:function(updateGui){this.propertyAddClicked=true;var typeRow=$("dialoguecontent").rows.length-2;if($("dialoguecontent").rows[typeRow].cells[1].innerHTML==gLanguage.getMessage("QI_PROPERTY_TYPE")+
":")return;this.propertyAddClicked=false;var pname="";var propInputFields=$("dialoguecontent").getElementsByTagName("input");for(var i=0,n=propInputFields.length;i<n;i++)pname+=propInputFields[i].value+".";pname=pname.replace(/\.$/,"");var subqueryIds=Array();if(pname==""){$("qistatus").innerHTML=gLanguage.getMessage("QI_ENTER_PROPERTY_NAME");this.updateHeightBoxcontent()}else{var pshow=$("input_c1").checked;var colName=pshow?$("input_c3").value:null;var showUnit=pshow?$("input_c4").value:null;var pmust=
$("input_c2").checked;var arity=this.proparity;var selector=this.getPropertyValueSelector();var pgroup=new PropertyGroup(escapeQueryHTML(pname),arity,pshow,pmust,this.propIsEnum,this.enumValues,selector,showUnit,colName);pgroup.setUnits(this.propUnits);var allValueRows=$("dialoguecontent_pvalues").rows.length;if(selector!=-2){var paramname=$("dialoguecontent").rows[$("dialoguecontent").rows.length-2].cells[1].innerHTML;paramname=paramname.replace(gLanguage.getMessage("QI_PROPERTY_TYPE")+": ","");
if(selector==-1)if(arity==2)pgroup.addValue(paramname,"=","*");else for(s=1;s<arity;s++)pgroup.addValue($("dialoguecontent_pvalues").rows[s].cells[0].innerHTML,"=","*");else{if(selector<this.nextQueryId)paramvalue=selector;else{paramvalue=this.nextQueryId;subqueryIds.push(this.nextQueryId);this.addQuery(this.activeQueryId,pname)}if(window.smwhgLogger){var logstr="Add subquery to query, property '"+pname+"'";smwhgLogger.log(logstr,"QI","query_subquery_added")}pgroup.addValue("subquery","=",paramvalue)}}else for(var i=
0;i<allValueRows;i++){try{var paramvalue=$("dialoguecontent_pvalues").rows[i].cells[2].firstChild.value}catch(e){continue}paramvalue=paramvalue==""?"*":paramvalue;var paramname;if(arity==2){paramname=$("dialoguecontent").rows[$("dialoguecontent").rows.length-2].cells[1].innerHTML;paramname=paramname.replace(gLanguage.getMessage("QI_PROPERTY_TYPE")+": ","")}else paramname=$("dialoguecontent_pvalues").rows[i].cells[0].innerHTML;var restriction=$("dialoguecontent_pvalues").rows[i].cells[1].firstChild.value;
var unit=null;try{unit=$("dialoguecontent_pvalues").rows[i].cells[2].firstChild.nextSibling.value}catch(e){}pgroup.addValue(paramname,restriction,escapeQueryHTML(paramvalue),unit)}if(window.smwhgLogger){var logstr="Add property "+pname+" to query";smwhgLogger.log(logstr,"QI","query_property_added")}this.activeQuery.addPropertyGroup(pgroup,subqueryIds,this.loadedFromId);this.emptyDialogue();this.updateColumnPreview();$("qistatus").innerHTML=gLanguage.getMessage("QI_PROP_ADDED_SUCCESSFUL");if(selector>
0)this.setActiveQuery(selector)}if(updateGui){this.updateTree();this.updateSrcAndPreview();this.updateBreadcrumbs(this.activeQueryId);this.loadedFromID=null}},switchTab:function(id,flush){var divcontainer=["treeview","","qisource"];if(!flush)if(id==3){this.showFullAsk("parser",false);$("query4DiscardChanges").innerHTML=escapeQueryHTML($("fullAskText").value)}else{this.loadFromSource();$("query4DiscardChanges").innerHTML=""}for(var i=0;i<divcontainer.length;i++){if(divcontainer[i].length==0)continue;
if(id==i+1){$("qiDefTab"+(i+1)).className="qiDefTabActive";$(divcontainer[i]).style.display="inline"}else{$("qiDefTab"+(i+1)).className="qiDefTabInactive";$(divcontainer[i]).style.display="none"}}},switchMainTab:function(noreset){if($("qiMainTab1").className=="qiDefTabActive"){$("qiMainTab1").className="qiDefTabInactive";$("qiMainTab2").className="qiDefTabActive";$("qiMaintabQueryCont").style.display="none";$("qiMaintabLoadCont").style.display="";var treeContent=$("qiDefTab").innerHTML;$("qiDefTab").innerHTML=
"";$("qiDefTabInLoad").innerHTML=treeContent;$("qisourceButtons").style.display="none";if(!this.queries[0].isEmpty())QIHelperSavedQuery=this.getFullParserAsk();if(this.queryList)this.queryList.selectRow();$("qiLoadConditionTerm").focus()}else{$("qiMainTab2").className="qiDefTabInactive";$("qiMainTab1").className="qiDefTabActive";$("qiMaintabQueryCont").style.display="";$("qiMaintabLoadCont").style.display="none";var treeContent=$("qiDefTabInLoad").innerHTML;$("qiDefTabInLoad").innerHTML="";$("qiDefTab").innerHTML=
treeContent;$("qisourceButtons").style.display="";if(QIHelperSavedQuery)this.initFromQueryString(QIHelperSavedQuery);else if(!noreset)this.doReset()}},searchQueries:function(){this.queryList=new QIList;this.queryList.search()},resetSearch:function(){this.queryList=new QIList;this.queryList.reset();$("qiLoadConditionTerm").focus()},loadSelectedQuery:function(){QIHelperSavedQuery=null;this.switchMainTab(true);this.updateTree()},updateSearchAc:function(){var constraint,oldConstr=$("qiLoadConditionTerm").getAttribute("constraints");
switch($("qiLoadCondition").value){case "p":case "s":constraint="namespace: 102";break;case "c":constraint="namespace: 14";break;case "i":constraint="namespace: 0";break;case "*":constraint="namespace: 14,102,0";break}if(constraint!=oldConstr){autoCompleter.deregisterAllInputs();if(constraint){$("qiLoadConditionTerm").setAttribute("constraints",constraint);$("qiLoadConditionTerm").addClassName("wickEnabled")}else{$("qiLoadConditionTerm").removeAttribute("constraints");$("qiLoadConditionTerm").removeClassName("wickEnabled")}autoCompleter.registerAllInputs()}},
discardChangesOfSource:function(){$("fullAskText").value=$("query4DiscardChanges").innerHTML.unescapeHTML();this.sourceChanged=1;this.loadFromSource(true)},copyToClipboard:function(){if(this.queries[0].isEmpty())alert(gLanguage.getMessage("QI_EMPTY_QUERY"));else if($("layout_format").value=="template"&&$("template_name").value=="")alert(gLanguage.getMessage("QI_EMPTY_TEMPLATE"));else{if(window.smwhgLogger)smwhgLogger.log("Copy query to clipboard","QI","query_copied");var text=this.getFullParserAsk();
if(window.clipboardData){window.clipboardData.setData("Text",text);if(!this.isExcelBridge)alert(gLanguage.getMessage("QI_CLIPBOARD_SUCCESS"))}else if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var clip=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!clip){alert(gLanguage.getMessage("QI_CLIPBOARD_FAIL"));return}var trans=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);
if(!trans){alert(gLanguage.getMessage("QI_CLIPBOARD_FAIL"));return}trans.addDataFlavor("text/unicode");var str=new Object;var len=new Object;var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);str.data=text;trans.setTransferData("text/unicode",str,text.length*2);var clipid=Components.interfaces.nsIClipboard;if(!clip){alert(gLanguage.getMessage("QI_CLIPBOARD_FAIL"));return}clip.setData(trans,null,clipid.kGlobalClipboard);if(!this.isExcelBridge)alert(gLanguage.getMessage("QI_CLIPBOARD_SUCCESS"))}catch(e){alert(gLanguage.getMessage("QI_CLIPBOARD_FAIL"))}else alert(gLanguage.getMessage("QI_CLIPBOARD_FAIL"))}},
showFullAsk:function(type,toggle){if(toggle){$("shade").toggle();$("showAsk").toggle()}if(this.queries[0].isEmpty()){$("fullAskText").value="";return}else if($("layout_format").value=="template"&&$("template_name").value==""){$("fullAskText").value="";alert(gLanguage.getMessage("QI_EMPTY_TEMPLATE"));return}var ask=this.getFullParserAsk();ask=ask.replace(/\]\]\[\[/g,"]]\n[[");ask=ask.replace(/>\[\[/g,">\n[[");ask=ask.replace(/\]\]</g,"]]\n<");if(type=="parser")ask=ask.replace(/([^\|]{1})\|{1}(?!\|)/g,
"$1\n|");$("fullAskText").value=ask;this.queryFormated=true},showLoadDialogue:function(){sajax_do_call("smwf_qi_QIAccess",["loadQuery","Query:SaveTestQ"],this.loadQuery.bind(this))},loadQuery:function(request){alert(request.responseText)},showSaveDialogue:function(){$("shade").toggle();$("savedialogue").toggle()},doSave:function(){if(!this.queries[0].isEmpty()){if(this.pendingElement)this.pendingElement.remove();this.pendingElement=new OBPendingIndicator($("savedialogue"));this.pendingElement.show();
var params=$("saveName").value+",";params+=this.getFullParserAsk();sajax_do_call("smwf_qi_QIAccess",["saveQuery",params],this.saveDone.bind(this))}else{var request=Array();request.responseText="empty";this.saveDone(request)}},saveDone:function(request){this.pendingElement.hide();if(request.responseText=="empty"){alert(gLanguage.getMessage("QI_EMPTY_QUERY"));$("shade").toggle();$("savedialogue").toggle();$("saveName").value=""}else if(request.responseText=="exists"){alert(gLanguage.getMessage("QI_QUERY_EXISTS"));
$("saveName").value=""}else if(request.responseText=="true"){alert(gLanguage.getMessage("QI_QUERY_SAVED"));$("shade").toggle();$("savedialogue").toggle();$("saveName").value=""}else{alert(gLanguage.getMessage("QI_SAVE_ERROR"));$("shade").toggle();$("savedialogue").toggle()}},exportToXLS:function(){if(!this.queries[0].isEmpty()){var ask=this.recurseQuery(0);var params=ask+",";params+=$("layout_format").value+",";params+=$("layout_sort").value==""?",":$("layout_sort").value+",";params+=this.serializeSpecialQPParameters(",");
sajax_do_call("smwf_qi_QIAccess",["getQueryResultForDownload",params],this.initializeDownload.bind(this))}else{var request=Array();request.responseText=gLanguage.getMessage("QI_EMPTY_QUERY");this.openPreview(request)}},initializeDownload:function(request){encodedHtml=escape(request.responseText);encodedHtml=encodedHtml.replace(/\//g,"%2F");encodedHtml=encodedHtml.replace(/\?/g,"%3F");encodedHtml=encodedHtml.replace(/=/g,"%3D");encodedHtml=encodedHtml.replace(/&/g,"%26");encodedHtml=encodedHtml.replace(/@/g,
"%40");var url=wgServer+wgScriptPath+"/extensions/SMWHalo/specials/SMWQueryInterface/SMW_QIExport.php?q="+encodedHtml;window.open(url,"Download","height=1,width=1")},checkFormat:function(){this.getSpecialQPParameters($("layout_format").value);this.updateSrcAndPreview()},loadFromSource:function(noTabSwitch){this.noTabSwitch=noTabSwitch;if($("qiDefTab3").className.indexOf("qiDefTabActive")>-1&&$("fullAskText").value.length>0&&this.sourceChanged)this.initFromQueryString($("fullAskText").value);if($("fullAskText").value.length==
0)$("previewcontent").innerHTML=""},initFromQueryString:function(ask){this.doReset();if(ask.replace(/^\s+/,"").replace(/\s+$/,"").length==0)return;if(ask.indexOf("#sparql:")!=-1){if(ask.match(/\sselect\s/i)){alert(gLanguage.getMessage("QI_SPARQL_NOT_SUPPORTED"));return}var triplestoreSwitch=$("usetriplestore");if(triplestoreSwitch)triplestoreSwitch.checked=true}var sub=this.splitQueryParts(ask);if(sub.length==0)return;this.queryPartsFromInitByAsk=sub;var propertiesInQuery=new Array;for(var i=0;i<
sub.length;i++){var props=sub[i].match(/\[\[([\w\d _\.]*)::.*?\]\]/g);if(!props)props=[];for(var j=0;j<props.length;j++){var pname=escapeQueryHTML(props[j].substring(2,props[j].indexOf("::")));var pchain=pname.split(".");pchain=pchain.firstUpperCase();for(var c=0;c<pchain.length;c++)if(!propertiesInQuery.inArray(pchain[c]))propertiesInQuery.push(pchain[c])}}var props=sub[0].split("|");for(var i=1;i<props.length;i++)if(props[i].match(/^\s*\?/)){var pname=props[i].substring(props[i].indexOf("?")+1,
props[i].length);pname=pname.replace(/^([^#|=]*).*/,"$1");pname=escapeQueryHTML(pname.replace(/\s*$/,""));var pchain=pname.split(".");pchain=pchain.firstUpperCase();for(var c=0;c<pchain.length;c++)if(!propertiesInQuery.inArray(pchain[c]))propertiesInQuery.push(pchain[c])}if(propertiesInQuery.length>0){propertiesInQuery.unshift("getPropertyTypes");sajax_do_call("smwf_qi_QIAccess",propertiesInQuery,this.parsePropertyTypes.bind(this))}else this.parseQueryString()},parsePropertyTypes:function(request){if(request.status==
200)this.savePropertyInformation(request.responseText);this.parseQueryString()},parseQueryString:function(){var sub=this.queryPartsFromInitByAsk;var pMustShow=this.applyOptionParams(sub[0]);for(var f=0;f<sub.length;f++){this.activeQuery=this.queries[f];this.activeQueryId=f;var tmp=sub[f].replace(/\|\|/g,"%%!!%%").split("|"),tmp2=[""];for(var t=0;t<tmp.length;t++)if(tmp[t].match(/^\s*\[\[/)&&tmp[t].match(/\]\]\s*$/))tmp2[0]+=tmp[t];else tmp2.push(tmp[t]);sub[f]=tmp2.join("|").replace(/%%!!%%/g,"||");
var args=sub[f].split(/\]\]\s*\[\[/);args[args.length-1]=args[args.length-1].substring(0,args[args.length-1].indexOf("]]"));args[0]=args[0].replace(/^\s*\[\[/,"");this.handleQueryString(args,f,pMustShow)}this.setActiveQuery(0);this.updateTree();this.updateColumnPreview();this.updatePreview()},savePropertyInformation:function(xml){var xmlDoc=GeneralXMLTools.createDocumentFromString(xml);var prop=xmlDoc.getElementsByTagName("relationSchema");var returnedPropNames=[];for(var i=0;i<prop.length;i++){var pname=
prop.item(i).getAttribute("name");returnedPropNames.push(pname);var arity=parseInt(prop.item(i).getAttribute("arity"));var ptype=prop.item(i).getElementsByTagName("param")[0].getAttribute("name");var noval=new Array;var enumValues=[];var unitVals=new Array;var prange=prop.item(i).getElementsByTagName("param")[0].getAttribute("range");if(arity==2){noval=prop.item(i).getElementsByTagName("allowedValue");for(var j=0;j<noval.length;j++)enumValues.push(noval.item(j).getAttribute("value"));var units=prop.item(i).getElementsByTagName("unit");
var uvals=new Array;for(var j=0;j<units.length;j++)uvals.push(units.item(j).getAttribute("label"));if(uvals.length>0){unitVals.push(uvals);if(!this.numTypes[ptype.toLowerCase()])this.numTypes[ptype.toLowerCase()]=true}}var isEnum=noval.length>0?true:false;var pgroup=new PropertyGroup(pname,arity,false,false,isEnum,enumValues);if(arity>2){var naryParams=prop.item(i).getElementsByTagName("param");for(k=0;k<naryParams.length;k++){var enumValNodes=naryParams.item(k).getElementsByTagName("allowedValue");
var enumVals=[];for(m=0;m<enumValNodes.length;m++)enumVals[m]=enumValNodes.item(m).getAttribute("value");pgroup.addValue(naryParams.item(k).getAttribute("name"),null,enumVals);var units=naryParams.item(k).getElementsByTagName("unit");var uvals=new Array;for(var m=0;m<units.length;m++)uvals.push(units.item(m).getAttribute("label"));unitVals.push(uvals)}}pgroup.setUnits(unitVals);this.propertyTypesList.add(pname,pgroup,[],ptype,prange)}return returnedPropNames},handleQueryString:function(args,queryId,
pMustShow){var propList=new PropertyList;var operators=["<","<<",">",">>","~","!","!~","\u2264","\u2265"];for(var i=0;i<args.length;i++)if(args[i].indexOf(gLanguage.getMessage("CATEGORY"))==0||args[i].indexOf("Category:")==0){var vals=args[i].substring(args[i].indexOf(":")+1).split(/\s*\|\|\s*/);this.activeQuery.addCategoryGroup(vals)}else if(args[i].indexOf("::")==-1){var vals=args[i].split(/\s*\|\|\s*/);this.activeQuery.addInstanceGroup(vals)}else{var pname=args[i].substring(0,args[i].indexOf("::"));
var pval=args[i].substring(args[i].indexOf("::")+2,args[i].length);var pchain=pname.split(".");pchain=pchain.firstUpperCase();pname=pchain[pchain.length-1];args[i]=pchain.join(".")+"::"+pval;var propdef=this.propertyTypesList.getPgroup(pname);var pshow=false;var unit=null;var column=null;if(queryId==0)for(var j=0;j<pMustShow.length;j++)if(pMustShow[j][0]==pchain.join(".")){pshow=true;unit=pMustShow[j][1];column=pMustShow[j][2];break}var pmust=args.inArray(pchain.join(".")+"::+");var arity=propdef?
propdef.getArity():2;var isEnum=propdef?propdef.isEnumeration():false;var enumValues=propdef?propdef.getEnumValues():[];var pgroup=new PropertyGroup(escapeQueryHTML(pchain.join(".")),arity,pshow,pmust,isEnum,enumValues,null,unit,column);if(arity>2){var naryVals=propdef.getValues();for(e=0;e<naryVals.length;e++)pgroup.addValue(naryVals[e][0],naryVals[e][1],naryVals[e][2])}pgroup.setUnits(propdef.getUnits());var subqueryIds=propList.getSubqueryIds(propList.getIndex(pchain.join(".")));if(!subqueryIds)subqueryIds=
new Array;var paramname=this.propertyTypesList&&this.propertyTypesList.getType(pname)?this.propertyTypesList.getType(pname):gLanguage.getMessage("QI_PAGE");var paramvalue;var restriction="=";if(pval.match(/___q\d+q___/)){paramname="subquery";paramvalue=parseInt(pval.replace(/___q(\d+)q___/,"$1"));this.insertQuery(paramvalue,queryId,pchain.join("."));subqueryIds.push(paramvalue);pgroup.addValue(paramname,restriction,paramvalue);pgroup.setSelector(paramvalue)}else{var skipMustShow=false;if(pval=="+")for(var k=
0;k<args.length;k++)if(args[k].indexOf(pchain.join("."))!=-1&&args[k]!=pchain.join(".")+"::+")skipMustShow=true;if(skipMustShow)continue;pgroup.setSelector(-2);if(pgroup.getArity()>2){var vals=pval.split(/\s*;\s*/);var valsDef=pgroup.getValues();pgroup.setValues();if(pval=="+"){vals[0]="";pgroup.setSelector(-1)}if(vals.length<valsDef.length)for(j=vals.length;j<valsDef.length;j++)vals.push("");for(j=0;j<vals.length;j++){var op=vals[j].match(/^([\!|<|>|=|~]{0,2})(.*)/);if(op[1].length>0){if(operators.inArray(op[1]))switch(op[1]){case "\u2264":restriction=
"<";break;case "\u2265":restriction=">";break;default:restriction=op[1]}else restriction="";paramvalue=op[2]}else{paramvalue=vals[j];restriction="="}var paramunit="";if(this.propertyTypesList.supportsUnits(pname)){op=paramvalue.match(/^\s*(\d+(\.\d+)?)(.*?)$/);if(op){paramvalue=op[1];paramunit=op[3].replace(/^\s+|\s+$/g,"")}}pgroup.addValue(valsDef.length>j?valsDef[j][0]:gLanguage.getMessage("QI_PAGE"),restriction,escapeQueryHTML(paramvalue),escapeQueryHTML(paramunit))}}else{if(pval=="+")pgroup.setSelector(-1);
var vals=pval.split(/\s*\|\|\s*/);for(var j=0;j<vals.length;j++){var op=vals[j].match(/^([\!|<|>|=|~]{0,2})(.*)/);if(op[1].length>0){if(operators.inArray(op[1]))switch(op[1]){case "\u2264":restriction="<";break;case "\u2265":restriction=">";break;default:restriction=op[1]}else restriction="";paramvalue=op[2]}else paramvalue=vals[j];if(paramvalue==""||paramvalue=="+")paramvalue="*";if(j>0)paramname=gLanguage.getMessage("QI_OR");var paramunit="";if(this.propertyTypesList.supportsUnits(pname)){op=paramvalue.match(/^\s*(\d+(\.\d+)?)(.*?)$/);
if(op){paramvalue=op[1];paramunit=op[3].replace(/^\s+|\s+$/g,"")}}pgroup.addValue(paramname,restriction,escapeQueryHTML(paramvalue),escapeQueryHTML(paramunit))}}}propList.addNew(pchain.join("."),pgroup,subqueryIds)}var propMerged=new Array;if(queryId==0)for(var i=0;i<pMustShow.length;i++){var pgroup;var pchain=pMustShow[i][0].split(".");pchain=pchain.firstUpperCase();var plocname=pchain[pchain.length-1];var defPgroup=this.propertyTypesList.getPgroup(plocname);var ptype=gLanguage.getMessage("QI_PAGE");
if(defPgroup){ptype=this.propertyTypesList.getType(plocname);pgroup=new PropertyGroup(escapeQueryHTML(pMustShow[i][0]),defPgroup.getArity(),true,false,defPgroup.isEnumeration(),defPgroup.getEnumValues(),-1,pMustShow[i][1],pMustShow[i][2]);pgroup.setUnits(defPgroup.getUnits());pgroup.addValue(ptype,"=","*")}else pgroup=new PropertyGroup(escapeQueryHTML(pMustShow[i][0]),2,true,false,null,null,-1,pMustShow[i][1],pMustShow[i][2]);var oldPgroup=propList.getPgroup(pMustShow[i][0]);var subqueryIds=[];if(oldPgroup!=
null&&!propMerged[pMustShow[i][0]]){pgroup.setValues(oldPgroup.getValues());pgroup.setSelector(oldPgroup.getSelector());pgroup.setMustBeSet(oldPgroup.mustBeSet());subqueryIds=oldPgroup.getSubqueryIds()}if(propMerged[pMustShow[i][0]]==null)propList.add(pMustShow[i][0],pgroup,subqueryIds,ptype);else propList.addNew(pMustShow[i][0],pgroup,subqueryIds,ptype);propMerged[pMustShow[i][0]]=true}for(i=0;i<propList.length;i++){var pgroup=propList.getPgroupById(i);var subqueryIds=propList.getSubqueryIds(i);
this.activeQuery.addPropertyGroup(pgroup,subqueryIds)}},applyOptionParams:function(query){var options=query.split("|");var mustShow=[];$("qiQueryName").value="";var format="table";var tpeeParamsObj=new Object;var tpeePolicyId="";var useTscSwitch=false;var selectorDsTpee=$("qioptioncontent")?$("qioptioncontent").getElementsBySelector('[name="qiDsTpeeSelector"]'):[];for(var i=1;i<options.length;i++){var m=options[i].match(/^\s*\?/);if(m){m=options[i].replace(/\r?\n/g,"").match(/^(.*?)(#.*?)?(=.*?)?$/);
var pname=m[1].replace(/^\s*\?\s*/,"").replace(/\s*$/,"");pname=pname.substr(0,1).toUpperCase()+pname.substr(1);var punit=m[2]?m[2].replace(/#/,"").replace(/\s*$/,""):null;var col=m[3]?m[3].replace(/=\s*/,"").replace(/\s*$/,""):null;if(col==null){var pchain=pname.split(".");col=pchain[pchain.length-1];col=col.substr(0,1).toUpperCase()+col.substr(1)}mustShow.push([pname,punit,col]);continue}var kv=options[i].replace(/^\s*(.*?)\s*$/,"$1").split(/=/);if(kv.length==1)continue;var key=kv[0].replace(/^\s*(.*?)\s*$/,
"$1");var val=kv[1].replace(/^\s*(.*?)\s*$/,"$1");if(key=="format")format=val;else if(key=="sort")this.sortColumn=val;else if(key=="queryname")$("qiQueryName").value=val;else if(key=="enableRating"&&$("qio_showrating"))$("qio_showrating").checked="checked";else if(key=="metadata"&&$("qio_showmetadata")){$("qio_showmetadata").checked="checked";$("qio_showmetadata").value=val}else if(key=="source")useTscSwitch=val=="tsc"?true:false;else if(key=="dataspace"&&$("qidatasourceselector")){useTscSwitch=true;
var dsVals=val.split(",");for(var s=0;s<$("qidatasourceselector").length;s++){$("qidatasourceselector").options[s].selected=null;for(var t=0;t<dsVals.length;t++)if(dsVals[t].replace(/^\s*(.*?)\s*$/,"$1")==$("qidatasourceselector").options[s].value)$("qidatasourceselector").options[s].selected="selected"}}else if(key=="policyid"&&selectorDsTpee.length>0){useTscSwitch=true;tpeePolicyId=val;this.selectDsTpee(this.TPEE_SELECTED,true);for(var s=0;s<$("qitpeeselector").options.length;s++)if(val==$("qitpeeselector").options[s].value){$("qitpeeselector").options[s].selected=
"selected";$("qitpeeparams_"+val).style.display="inline"}else{var divId="qitpeeparams_"+$("qitpeeselector").options[s].value;$("qitpeeselector").options[s].selected=null;$(divId).style.display="none"}$("qitpeeparams_"+tpeePolicyId).style.display="inline"}else if(key=="policyparams"){val=val.replace(/^\s*/,"").replace(/\s*$/,"");tpeeParamsObj=JSON.parse(val)}}if(tpeeParamsObj)for(var parname in tpeeParamsObj){if(parname=="PAR_USER"){var wikigraph=$("qi_tsc_wikigraph").innerHTML||"";var userns=$("qi_tsc_userns").innerHTML||
"";tpeeParamsObj[parname]=tpeeParamsObj[parname].replace(wikigraph+"/"+userns+"/","")}else if(parname=="PAR_ORDER"){var table=$("qitpeeparamval_"+tpeePolicyId+"_PAR_ORDER");if(table){var orderValues=[];var parOrderArr=JSON.parse(tpeeParamsObj.PAR_ORDER);for(var t=0;t<table.rows.length;t++){orderValues.push(table.rows[t].cells[0].getAttribute("_sourceid"));table.deleteRow(t);t--}for(var t=0;t<parOrderArr.length;t++)if(orderValues.inArray(parOrderArr[t])){var row=table.insertRow(-1);var cell=row.insertCell(-1);
cell.setAttribute("onclick","qihelper.tpeeOrderSelect(this)");cell.setAttribute("_sourceid",parOrderArr[t]);cell.innerHTML=parOrderArr[t]}for(var t=0;t<orderValues.length;t++)if(!parOrderArr.inArray(orderValues[t])){var row=table.insertRow(-1);var cell=row.insertCell(-1);cell.setAttribute("onclick","qihelper.tpeeOrderSelect(this)");cell.setAttribute("_sourceid",orderValues[t]);cell.innerHTML=orderValues[t]}}}if($("qitpeeparamval_"+tpeePolicyId+"_"+parname))$("qitpeeparamval_"+tpeePolicyId+"_"+parname).value=
tpeeParamsObj[parname]}if($("usetriplestore"))$("usetriplestore").checked=useTscSwitch?"checked":null;var callback=function(){var qpChanged=false;for(var i=1;i<options.length;i++){var kv=options[i].replace(/^\s*(.*?)\s*$/,"$1").split(/=/);if(kv.length==1)continue;var key=kv[0].replace(/^\s*(.*?)\s*$/,"$1");var val=kv[1].replace(/^\s*(.*?)\s*$/,"$1");if(key=="format"){var layout_format=$("layout_format");layout_format.value=val;qpChanged=true}else{var optionParameter=$("qp_param_"+key);if(optionParameter==
null)continue;if(typeof optionParameter.type!="undefined"&&optionParameter.type.toLowerCase()=="checkbox")optionParameter.checked=val=="on"||val=="true";else optionParameter.value=val}}if(qpChanged)this.updatePreview()};this.getSpecialQPParameters(format,callback.bind(this));return mustShow},splitQueryParts:function(ask){ask=ask.replace(/^\s*\{\{#(ask|sparql):\s*/,"");ask=ask.replace(/\s*\}\}\s*$/,"");var sub=[];sub.push(ask);var todo;while(1){todo=null;if(sub.length>0)for(var i=0;i<sub.length;i++)if(sub[i].indexOf("<q>")!=
-1){todo=true;var pa=sub[i].indexOf("<q>");var pe=-4;var po=pa;var op=0;do{pe=sub[i].indexOf("</q>",pe+4);var po=sub[i].indexOf("<q>",po+3);if(po>-1&&po<pe)op++;else op--}while(op>0);sub.push(sub[i].substring(sub[i].indexOf("<q>")+3,pe));sub[i]=sub[i].substring(0,sub[i].indexOf("<q>"))+"___q"+(sub.length-1)+"q___"+sub[i].substring(pe+4)}if(!todo)break}return sub}};var PropertyGroup=Class.create();
PropertyGroup.prototype={initialize:function(name,arity,show,must,isEnum,enumValues,selector,showUnit,colName){this.name=name;this.arity=arity;this.show=show;this.must=must;this.isEnum=isEnum;this.enumValues=enumValues;this.selector=selector;this.showUnit=showUnit;this.colName=colName;this.values=Array();this.units=Array()},addValue:function(name,restriction,value,unit){this.values[this.values.length]=new Array(name,restriction,value,unit)},getName:function(){return this.name},getArity:function(){return this.arity},
isShown:function(){return this.show},mustBeSet:function(){return this.must},getValues:function(){return this.values},setValues:function(vals){this.values=!vals?new Array:vals},setUnits:function(vals){this.units=!vals?new Array:vals},setSelector:function(val){this.selector=val},setMustBeSet:function(val){this.must=val},supportsUnits:function(){return this.units.length>0&&this.units[0].length>0?true:false},getUnits:function(){return this.units},isEnumeration:function(){return this.isEnum},getEnumValues:function(){return this.enumValues},
getSelector:function(){return this.selector},getShowUnit:function(){return this.showUnit},getColName:function(){return this.colName?this.colName:""},getSubqueryIds:function(){var ids=[];for(var i=0;i<this.values.length;i++)if(this.values[i][0]=="subquery")ids.push(this.values[i][2]);return ids}};var PropertyList=Class.create();
PropertyList.prototype={initialize:function(){this.name=Array();this.pgroup=Array();this.subqueries=Array();this.type=Array();this.range=Array();this.length=0},add:function(name,pgroup,subqueries,type,range){for(var i=0;i<this.name.length;i++)if(this.name[i]==name){this.pgroup[i]=pgroup;this.subqueries[i]=subqueries?subqueries:[];this.type[i]=type;this.range[i]=range?range:"";return}this.addNew(name,pgroup,subqueries,type,range)},addNew:function(name,pgroup,subqueries,type,range){this.name.push(name);
this.pgroup.push(pgroup);this.subqueries.push(subqueries?subqueries:[]);this.type.push(type);this.range.push(range);this.length++},getPgroup:function(name){for(var i=0;i<this.name.length;i++)if(this.name[i]==name)return this.pgroup[i];return},getPgroupById:function(i){if(this.length>i)return this.pgroup[i];return},getSubqueryIds:function(i){if(this.length>i)return this.subqueries[i];return new Array},getIndex:function(name){for(var i=0;i<this.name.length;i++)if(this.name[i]==name)return i;return-1},
getType:function(name){for(var i=0;i<this.name.length;i++)if(this.name[i]==name)return this.type[i]},getRange:function(name){for(var i=0;i<this.name.length;i++)if(this.name[i]==name)return this.range[i]},supportsUnits:function(name){for(var i=0;i<this.name.length;i++)if(this.name[i]==name)return this.pgroup[i].supportsUnits()}};Event.observe(window,"load",initialize_qi);function initialize_qi(){if(!qihelper)qihelper=new QIHelper}
function initialize_qi_from_querystring(ask){if(!qihelper)qihelper=new QIHelper;qihelper.initFromQueryString(ask)}function initialize_qi_from_excelbridge(){if(!qihelper)qihelper=new QIHelper;qihelper.setExcelBridge()}function escapeQueryHTML(string){if(!string)return"";string=(""+string).escapeHTML();string=string.replace(/\"/g,"&quot;");return string}function unescapeQueryHTML(string){if(!string)return"";string=(""+string).unescapeHTML();string=string.replace(/&quot;/g,'"');return string}
if(!Array.prototype.inArray)Array.prototype.inArray=function in_array(val){for(var i=0;i<this.length;i++)if(val==this[i])return true;return false};if(!Array.prototype.firstUpperCase)Array.prototype.firstUpperCase=function(){var data=[];for(var i=0;i<this.length;i++)data.push(this[i].substr(0,1).toUpperCase()+this[i].substr(1));return data};var config=new Object;var tt_Debug=false;var tt_Enabled=true;var TagsToTip=true;config.Above=false;config.BgColor="#E4E7FF";config.BgImg="";config.BorderColor="#002299";config.BorderStyle="solid";config.BorderWidth=1;config.CenterMouse=false;config.ClickClose=false;config.CloseBtn=false;config.CloseBtnColors=["#990000","#FFFFFF","#DD3333","#FFFFFF"];config.CloseBtnText="&nbsp;X&nbsp;";config.CopyContent=true;config.Delay=400;config.Duration=0;config.FadeIn=0;config.FadeOut=0;config.FadeInterval=30;
config.Fix=null;config.FollowMouse=true;config.FontColor="#000044";config.FontFace="Verdana,Geneva,sans-serif";config.FontSize="8pt";config.FontWeight="normal";config.Left=false;config.OffsetX=14;config.OffsetY=8;config.Opacity=100;config.Padding=3;config.Shadow=false;config.ShadowColor="#C0C0C0";config.ShadowWidth=5;config.Sticky=false;config.TextAlign="left";config.Title="";config.TitleAlign="left";config.TitleBgColor="";config.TitleFontColor="#ffffff";config.TitleFontFace="";
config.TitleFontSize="";config.Width=200;function Tip(){tt_Tip(arguments,null)}function TagToTip(){if(TagsToTip){var t2t=tt_GetElt(arguments[0]);if(t2t)tt_Tip(arguments,t2t)}}var tt_aElt=new Array(10),tt_aV=new Array,tt_sContent,tt_scrlX=0,tt_scrlY=0,tt_musX,tt_musY,tt_over,tt_x,tt_y,tt_w,tt_h;function tt_Extension(){tt_ExtCmdEnum();tt_aExt[tt_aExt.length]=this;return this}
function tt_SetTipPos(x,y){var css=tt_aElt[0].style;tt_x=x;tt_y=y;css.left=x+"px";css.top=y+"px";if(tt_ie56){var ifrm=tt_aElt[tt_aElt.length-1];if(ifrm){ifrm.style.left=css.left;ifrm.style.top=css.top}}}
function tt_Hide(){if(tt_db&&tt_iState){if(tt_iState&2){tt_aElt[0].style.visibility="hidden";tt_ExtCallFncs(0,"Hide")}tt_tShow.EndTimer();tt_tHide.EndTimer();tt_tDurt.EndTimer();tt_tFade.EndTimer();if(!tt_op&&!tt_ie){tt_tWaitMov.EndTimer();tt_bWait=false}if(tt_aV[CLICKCLOSE])tt_RemEvtFnc(document,"mouseup",tt_HideInit);tt_AddRemOutFnc(false);tt_ExtCallFncs(0,"Kill");if(tt_t2t&&!tt_aV[COPYCONTENT]){tt_t2t.style.display="none";tt_MovDomNode(tt_t2t,tt_aElt[6],tt_t2tDad)}tt_iState=0;tt_over=null;tt_ResetMainDiv();
if(tt_aElt[tt_aElt.length-1])tt_aElt[tt_aElt.length-1].style.display="none"}}function tt_GetElt(id){return document.getElementById?document.getElementById(id):document.all?document.all[id]:null}function tt_GetDivW(el){return el?el.offsetWidth||el.style.pixelWidth||0:0}function tt_GetDivH(el){return el?el.offsetHeight||el.style.pixelHeight||0:0}function tt_GetScrollX(){return window.pageXOffset||(tt_db?tt_db.scrollLeft||0:0)}
function tt_GetScrollY(){return window.pageYOffset||(tt_db?tt_db.scrollTop||0:0)}function tt_GetClientW(){return document.body&&typeof document.body.clientWidth!=tt_u?document.body.clientWidth:typeof window.innerWidth!=tt_u?window.innerWidth:tt_db?tt_db.clientWidth||0:0}function tt_GetClientH(){return document.body&&typeof document.body.clientHeight!=tt_u?document.body.clientHeight:typeof window.innerHeight!=tt_u?window.innerHeight:tt_db?tt_db.clientHeight||0:0}
function tt_GetEvtX(e){return e?typeof e.pageX!=tt_u?e.pageX:e.clientX+tt_scrlX:0}function tt_GetEvtY(e){return e?typeof e.pageY!=tt_u?e.pageY:e.clientY+tt_scrlY:0}function tt_AddEvtFnc(el,sEvt,PFnc){if(el)if(el.addEventListener)el.addEventListener(sEvt,PFnc,false);else el.attachEvent("on"+sEvt,PFnc)}function tt_RemEvtFnc(el,sEvt,PFnc){if(el)if(el.removeEventListener)el.removeEventListener(sEvt,PFnc,false);else el.detachEvent("on"+sEvt,PFnc)}
var tt_aExt=new Array,tt_db,tt_op,tt_ie,tt_ie56,tt_bBoxOld,tt_body,tt_flagOpa,tt_maxPosX,tt_maxPosY,tt_iState=0,tt_opa,tt_bJmpVert,tt_t2t,tt_t2tDad,tt_elDeHref,tt_tShow=new Number(0),tt_tHide=new Number(0),tt_tDurt=new Number(0),tt_tFade=new Number(0),tt_tWaitMov=new Number(0),tt_bWait=false,tt_u="undefined";
function tt_Init(){tt_MkCmdEnum();if(!tt_Browser()||!tt_MkMainDiv())return;tt_IsW3cBox();tt_OpaSupport();tt_AddEvtFnc(document,"mousemove",tt_Move);if(TagsToTip||tt_Debug)tt_SetOnloadFnc();tt_AddEvtFnc(window,"scroll",function(){tt_scrlX=tt_GetScrollX();tt_scrlY=tt_GetScrollY();if(tt_iState&&!(tt_aV[STICKY]&&tt_iState&2))tt_HideInit()});tt_AddEvtFnc(window,"unload",tt_Hide);tt_Hide()}
function tt_MkCmdEnum(){var n=0;for(var i in config)eval("window."+i.toString().toUpperCase()+" = "+n++);tt_aV.length=n}
function tt_Browser(){var n,nv,n6,w3c;n=navigator.userAgent.toLowerCase(),nv=navigator.appVersion;tt_op=document.defaultView&&typeof eval("w"+"indow"+"."+"o"+"p"+"er"+"a")!=tt_u;tt_ie=n.indexOf("msie")!=-1&&document.all&&!tt_op;if(tt_ie){var ieOld=!document.compatMode||document.compatMode=="BackCompat";tt_db=!ieOld?document.documentElement:document.body||null;if(tt_db)tt_ie56=parseFloat(nv.substring(nv.indexOf("MSIE")+5))>=5.5&&typeof document.body.style.maxHeight==tt_u}else{tt_db=document.documentElement||
document.body||(document.getElementsByTagName?document.getElementsByTagName("body")[0]:null);if(!tt_op){n6=document.defaultView&&typeof document.defaultView.getComputedStyle!=tt_u;w3c=!n6&&document.getElementById}}tt_body=document.getElementsByTagName?document.getElementsByTagName("body")[0]:document.body||null;if(tt_ie||n6||tt_op||w3c)if(tt_body&&tt_db){if(document.attachEvent||document.addEventListener)return true}else tt_Err("wz_tooltip.js must be included INSIDE the body section,"+" immediately after the opening <body> tag.");
tt_db=null;return false}function tt_MkMainDiv(){if(tt_body.insertAdjacentHTML)tt_body.insertAdjacentHTML("afterBegin",tt_MkMainDivHtm());else if(typeof tt_body.innerHTML!=tt_u&&document.createElement&&tt_body.appendChild)tt_body.appendChild(tt_MkMainDivDom());if(window.tt_GetMainDivRefs&&tt_GetMainDivRefs())return true;tt_db=null;return false}
function tt_MkMainDivHtm(){return'<div id="WzTtDiV"></div>'+(tt_ie56?'<iframe id="WzTtIfRm" src="javascript:false" scrolling="no" frameborder="0" style="filter:Alpha(opacity=0);position:absolute;top:0px;left:0px;display:none;"></iframe>':"")}function tt_MkMainDivDom(){var el=document.createElement("div");if(el)el.id="WzTtDiV";return el}
function tt_GetMainDivRefs(){tt_aElt[0]=tt_GetElt("WzTtDiV");if(tt_ie56&&tt_aElt[0]){tt_aElt[tt_aElt.length-1]=tt_GetElt("WzTtIfRm");if(!tt_aElt[tt_aElt.length-1])tt_aElt[0]=null}if(tt_aElt[0]){var css=tt_aElt[0].style;css.visibility="hidden";css.position="absolute";css.overflow="hidden";return true}return false}function tt_ResetMainDiv(){var w=window.screen&&screen.width?screen.width:1E4;tt_SetTipPos(-w,0);tt_aElt[0].innerHTML="";tt_aElt[0].style.width=w-1+"px"}
function tt_IsW3cBox(){var css=tt_aElt[0].style;css.padding="10px";css.width="40px";tt_bBoxOld=tt_GetDivW(tt_aElt[0])==40;css.padding="0px";tt_ResetMainDiv()}function tt_OpaSupport(){var css=tt_body.style;tt_flagOpa=typeof css.filter!=tt_u?1:typeof css.KhtmlOpacity!=tt_u?2:typeof css.KHTMLOpacity!=tt_u?3:typeof css.MozOpacity!=tt_u?4:typeof css.opacity!=tt_u?5:0}
function tt_SetOnloadFnc(){tt_AddEvtFnc(document,"DOMContentLoaded",tt_HideSrcTags);tt_AddEvtFnc(window,"load",tt_HideSrcTags);if(tt_body.attachEvent)tt_body.attachEvent("onreadystatechange",function(){if(tt_body.readyState=="complete")tt_HideSrcTags()});if(/WebKit|KHTML/i.test(navigator.userAgent))var t=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(t);tt_HideSrcTags()}},10)}
function tt_HideSrcTags(){if(!window.tt_HideSrcTags||window.tt_HideSrcTags.done)return;window.tt_HideSrcTags.done=true;if(!tt_HideSrcTagsRecurs(tt_body))tt_Err("To enable the capability to convert HTML elements to tooltips,"+" you must set TagsToTip in the global tooltip configuration"+" to true.")}
function tt_HideSrcTagsRecurs(dad){var a,ovr,asT2t;a=dad.childNodes||dad.children||null;for(var i=a?a.length:0;i;){--i;if(!tt_HideSrcTagsRecurs(a[i]))return false;ovr=a[i].getAttribute?a[i].getAttribute("onmouseover"):typeof a[i].onmouseover=="function"?a[i].onmouseover:null;if(ovr){asT2t=ovr.toString().match(/TagToTip\s*\(\s*'[^'.]+'\s*[\),]/);if(asT2t&&asT2t.length)if(!tt_HideSrcTag(asT2t[0]))return false}}return true}
function tt_HideSrcTag(sT2t){var id,el;id=sT2t.replace(/.+'([^'.]+)'.+/,"$1");el=tt_GetElt(id);if(el)if(tt_Debug&&!TagsToTip)return false;else el.style.display="none";else tt_Err("Invalid ID\n'"+id+"'\npassed to TagToTip()."+" There exists no HTML element with that ID.");return true}
function tt_Tip(arg,t2t){if(!tt_db)return;if(tt_iState)tt_Hide();if(!tt_Enabled)return;tt_t2t=t2t;if(!tt_ReadCmds(arg))return;tt_iState=1|4;tt_AdaptConfig1();tt_MkTipContent(arg);tt_MkTipSubDivs();tt_FormatTip();tt_bJmpVert=false;tt_maxPosX=tt_GetClientW()+tt_scrlX-tt_w-1;tt_maxPosY=tt_GetClientH()+tt_scrlY-tt_h-1;tt_AdaptConfig2();tt_Move();tt_ShowInit()}
function tt_ReadCmds(a){var i;i=0;for(var j in config)tt_aV[i++]=config[j];if(a.length&1){for(i=a.length-1;i>0;i-=2)tt_aV[a[i-1]]=a[i];return true}tt_Err("Incorrect call of Tip() or TagToTip().\n"+"Each command must be followed by a value.");return false}
function tt_AdaptConfig1(){tt_ExtCallFncs(0,"LoadConfig");if(!tt_aV[TITLEBGCOLOR].length)tt_aV[TITLEBGCOLOR]=tt_aV[BORDERCOLOR];if(!tt_aV[TITLEFONTCOLOR].length)tt_aV[TITLEFONTCOLOR]=tt_aV[BGCOLOR];if(!tt_aV[TITLEFONTFACE].length)tt_aV[TITLEFONTFACE]=tt_aV[FONTFACE];if(!tt_aV[TITLEFONTSIZE].length)tt_aV[TITLEFONTSIZE]=tt_aV[FONTSIZE];if(tt_aV[CLOSEBTN]){if(!tt_aV[CLOSEBTNCOLORS])tt_aV[CLOSEBTNCOLORS]=new Array("","","","");for(var i=4;i;){--i;if(!tt_aV[CLOSEBTNCOLORS][i].length)tt_aV[CLOSEBTNCOLORS][i]=
i&1?tt_aV[TITLEFONTCOLOR]:tt_aV[TITLEBGCOLOR]}if(!tt_aV[TITLE].length)tt_aV[TITLE]=" "}if(tt_aV[OPACITY]==100&&typeof tt_aElt[0].style.MozOpacity!=tt_u&&!Array.every)tt_aV[OPACITY]=99;if(tt_aV[FADEIN]&&tt_flagOpa&&tt_aV[DELAY]>100)tt_aV[DELAY]=Math.max(tt_aV[DELAY]-tt_aV[FADEIN],100)}function tt_AdaptConfig2(){if(tt_aV[CENTERMOUSE])tt_aV[OFFSETX]-=tt_w-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0)>>1}
function tt_MkTipContent(a){if(tt_t2t)if(tt_aV[COPYCONTENT])tt_sContent=tt_t2t.innerHTML;else tt_sContent="";else tt_sContent=a[0];tt_ExtCallFncs(0,"CreateContentString")}
function tt_MkTipSubDivs(){var sCss="position:relative;margin:0px;padding:0px;border-width:0px;left:0px;top:0px;line-height:normal;width:auto;",sTbTrTd=' cellspacing=0 cellpadding=0 border=0 style="'+sCss+'"><tbody style="'+sCss+'"><tr><td ';tt_aElt[0].innerHTML=""+(tt_aV[TITLE].length?'<div id="WzTiTl" style="position:relative;z-index:1;">'+'<table id="WzTiTlTb"'+sTbTrTd+'id="WzTiTlI" style="'+sCss+'">'+tt_aV[TITLE]+"</td>"+(tt_aV[CLOSEBTN]?'<td align="right" style="'+sCss+'text-align:right;">'+
'<span id="WzClOsE" style="padding-left:2px;padding-right:2px;'+"cursor:"+(tt_ie?"hand":"pointer")+';" onmouseover="tt_OnCloseBtnOver(1)" onmouseout="tt_OnCloseBtnOver(0)" onclick="tt_HideInit()">'+tt_aV[CLOSEBTNTEXT]+"</span></td>":"")+"</tr></tbody></table></div>":"")+'<div id="WzBoDy" style="position:relative;z-index:0;">'+"<table"+sTbTrTd+'id="WzBoDyI" style="'+sCss+'">'+tt_sContent+"</td></tr></tbody></table></div>"+(tt_aV[SHADOW]?'<div id="WzTtShDwR" style="position:absolute;overflow:hidden;"></div>'+
'<div id="WzTtShDwB" style="position:relative;overflow:hidden;"></div>':"");tt_GetSubDivRefs();if(tt_t2t&&!tt_aV[COPYCONTENT]){tt_t2tDad=tt_t2t.parentNode||tt_t2t.parentElement||tt_t2t.offsetParent||null;if(tt_t2tDad){tt_MovDomNode(tt_t2t,tt_t2tDad,tt_aElt[6]);tt_t2t.style.display="block"}}tt_ExtCallFncs(0,"SubDivsCreated")}
function tt_GetSubDivRefs(){var aId=new Array("WzTiTl","WzTiTlTb","WzTiTlI","WzClOsE","WzBoDy","WzBoDyI","WzTtShDwB","WzTtShDwR");for(var i=aId.length;i;--i)tt_aElt[i]=tt_GetElt(aId[i-1])}
function tt_FormatTip(){var css,w,iOffY,iOffSh;if(tt_aV[TITLE].length){css=tt_aElt[1].style;css.background=tt_aV[TITLEBGCOLOR];css.paddingTop=(tt_aV[CLOSEBTN]?2:0)+"px";css.paddingBottom="1px";css.paddingLeft=css.paddingRight=tt_aV[PADDING]+"px";css=tt_aElt[3].style;css.color=tt_aV[TITLEFONTCOLOR];css.fontFamily=tt_aV[TITLEFONTFACE];css.fontSize=tt_aV[TITLEFONTSIZE];css.fontWeight="bold";css.textAlign=tt_aV[TITLEALIGN];if(tt_aElt[4]){css.paddingRight=(tt_aV[PADDING]<<1)+"px";css=tt_aElt[4].style;
css.background=tt_aV[CLOSEBTNCOLORS][0];css.color=tt_aV[CLOSEBTNCOLORS][1];css.fontFamily=tt_aV[TITLEFONTFACE];css.fontSize=tt_aV[TITLEFONTSIZE];css.fontWeight="bold"}if(tt_aV[WIDTH]>0)tt_w=tt_aV[WIDTH]+(tt_aV[PADDING]+tt_aV[BORDERWIDTH]<<1);else{tt_w=tt_GetDivW(tt_aElt[3])+tt_GetDivW(tt_aElt[4]);if(tt_aElt[4])tt_w+=tt_aV[PADDING]}iOffY=-tt_aV[BORDERWIDTH]}else{tt_w=0;iOffY=0}css=tt_aElt[5].style;css.top=iOffY+"px";if(tt_aV[BORDERWIDTH]){css.borderColor=tt_aV[BORDERCOLOR];css.borderStyle=tt_aV[BORDERSTYLE];
css.borderWidth=tt_aV[BORDERWIDTH]+"px"}if(tt_aV[BGCOLOR].length)css.background=tt_aV[BGCOLOR];if(tt_aV[BGIMG].length)css.backgroundImage="url("+tt_aV[BGIMG]+")";css.padding=tt_aV[PADDING]+"px";css.textAlign=tt_aV[TEXTALIGN];css=tt_aElt[6].style;css.color=tt_aV[FONTCOLOR];css.fontFamily=tt_aV[FONTFACE];css.fontSize=tt_aV[FONTSIZE];css.fontWeight=tt_aV[FONTWEIGHT];css.background="";css.textAlign=tt_aV[TEXTALIGN];if(tt_aV[WIDTH]>0)w=tt_aV[WIDTH]+(tt_aV[PADDING]+tt_aV[BORDERWIDTH]<<1);else w=tt_GetDivW(tt_aElt[6])+
(tt_aV[PADDING]+tt_aV[BORDERWIDTH]<<1);if(w>tt_w)tt_w=w;if(tt_aV[SHADOW]){tt_w+=tt_aV[SHADOWWIDTH];iOffSh=Math.floor(tt_aV[SHADOWWIDTH]*4/3);css=tt_aElt[7].style;css.top=iOffY+"px";css.left=iOffSh+"px";css.width=tt_w-iOffSh-tt_aV[SHADOWWIDTH]+"px";css.height=tt_aV[SHADOWWIDTH]+"px";css.background=tt_aV[SHADOWCOLOR];css=tt_aElt[8].style;css.top=iOffSh+"px";css.left=tt_w-tt_aV[SHADOWWIDTH]+"px";css.width=tt_aV[SHADOWWIDTH]+"px";css.background=tt_aV[SHADOWCOLOR]}else iOffSh=0;tt_SetTipOpa(tt_aV[FADEIN]?
0:tt_aV[OPACITY]);tt_FixSize(iOffY,iOffSh)}
function tt_FixSize(iOffY,iOffSh){var wIn,wOut,i;tt_aElt[0].style.width=tt_w+"px";tt_aElt[0].style.pixelWidth=tt_w;wOut=tt_w-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0);wIn=wOut;if(!tt_bBoxOld)wIn-=tt_aV[PADDING]+tt_aV[BORDERWIDTH]<<1;tt_aElt[5].style.width=wIn+"px";if(tt_aElt[1]){wIn=wOut-(tt_aV[PADDING]<<1);if(!tt_bBoxOld)wOut=wIn;tt_aElt[1].style.width=wOut+"px";tt_aElt[2].style.width=wIn+"px"}tt_h=tt_GetDivH(tt_aElt[0])+iOffY;if(tt_aElt[8])tt_aElt[8].style.height=tt_h-iOffSh+"px";i=tt_aElt.length-1;
if(tt_aElt[i]){tt_aElt[i].style.width=tt_w+"px";tt_aElt[i].style.height=tt_h+"px"}}function tt_DeAlt(el){var aKid;if(el.alt)el.alt="";if(el.title)el.title="";aKid=el.childNodes||el.children||null;if(aKid)for(var i=aKid.length;i;)tt_DeAlt(aKid[--i])}
function tt_OpDeHref(el){if(!tt_op)return;if(tt_elDeHref)tt_OpReHref();while(el){if(el.hasAttribute("href")){el.t_href=el.getAttribute("href");el.t_stats=window.status;el.removeAttribute("href");el.style.cursor="hand";tt_AddEvtFnc(el,"mousedown",tt_OpReHref);window.status=el.t_href;tt_elDeHref=el;break}el=el.parentElement}}function tt_ShowInit(){tt_tShow.Timer("tt_Show()",tt_aV[DELAY],true);if(tt_aV[CLICKCLOSE])tt_AddEvtFnc(document,"mouseup",tt_HideInit)}
function tt_OverInit(e){tt_over=e.target||e.srcElement;tt_DeAlt(tt_over);tt_OpDeHref(tt_over);tt_AddRemOutFnc(true)}
function tt_Show(){var css=tt_aElt[0].style;css.zIndex=Math.max(window.dd&&dd.z?dd.z+2:0,1010);if(tt_aV[STICKY]||!tt_aV[FOLLOWMOUSE])tt_iState&=~4;if(tt_aV[DURATION]>0)tt_tDurt.Timer("tt_HideInit()",tt_aV[DURATION],true);tt_ExtCallFncs(0,"Show");css.visibility="visible";tt_iState|=2;if(tt_aV[FADEIN])tt_Fade(0,0,tt_aV[OPACITY],Math.round(tt_aV[FADEIN]/tt_aV[FADEINTERVAL]));tt_ShowIfrm()}
function tt_ShowIfrm(){if(tt_ie56){var ifrm=tt_aElt[tt_aElt.length-1];if(ifrm){var css=ifrm.style;css.zIndex=tt_aElt[0].style.zIndex-1;css.display="block"}}}
function tt_Move(e){e=window.event||e;if(e){tt_musX=tt_GetEvtX(e);tt_musY=tt_GetEvtY(e)}if(tt_iState){if(!tt_over&&e)tt_OverInit(e);if(tt_iState&4){if(!tt_op&&!tt_ie){if(tt_bWait)return;tt_bWait=true;tt_tWaitMov.Timer("tt_bWait = false;",1,true)}if(tt_aV[FIX]){tt_iState&=~4;tt_SetTipPos(tt_aV[FIX][0],tt_aV[FIX][1])}else if(!tt_ExtCallFncs(e,"MoveBefore"))tt_SetTipPos(tt_PosX(),tt_PosY());tt_ExtCallFncs([tt_musX,tt_musY],"MoveAfter")}}}
function tt_PosX(){var x;x=tt_musX;if(tt_aV[LEFT])x-=tt_w+tt_aV[OFFSETX]-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0);else x+=tt_aV[OFFSETX];if(x>tt_maxPosX)x=tt_maxPosX;return x<tt_scrlX?tt_scrlX:x}function tt_PosY(){var y;if(tt_aV[ABOVE]&&(!tt_bJmpVert||tt_CalcPosYAbove()>=tt_scrlY+16))y=tt_DoPosYAbove();else if(!tt_aV[ABOVE]&&tt_bJmpVert&&tt_CalcPosYBelow()>tt_maxPosY-16)y=tt_DoPosYAbove();else y=tt_DoPosYBelow();if(y>tt_maxPosY)y=tt_DoPosYAbove();if(y<tt_scrlY)y=tt_DoPosYBelow();return y}
function tt_DoPosYBelow(){tt_bJmpVert=tt_aV[ABOVE];return tt_CalcPosYBelow()}function tt_DoPosYAbove(){tt_bJmpVert=!tt_aV[ABOVE];return tt_CalcPosYAbove()}function tt_CalcPosYBelow(){return tt_musY+tt_aV[OFFSETY]}function tt_CalcPosYAbove(){var dy=tt_aV[OFFSETY]-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0);if(tt_aV[OFFSETY]>0&&dy<=0)dy=1;return tt_musY-tt_h-dy}function tt_OnOut(){tt_AddRemOutFnc(false);if(!(tt_aV[STICKY]&&tt_iState&2))tt_HideInit()}
function tt_HideInit(){tt_ExtCallFncs(0,"HideInit");tt_iState&=~4;if(tt_flagOpa&&tt_aV[FADEOUT]){tt_tFade.EndTimer();if(tt_opa){var n=Math.round(tt_aV[FADEOUT]/(tt_aV[FADEINTERVAL]*(tt_aV[OPACITY]/tt_opa)));tt_Fade(tt_opa,tt_opa,0,n);return}}tt_tHide.Timer("tt_Hide();",1,false)}function tt_OpReHref(){if(tt_elDeHref){tt_elDeHref.setAttribute("href",tt_elDeHref.t_href);tt_RemEvtFnc(tt_elDeHref,"mousedown",tt_OpReHref);window.status=tt_elDeHref.t_stats;tt_elDeHref=null}}
function tt_Fade(a,now,z,n){if(n){now+=Math.round((z-now)/n);if(z>a?now>=z:now<=z)now=z;else tt_tFade.Timer("tt_Fade("+a+","+now+","+z+","+(n-1)+")",tt_aV[FADEINTERVAL],true)}now?tt_SetTipOpa(now):tt_Hide()}function tt_SetTipOpa(opa){tt_SetOpa(tt_aElt[5].style,opa);if(tt_aElt[1])tt_SetOpa(tt_aElt[1].style,opa);if(tt_aV[SHADOW]){opa=Math.round(opa*0.8);tt_SetOpa(tt_aElt[7].style,opa);tt_SetOpa(tt_aElt[8].style,opa)}}
function tt_OnCloseBtnOver(iOver){var css=tt_aElt[4].style;iOver<<=1;css.background=tt_aV[CLOSEBTNCOLORS][iOver];css.color=tt_aV[CLOSEBTNCOLORS][iOver+1]}function tt_Int(x){var y;return isNaN(y=parseInt(x))?0:y}function tt_AddRemOutFnc(bAdd){var PSet=bAdd?tt_AddEvtFnc:tt_RemEvtFnc;if(bAdd!=tt_AddRemOutFnc.bOn){PSet(tt_over,"mouseout",tt_OnOut);tt_AddRemOutFnc.bOn=bAdd;if(!bAdd)tt_OpReHref()}}tt_AddRemOutFnc.bOn=false;
Number.prototype.Timer=function(s,iT,bUrge){if(!this.value||bUrge)this.value=window.setTimeout(s,iT)};Number.prototype.EndTimer=function(){if(this.value){window.clearTimeout(this.value);this.value=0}};
function tt_SetOpa(css,opa){tt_opa=opa;if(tt_flagOpa==1)if(opa<100){var bVis=css.visibility!="hidden";css.zoom="100%";if(!bVis)css.visibility="visible";css.filter="alpha(opacity="+opa+")";if(!bVis)css.visibility="hidden"}else css.filter="";else{opa/=100;switch(tt_flagOpa){case 2:css.KhtmlOpacity=opa;break;case 3:css.KHTMLOpacity=opa;break;case 4:css.MozOpacity=opa;break;case 5:css.opacity=opa;break}}}
function tt_MovDomNode(el,dadFrom,dadTo){if(dadFrom)dadFrom.removeChild(el);if(dadTo)dadTo.appendChild(el)}function tt_Err(sErr){if(tt_Debug)alert("Tooltip Script Error Message:\n\n"+sErr)}function tt_ExtCmdEnum(){var s;for(var i in config){s="window."+i.toString().toUpperCase();if(eval("typeof("+s+") == tt_u")){eval(s+" = "+tt_aV.length);tt_aV[tt_aV.length]=null}}}
function tt_ExtCallFncs(arg,sFnc){var b=false;for(var i=tt_aExt.length;i;){--i;var fnc=tt_aExt[i]["On"+sFnc];if(fnc&&fnc(arg))b=true}return b}tt_Init();addOnloadHook(smw_tooltipInit);BubbleTT=new Object;BubbleTT.Platform=new Object;var tt=null;var all_tt=[];var imagePath=wgScriptPath+"/extensions/SemanticMediaWiki/skins/images/";var SMWTT_WIDTH_P=200;var SMWTT_HEIGHT_P=80;var SMWTT_WIDTH_I=175;var SMWTT_HEIGHT_I=70;
function smw_tooltipInit(){var anchs=document.getElementsByTagName("span");for(var i=0;i<anchs.length;i++){if(anchs[i].className=="smwttpersist")smw_makePersistentTooltip(anchs[i]);if(anchs[i].className=="smwttinline")smw_makeInlineTooltip(anchs[i])}}
function smw_makeInlineTooltip(a){var spans=a.getElementsByTagName("span");a.className="smwttactiveinline";for(var i=0;i<spans.length;i++)if(spans[i].className=="smwttcontent")spans[i].style.display="none";a.onmouseover=smw_showTooltipInline;a.onmouseout=smw_hideTooltip}
function smw_makePersistentTooltip(a){var spans=a.getElementsByTagName("span");a.className="smwttactivepersist";for(var i=0;i<spans.length;i++){if(spans[i].className=="smwtticon"){img=document.createElement("img");img.setAttribute("src",imagePath+spans[i].innerHTML);img.className="smwttimg";a.replaceChild(img,a.firstChild)}if(spans[i].className=="smwttcontent")spans[i].style.display="none"}if(BubbleTT.Platform.browser.isIE)a.attachEvent("onclick",smw_showTooltipPersist);else a.addEventListener("click",
smw_showTooltipPersist,false)}
function smw_showTooltipPersist(e){var x;var y;if(BubbleTT.Platform.browser.isIE){c=BubbleTT.getElementCoordinates(window.event.srcElement);x=c.left;y=c.top}else{x=e.pageX;y=e.pageY}var origin=BubbleTT.Platform.browser.isIE?window.event.srcElement:e.target;while(!(origin.className=="smwttactivepersist"))origin=origin.parentNode;tt=BubbleTT.createBubbleForPoint(true,origin,x,y,SMWTT_WIDTH_P,SMWTT_HEIGHT_P);all_tt.push(tt);BubbleTT.fillBubble(tt,origin);if(BubbleTT.Platform.browser.isIE)origin.detachEvent("onclick",smw_showTooltipPersist);
else origin.removeEventListener("click",smw_showTooltipPersist,false)}
function smw_showTooltipInline(e){if(tt!=null)return;var x;var y;if(BubbleTT.Platform.browser.isIE){c=BubbleTT.getElementCoordinates(window.event.srcElement);x=c.left;y=c.top}else{x=e.pageX;y=e.pageY}var origin=BubbleTT.Platform.browser.isIE?window.event.srcElement:e.target;while(!(origin.className=="smwttactiveinline"))origin=origin.parentNode;var doc=origin.ownerDocument;tt=BubbleTT.createBubbleForPoint(false,origin,x,y,SMWTT_WIDTH_I,SMWTT_HEIGHT_I);BubbleTT.fillBubble(tt,origin)}
function smw_hideTooltip(){if(tt){tt.close();tt=null}}function _smw_hideAllTooltips(){for(var i=0;i<all_tt.length;i++)all_tt[i].close();all_tt=[]}BubbleTT.getElementCoordinates=function(elmt){var left=0;var top=0;if(elmt.nodeType!=1)elmt=elmt.parentNode;while(elmt!=null){left+=elmt.offsetLeft;top+=elmt.offsetTop-(elmt.scrollTop?elmt.scrollTop:0);elmt=elmt.offsetParent}top+=document.documentElement.scrollTop;return{left:left,top:top}};BubbleTT._bubbleMargins={top:33,bottom:42,left:33,right:40};
BubbleTT._arrowOffsets={top:0,bottom:9,left:1,right:8};BubbleTT._bubblePadding=15;BubbleTT._bubblePointOffset=15;BubbleTT._halfArrowWidth=18;
BubbleTT.createBubbleForPoint=function(closingButton,origin,pageX,pageY,contentWidth,contentHeight){var doc=origin.ownerDocument;var bubble={_closed:false,_doc:doc,close:function(){if(!this._closed){this._doc.body.removeChild(this._div);this._doc=null;this._div=null;this._content=null;this._closed=true;if(closingButton)if(BubbleTT.Platform.browser.isIE)origin.attachEvent("onclick",smw_showTooltipPersist);else origin.addEventListener("click",smw_showTooltipPersist,false)}}};var docWidth=doc.body.offsetWidth;
var docHeight=doc.body.offsetHeight;var margins=BubbleTT._bubbleMargins;var bubbleWidth=margins.left+contentWidth+margins.right;var bubbleHeight=margins.top+contentHeight+margins.bottom;var pngIsTranslucent=!BubbleTT.Platform.browser.isIE||BubbleTT.Platform.browser.majorVersion>6;var setImg=function(elmt,url,width,height){elmt.style.position="absolute";elmt.style.width=width+"px";elmt.style.height=height+"px";if(pngIsTranslucent)elmt.style.background="url("+url+")";else elmt.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+
url+"', sizingMethod='crop')"};var div=doc.createElement("div");div.style.width=bubbleWidth+"px";div.style.height=bubbleHeight+"px";div.style.position="absolute";div.style.zIndex=1E3;bubble._div=div;var divInner=doc.createElement("div");divInner.style.width="100%";divInner.style.height="100%";divInner.style.position="relative";div.appendChild(divInner);var createImg=function(url,left,top,width,height){var divImg=doc.createElement("div");divImg.style.left=left+"px";divImg.style.top=top+"px";setImg(divImg,
url,width,height);divInner.appendChild(divImg)};createImg(imagePath+"bubble-top-left.png",0,0,margins.left,margins.top);createImg(imagePath+"bubble-top.png",margins.left,0,contentWidth,margins.top);createImg(imagePath+"bubble-top-right.png",margins.left+contentWidth,0,margins.right,margins.top);createImg(imagePath+"bubble-left.png",0,margins.top,margins.left,contentHeight);createImg(imagePath+"bubble-right.png",margins.left+contentWidth,margins.top,margins.right,contentHeight);createImg(imagePath+
"bubble-bottom-left.png",0,margins.top+contentHeight,margins.left,margins.bottom);createImg(imagePath+"bubble-bottom.png",margins.left,margins.top+contentHeight,contentWidth,margins.bottom);createImg(imagePath+"bubble-bottom-right.png",margins.left+contentWidth,margins.top+contentHeight,margins.right,margins.bottom);if(closingButton){var divClose=doc.createElement("div");divClose.style.left=bubbleWidth-margins.right+BubbleTT._bubblePadding-16-2+"px";divClose.style.top=margins.top-BubbleTT._bubblePadding+
1+"px";divClose.style.cursor="pointer";setImg(divClose,imagePath+"close-button.png",16,16);BubbleTT.DOM.registerEventWithObject(divClose,"click",bubble,bubble.close);divInner.appendChild(divClose)}var divContent=doc.createElement("div");divContent.style.position="absolute";divContent.style.left=margins.left+"px";divContent.style.top=margins.top+"px";divContent.style.width=contentWidth+"px";divContent.style.height=contentHeight+"px";divContent.style.overflow="auto";divContent.style.background="white";
divInner.appendChild(divContent);bubble.content=divContent;(function(){if(pageX-BubbleTT._halfArrowWidth-BubbleTT._bubblePadding>0&&pageX+BubbleTT._halfArrowWidth+BubbleTT._bubblePadding<docWidth){var left=pageX-Math.round(contentWidth/2)-margins.left;left=pageX<docWidth/2?Math.max(left,-(margins.left-BubbleTT._bubblePadding)):Math.min(left,docWidth+(margins.right-BubbleTT._bubblePadding)-bubbleWidth);if(pageY-BubbleTT._bubblePointOffset-bubbleHeight>0){var divImg=doc.createElement("div");divImg.style.left=
pageX-BubbleTT._halfArrowWidth-left+"px";divImg.style.top=margins.top+contentHeight+"px";setImg(divImg,imagePath+"bubble-bottom-arrow.png",37,margins.bottom);divInner.appendChild(divImg);div.style.left=left+"px";div.style.top=pageY-BubbleTT._bubblePointOffset-bubbleHeight+BubbleTT._arrowOffsets.bottom+"px";return}else if(pageY+BubbleTT._bubblePointOffset+bubbleHeight<docHeight){var divImg=doc.createElement("div");divImg.style.left=pageX-BubbleTT._halfArrowWidth-left+"px";divImg.style.top="0px";setImg(divImg,
imagePath+"bubble-top-arrow.png",37,margins.top);divInner.appendChild(divImg);div.style.left=left+"px";div.style.top=pageY+BubbleTT._bubblePointOffset-BubbleTT._arrowOffsets.top+"px";return}}var top=pageY-Math.round(contentHeight/2)-margins.top;top=pageY<docHeight/2?Math.max(top,-(margins.top-BubbleTT._bubblePadding)):Math.min(top,docHeight+(margins.bottom-BubbleTT._bubblePadding)-bubbleHeight);if(pageX-BubbleTT._bubblePointOffset-bubbleWidth>0){var divImg=doc.createElement("div");divImg.style.left=
margins.left+contentWidth+"px";divImg.style.top=pageY-BubbleTT._halfArrowWidth-top+"px";setImg(divImg,imagePath+"bubble-right-arrow.png",margins.right,37);divInner.appendChild(divImg);div.style.left=pageX-BubbleTT._bubblePointOffset-bubbleWidth+BubbleTT._arrowOffsets.right+"px";div.style.top=top+"px"}else{var divImg=doc.createElement("div");divImg.style.left="0px";divImg.style.top=pageY-BubbleTT._halfArrowWidth-top+"px";setImg(divImg,imagePath+"bubble-left-arrow.png",margins.left,37);divInner.appendChild(divImg);
div.style.left=pageX+BubbleTT._bubblePointOffset-BubbleTT._arrowOffsets.left+"px";div.style.top=top+"px"}})();doc.body.appendChild(div);return bubble};BubbleTT.fillBubble=function(bubble,origin){doc=bubble._doc;div=doc.createElement("div");div.className="smwtt";spans=origin.getElementsByTagName("span");for(i=0;i<spans.length;i++)if(spans[i].className=="smwttcontent"){div.innerHTML=spans[i].innerHTML.replace(/\n/g,"<br />");div.innerHTML=spans[i].innerHTML.replace(/<!--br--\>/g,"<br />")}bubble.content.appendChild(div)};
BubbleTT.Platform.os={isMac:false,isWin:false,isWin32:false,isUnix:false};BubbleTT.Platform.browser={isIE:false,isNetscape:false,isMozilla:false,isFirefox:false,isOpera:false,isSafari:false,majorVersion:0,minorVersion:0};
(function(){var an=navigator.appName.toLowerCase();var ua=navigator.userAgent.toLowerCase();BubbleTT.Platform.os.isMac=ua.indexOf("mac")!=-1;BubbleTT.Platform.os.isWin=ua.indexOf("win")!=-1;BubbleTT.Platform.os.isWin32=BubbleTT.Platform.isWin&&(ua.indexOf("95")!=-1||ua.indexOf("98")!=-1||ua.indexOf("nt")!=-1||ua.indexOf("win32")!=-1||ua.indexOf("32bit")!=-1);BubbleTT.Platform.os.isUnix=ua.indexOf("x11")!=-1;BubbleTT.Platform.browser.isIE=an.indexOf("microsoft")!=-1;BubbleTT.Platform.browser.isNetscape=
an.indexOf("netscape")!=-1;BubbleTT.Platform.browser.isMozilla=ua.indexOf("mozilla")!=-1;BubbleTT.Platform.browser.isFirefox=ua.indexOf("firefox")!=-1;BubbleTT.Platform.browser.isOpera=an.indexOf("opera")!=-1;var parseVersionString=function(s){var a=s.split(".");BubbleTT.Platform.browser.majorVersion=parseInt(a[0]);BubbleTT.Platform.browser.minorVersion=parseInt(a[1])};var indexOf=function(s,sub,start){var i=s.indexOf(sub,start);return i>=0?i:s.length};if(BubbleTT.Platform.browser.isMozilla){var offset=
ua.indexOf("mozilla/");if(offset>=0)parseVersionString(ua.substring(offset+8,indexOf(ua," ",offset)))}if(BubbleTT.Platform.browser.isIE){var offset=ua.indexOf("msie ");if(offset>=0)parseVersionString(ua.substring(offset+5,indexOf(ua,";",offset)))}if(BubbleTT.Platform.browser.isNetscape){var offset=ua.indexOf("rv:");if(offset>=0)parseVersionString(ua.substring(offset+3,indexOf(ua,")",offset)))}if(BubbleTT.Platform.browser.isFirefox){var offset=ua.indexOf("firefox/");if(offset>=0)parseVersionString(ua.substring(offset+
8,indexOf(ua," ",offset)))}})();BubbleTT.Platform.getDefaultLocale=function(){return BubbleTT.Platform.clientLocale};BubbleTT.DOM=new Object;BubbleTT.DOM.registerEventWithObject=function(elmt,eventName,obj,handler){BubbleTT.DOM.registerEvent(elmt,eventName,function(elmt2,evt,target){return handler.call(obj,elmt2,evt,target)})};
BubbleTT.DOM.registerEvent=function(elmt,eventName,handler){var handler2=function(evt){evt=evt?evt:event?event:null;if(evt){var target=evt.target?evt.target:evt.srcElement?evt.srcElement:null;if(target)target=target.nodeType==1||target.nodeType==9?target:target.parentNode;return handler(elmt,evt,target)}return true};if(BubbleTT.Platform.browser.isIE)elmt.attachEvent("on"+eventName,handler2);else elmt.addEventListener(eventName,handler2,false)};
